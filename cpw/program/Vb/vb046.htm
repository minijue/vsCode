<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>软件完全手册</title>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
</head>

<body>

<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="95%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="../progmenu.htm">编程技巧</a> --&gt; 
      <a href="Vbidx099.htm">Visual Basic</a> --&gt; </b> </span>VB中Winsock控制的UDP协议的使用</td>
  </tr>
</table>
</center></div><div align="center"><center>

<table border="1" width="95%" style="font-size: 9pt" bgcolor="#FFFFFF"
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">
  <tr>
    <td width="100%"><table border="1" width="32%" style="font-size: 9pt" height="30"
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"
    bordercolordark="#FFFFFF">
      <tr>
        <td width="100%" bgcolor="#4264B5"><p align="center"><span style="font-size: 9pt"><font
        color="#FFFFFF">资料整理&middot;<a href="http://chinaprog.yeah.net" target="_blank"
        style="color: rgb(255,255,255)">中国程序员网站</a></font></span></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%">
    <span style="FONT-FAMILY: 宋体; FONT-SIZE: 9pt; LETTER-SPACING: 1px; LINE-HEIGHT: 20px"><p
    align="center" class="ourfont"></span><b><font color="#0000ff"><br>
    </font>VB中Winsock控制的UDP协议的使用</b> 
      </p>
    <p align="left" class="ourfont"><font color="#000000"><span
    style="FONT-FAMILY: 宋体; FONT-SIZE: 9pt; LETTER-SPACING: 1px; LINE-HEIGHT: 20px">&nbsp;&nbsp;&nbsp;&nbsp;UDP协议基础：<br>
    　　UDP(User Datagram Protocol)是一种无连接协议，与TCP操作不同，计算机间并不需要建立一个连接，同时，一个UDP应用可同时作为应用的客户或服务器方。<br> 
    　　由于UDP协议并不需要建立一个明确的连接，因此建立UDP应用要比建立TCP应用简单得多。在TCP应用中，一个Winsock控制必须明确地设置成“监听”，而其它Winsock控制则必须使用Connect方法来初始一个连接。<br>
    　　使用UDP协议，在两个Winsock控制间进行数据的发送，在连接的两端必须完成以下三步：<br>
    　　1.设置RemoteHost属性为其它计算机的名称；<br>
    　　2.设置RemotePort属性为第二个Winsock控制的LocalPort属性的值；<br>
    　　3.申请Bind方法。<br>
    　　通过使用方法Bind，则可将该Winsock控制捆绑到一个本地端口，以便该Winsock控制使用该端口来进行类似TCP的“监听”功能，并防止其它应用使用该端口。<br>
    　　使用该协议传送数据，首先设置客户计算机的LocalPort属性。而作为服务器的计算机仅需要设置RemoteHost属性为客户计算机的IP地址或域名即可，并将其RemotePort属性设置成客户计算机上的LocalPort属性即可，然后就可通过申请SendData方法来开始信息发送，客户计算机则可在其DataArrial事件中使用方法GetData来获取发送的信息。<br>
    　　下例具体演示了一个“谈话”应用，以允许相互间进行实时的交谈。<br>
    　　UDP应用一：<br>
    　　建立一个新标准EXE工程文件，拖放一个Winsock控制到表单上，添加两个文本框到表单上，然后进行以下属性的设置：<br>
    　　表单(Form):Name=“frmPeerA” Caption=“UDP Application(1)”<br> 
    　　Winsock控制：Name=“udpPeerA” Protocol=“sckUDPProtocol”<br> 
    　　文本框1(TextBox): Name“txtSend”<br> 
    　　文本框2(TcxtBox): Name=“txtOutput” MultiLine－True ScrollBars=2<br> 
    　　然后打开代码窗口，分别在相应的事件下输入以下代码：<br>
    　　Private Sub Form_Load()<br> 
    　　 With udpPeerA<br> 
    　　 .RemoteHost=“197.1.1.2” '要连接到的计算机名<br> 
    　　 .RemotePort=1010 '要连接到的端口号<br> 
    　　 .LocalPort=1011 '该Winsock控制将要使用的本地端口号，便于其它端与该Winsock通讯<br> 
    　　 .Bind 1011 '将该Winsock控制绑定到该本地端口<br> 
    　　 EndWith<br> 
    　　End Sub<br> 
    　　Private Sub txtSend_Change()<br> 
    　　 udpPeerA.SendData txtSend.Text'发送文本<br> 
    　　End Sub<br> 
    　　Private Sub udpPeerA_DataArrival(ByVal bytesTotal As Long)<br> 
    　　 Dim strData As String<br> 
    　　 udpPeerA.GetData strData,vbString<br> 
    　　 txtOutput.Text = strData<br> 
    　　End Sub<br> 
    　　UDP应用二：<br>
    　　类似建立UDP Server的方法，在表单上添加一个Winsock控制及两个文本框，然后进行以下属性的设置：<br> 
    　　表单(Form):Name=“frmPeerB” Caption=“UDP Application(2)”<br> 
    　　Winsock控制：Name=“udpPeerB” Protocol=“sckUDPProtoclool”<br> 
    　　文本框1(TextBox)：Name=“txtSend”<br>
    　　文本框2(TextBox)：Name=“txtOutput” MultiLine=True ScrollBars=2<br> 
    　　然后输入以下代码：<br>
    　　Private Sub Form_Load()<br> 
    　　 With udpPeerB<br> 
    　　 .RemoteHost=“197.1.1.2” '要连接到计算机的IP地址<br> 
    　　 .RemotePort=1011 '要连接到的端口号<br> 
    　　 .LocalPort=1010 '该Winsock控制将使用的本地端口号，便于其它方与之通讯<br> 
    　　 .Bind 1010 '将该Winsock控制绑定到该本地端口<br> 
    　　 End With<br> 
    　　End Sub<br> 
    　　Private Sub txtSend_Change()<br> 
    　　 udpPeerB.SendData txtSend.Text '发送文本<br> 
    　　End Sub<br> 
    　　Private Sub udpPeerB_DataArrival(ByVal bytesTotal As Long)<br> 
    　　 Dim strData As String<br> 
    　　 udpPeerB.GetData strData,vbString<br> 
    　　txtOutput.Text=strData<br>
    　　End Sub<br> 
    　　要运行该实例，打开两个Visual Basic的事例，然后分别运行这两个工程文件即可。若要在不同的机器上运行此两例，只需要将两个工程文件中的RemoteHost改变成相应的计算机的IP地址或域名即可(以上例子在Visual  
    Basic 5.0及PWIN97上通过)。(重庆 张业武)</span></font></td> 
  </tr> 
  <tr> 
    <td width="100%">　</td> 
  </tr> 
</table> 
</center></div> 
 
<p align="center">　</p> 
</body> 
</html> 
