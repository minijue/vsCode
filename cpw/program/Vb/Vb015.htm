<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>走进VB6 啃一块骨头</title>
<link rel="stylesheet" href="my.css"
tppabs="http://person.zj.cninfo.net/~lifu/images/my.css">
</head>

<body style="font-size: 9pt" bgcolor="#FFFFFF">

<table border="0" cellspacing="2" cellpadding="0" bordercolor="#DED8CD" width="100%">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">现在的位置是： <a href="Vb_idx.htm"
    tppabs="http://person.zj.cninfo.net/~lifu/index.html">Visual Basic</a><b>&gt;</b> 走进VB6 
    啃一块骨头</span></td>
  </tr>
  <tr>
    <td><span style="font-size: 9pt"></span></td>
  </tr>
</table>

<table border="0" width="100%" style="font-size: 9pt" bgcolor="#E8E8E8">
  <tr>
    <td width="100%"><table border="1" width="32%" style="font-size: 9pt" height="30"
    cellspacing="0" cellpadding="2">
      <tr>
        <td width="100%" bgcolor="#4264B5"><p align="center"><font color="#FFFFFF">资料整理<span
        class="f">&middot;</span><a href="http://fasoft.yeah.net" target="_blank"
        style="color: rgb(255,255,255)">中国程序员网站</a></font></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%">　<table border="0" width="100%">
      <tr>
        <td width="100%"></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%"><p align="center"><strong><span style="font-size: 9pt">走进VB6 
    啃一块骨头</span></strong></td>
  </tr>
  <tr>
    <td width="100%"></td>
  </tr>
  <tr>
    <td>我们在玩《仙剑奇侠传》时，要是不能保存数据，那么非得挑灯夜战三昼夜才能玩完，可见数据存储之重<br>
    要性。爱好编程的CFAN是不会放过数据文件的，下面跟着我驰骋吧！我们先吃一个哈密瓜，开门即来编一传统的比较有代表性的程序，不可不看的哟！<br>
    &nbsp;&nbsp; 程序分为一个表单cfanvb.frm，一个模块cfanvb.bas。一个表单程序。程序的表单中有五个命令按钮，从上到下分别命名为Cmdnew、Cmdsave，Cmdtxt、cmdlookfor、Cmdexit，标题分别为&amp;New、&amp;Save、&amp;Txt、&amp;Lookfor、&amp;Exit；还有三个文本框，名称分别为Textname、Textage、Textsex；还有三个标签。<br>
    <strong>程序的功能</strong><br>
    功能1：能存储你所输入的每一条完整记录，并创造数据库文件nas.db。<br>
    功能2：能按输入的姓名字段查找记录并显示。<br>
    功能3：将所有记录按NAME字段排序制成文本文件nas.txt，以便打印、修改。<br>
    <strong>程序运行情况</strong><br>
    &nbsp;&nbsp; 先后输入八条记录，name字段分别为李继华、朱茵、小巩、朱朱、李丽丽、黄庆、Tom、Kate，并一一存储（按Save按钮，存储第一条记录前，Txt按钮为灰色，即不可激活态）；点击【Txt】按钮，会出现【文本已经建好】提示框（文本的各项是按姓名顺序排列的，name分别为Kate、Tom、小巩、朱朱、朱茵、李丽丽、李继华、黄庆）；在Textname文本框中输入上面任一姓名，点击【Lookfor】按钮即可得到其他的字段（年龄、性别）情况，如果不为此八人，则显示【not 
    find】提示框。此程序运行后可以建立一个名为Nas.db的数据库文件和一个名为Nas.txt的文本文件。<br>
    <br>
    Cfanvb.bas模块代码为：<br>
    Type nas '定义记录类型<br>
    name As String * 6 '姓名<br>
    age As String * 3 '年龄<br>
    sex As String * 4 '性别<br>
    End Type<br>
    Type nasindex '定义另一记录类型<br>
    name As String * 6 '姓名<br>
    number As Integer '记录号<br>
    End Tyep<br>
    Public among As nas '定义公共变量<br>
    public index() As nasindex '定义枚举索引数组<br>
    Public totalnum As Integer '定义总记录数<br>
    <br>
    cfanvb.frm表单的代码为：<br>
    Option Explicit '强制变量必须进行正规声明<br>
    Const nasdb＝&quot;\nas.db&quot; '定义常量数据库文件名<br>
    Const nastxt=&quot;\nas.txt&quot; '定义文本文件名<br>
    Function search(findtxt) As Integer 'Function过程，寻找某一姓名findtxt，得出记录号search<br>
    Dim front As Integer '定义变量<br>
    Dim behind As Integer<br>
    Dim findnum As Integer<br>
    Dim middle As Integer<br>
    front=1<br>
    behind = totalnum '定义初始值<br>
    findnum = 0<br>
    Do While front &lt;= behind And findnum = 0<br>
    middle = (front + behind)\2 '用二分法查找<br>
    If findtxt = RTrim(index(middle).name) Then '找到此记录<br>
    findnum = middle<br>
    ElseIf findtxt &gt; index(middle).name Then<br>
    front=middle + 1 '要找的记录在middle之后<br>
    Else<br>
    behind = middle - 1 '要找的记录在middle之前<br>
    End If<br>
    Loop<br>
    search=findnum '如找到，则找到的记录号为search；否则，search为0<br>
    End Function<br>
    Sub createindex() '为所有记录建立索引<br>
    Dim i As Integer, change As nasindex, j As Integer<br>
    For i = I To totalnum<br>
    Get #1,i,among '读出第i条记录<br>
    index(i).name=among.name '此记录的name字段赋予索引i的name字段<br>
    index(i).number = i '记录号赋予索引i的number字段<br>
    Next i<br>
    For i =l to totalnum -1<br>
    For j=i +1 To totalnum<br>
    If index(i).name &gt; index(j).name Then<br>
    change = index(i)<br>
    index(i)=index(j)<br>
    index(j)=change<br>
    End If<br>
    Next j<br>
    Next i '对索引数组排序，使index(i).name &lt;index(j).name (i&lt;j)<br>
    Fnd Sub<br>
    Private Sub Cmdexit_Click()<br>
    Close #1 '关闭文件1<br>
    End '结束<br>
    End Sub<br>
    Private Sub Cmdlookfor_Click() '查找<br>
    Dim which As Integer<br>
    Dim findit As Integer<br>
    which = search(textname.Text) '调用search()<br>
    If which &gt; 0 Then 'which &gt; 0 表明查找到<br>
    findit = index(which).number<br>
    Get #1, findit,among '由记录号读出记录<br>
    with among<br>
    textname =.name '将此记录的各字段显示于文本框<br>
    Textage =.age<br>
    Textsex =.sex<br>
    End With<br>
    Else<br>
    MsgBox &quot;can't find it&quot; , 48,&quot;lookfor&quot; '否则没找到提示信息<br>
    End If<br>
    End Sub<br>
    Private Sub cmdnew_Click() '所有文本框清空<br>
    textname =&quot;&quot;<br>
    Textage = &quot;&quot;<br>
    Textsex =&quot;&quot;<br>
    textname.SetFocus 'textname文本框得到输入焦点<br>
    End Sub<br>
    Private Sub Cmdsave_Click()<br>
    totalnum = totalnum + 1 '记录数加1<br>
    If totalnum &gt; 0 Then Cmdtxt.Enabled = True '使Cmdtxt按钮由灰色变成可激活<br>
    With among '将各文本框内容存于记录<br>
    .name=textname.text<br>
    .age=Textage.Text<br>
    .sex = Textsex.Text<br>
    End With<br>
    Put #1,totalnum,among '将记录加入#1<br>
    ReDim index(totalnum) '重新定义枚举数组<br>
    createindex '调用过程重新建立索引<br>
    textname =&quot;&quot; '清空文本框，激活textname<br>
    Textage = &quot;&quot;<br>
    Textsex =&quot;&quot;<br>
    textname.SetFocus<br>
    End Sub<br>
    Ptivate Sub Cmdtxt_Click() '建立文本文件<br>
    Dim i<br>
    Dim message1 As String, message2 As String<br>
    Open nastxt For Output As #2 '打开文本，接受输出<br>
    For i=1 To totalnum<br>
    Get #1, index(i).number,among '读记录<br>
    With among<br>
    Print #2,&quot; &quot;; UCase(Trim.(.name))<br>
    Print #2,&quot;age: &quot;; .age '用Print语句建立文本<br>
    Print #2, &quot;sex: &quot;; .sex<br>
    End With<br>
    Next i<br>
    Close #2 '关闭文本文件<br>
    textname.SetFocus<br>
    message1=&quot;文本nas.txt已经建好&quot;<br>
    message2 =&quot;file&quot;<br>
    MsgBox$ message1, 64, message2&nbsp; '显示文本已建好对话框<br>
    End Sub<br>
    Private Sub Form_Load() '程序运行装人表单时的事件<br>
    Open nasdb For Random As #1 '打开数据库<br>
    Len = Len(among)<br>
    totalnun = LOF(1)/ Len(among) '计算记录数<br>
    If totalnum &gt; 0 Then<br>
    ReDim index(totalnum) '定义枚举索引数组<br>
    createindex '建立索引<br>
    Else<br>
    Cmdtxt.Enabled = False '禁止Cmdtxt按钮<br>
    End If<br>
    End Sub<br>
    <strong>我们通过以上程序，可以得出哪些启示呢？</strong><br>
    1．文件可分为文本文件（一般为顺序存取格式，本程序为cfanvb.txt）和随机存取文件（本程序为cfan<br>
    vb.db）。<br>
    2．随机存取文件由一些固定长度的记录组成，建立好索引后，能在不读入其他记录的情况下，直接跳到某一记录。<br>
    3．在文本文件中使用的语句：<br>
    （1）Open filename For output(append) As #numberoutput：创建一个新文件并准备写入数据；<br>
    append：打开一个已存在的文件并准备写入数据于文件的结尾。<br>
    （2）Print #number,[data1;data2;data3...]<br>
    它可将一个或多个没有分隔的字符串输出到指定文件#filenumber, “print 
    #filename，”表示输出一空行。<br>
    （3）Write #number,data1,data2,data3...<br>
    它可将一行数据写入一个已经打开的文件，并提供“，”作间隔。<br>
    （4）Open filename For Input As #number<br>
    它为读数据而打开一个文件。<br>
    4．随机存取文件常用语句：<br>
    （1）Open filename For Random As #number Len=recordlength<br>
    以随机方式打开一既可以读又可以写的文件，其中recordlength为文件记录的字节数。<br>
    （2）Put #number,recordnumber,record（写入）<br>
    Get #number,recordnumber,record（读出）<br>
    其中，#number文件已经打开，&quot;recordnumber指明要写入（或读出）的位置，record指那条记录。<br>
    &nbsp;&nbsp; 
    本文介绍了处理数据的一些传统方法和基本知识，根据本程序的思路，你可制作出自己喜欢的小程序。其实VB6还有更简单的处理数据的方法，留待以后介绍。希望我烧的骨头汤能适合大家口味。</td>
  </tr>
</table>

<p><br>
<br>
</p>
</body>
</html>
