<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>您现在的位置是</title>
</head>

<body>

<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="100%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="../../progidx.htm">编程技巧</a> --&gt; 
      <a href="../Vbidx099.htm">VB</a></b></span></td>      
  </tr>      
</table>      
</center></div><div align="center"><center>      
      
<table border="1" width="100%" style="font-size: 9pt" bgcolor="#FFFFFF"      
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">      
  <tr>      
    <td width="85%" align="left" valign="top"><table border="1" width="32%" style="font-size: 9pt" height="30"      
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"      
    bordercolordark="#FFFFFF">      
      <tr>      
        <td width="100%" bgcolor="#4264B5"><p align="center"><span style="font-size: 9pt"><font      
        color="#FFFFFF">资料整理&middot;<a href="http://chinaprog.yeah.net" target="_blank"      
        style="color: rgb(255,255,255)">中国程序员网站</a></font></span></td>      
      </tr>      
    </table>      
      <p align="center">在VB6.0中播放GIF动画<br>
      <br>
               中国矿业大学北京研究生部   关永  张杰</p> 
      <p><br> 
      <br> 
      ---- 摘 要： 由 于GIF 格 式 动 画 文 件 具 有 小 巧、 制作 方 便 等 特 点，因 此 在 网 上 得 到 广 泛 应 用，但 遗 憾 的 是VB 中 的 多 媒 体 控 件 却 
      无 法 播 放 它， 这 给 我 们 设 计VB 应 用 程 序 带 来 了 不 便。 在此 我 
      们 向 大 写 介 绍 一 种 利 用 网 络 浏 览 器IE 实现 在VB 中 播 放GIF 动 画 
      的 方 法。 并 给 出 一 个 简捷、 实 用 的“ 画 中 画” 滚 动 显 示 程 序。&nbsp;<br>
      <br>
      ---- GIF 动 画 格 式 文 件 是 一 种 动 态 存 储 的 图 形格 式 文 件。 在 
      内 容 相 同 的 条 件 下， 与 其 它 格式 文 件 相 比， 由 于 它 占 用 的 存 
      储 空 间 少， 且制 作 手 段 成 熟， 可 浏 览 的 软 件 工 具 也 很 多，所 
      以 倍 受 设 计 者 的 青 睐。 然 而 令 人 遗 憾 的 是， 在Visual Basic 中， 
      无 论 是 多 媒 体 控 件MCI、MCIWnd， 还 是Animation 控 件, 甚 至 调 用<br> 
      Windows API 函数 都 无 法 播 放GIF 格 式 的 动 画 文 件。 造 成 这 一现 象 
      的 原 因 在 于GIF 动 画 格 式 文 件 不 是VB 多 媒体 控 件 所 支 持 的 视 
      频 格 式 文 件（VB 多 媒 体 控件 所 支 持 的 视 频 格 式 文 件 主 要 有：AVI 格 式、MOV 格 式、FLI 格 式、FLC 格 式 等）。 以 往 我 们 的 解决 方 
      法 是： 首 先 利 用 一 些 格 式 转 换 工 具， 比如GIF Movie Gear 将GIF 格&nbsp;<br>
      式 的 动 画 文 件 转 换 为AVI格 式 的 动 画 文 件， 然 后 再 用 多 媒 体 
      控 件MCI和MCIWnd 进 行 播 放。 但 这 种 做 法 主 要 存 在 以 下两 个 缺 陷：&nbsp;<br>
      <br>
      ---- 1 ． 所 形 成 的AVI 格 式 动 画 文 件 太 大（ 常 常是GIF 格 式 文 件的 几 十 倍）， 从 而 影 响 系 统 的效 率。&nbsp;<br>
      <br>
      ---- 2 ． 所 形 成 的AVI 格 式 动 画 文 件 往 往 带 有比 较 复 杂 的 调 色 
      板 信 息， 所 以 当 程 序 在 播 放这 种AVI 格 式 动 画 文 件 时， 如 果 还 
      兼 有 动 态 显示 的 文 字 和 图 象 信 息， 则 整 个 画 面 就 会 产 生抖 动 
      和 闪 烁， 从 而 使 显 示 效 果 大 受 影 响。&nbsp;<br>
      <br>
      ---- 为 解 决 这 个 问 题， 我 们 在 此 提 出 一 个 全新 的 处 理 方 案 : 
      通 过 在VB 中 调 用IE 浏 览器 来 实 现GIF 动 画 的 播 放， 实 际 使 用 表 
      明： 效果 甚 好。&nbsp;<br>
      <br>
      ---- 一、 浏 览 器IE 和WebBrowser 控 件&nbsp;<br>
      <br>
      ---- 众 所 周 知， 运 行VB6.0 需 要 安 装 浏 览 器IE4.0或 以 上 版 本， 当IE4.0 和VB6.0 安 装 完 成 后， 我 们便 可 以 在VB6.0 中 使 用IE 所 提 供 的WebBrowser 控 件播 放GIF 动 画 了。 具 体 方 法 如 下：&nbsp;<br>
      <br>
      ---- 1 ． 由 于WebBrowser 控 件 并 不 是VB 的 基 本 控件， 因 此 在 使 用 
      该 控 件 之 前 必 须 先 将 其 装 入工 具 箱 中。 装 入 方 法： 在 工 具 箱 
      中 点 击 鼠 标右 键 → 选 中“ 部 件” → 复 选Microsoft InternetControls → 
      然 后 点 击“ 确 定” 键 即 可。&nbsp;<br>
      <br>
      ---- 2 ． 选 取WebBrowser 控 件（ 注 意 不 同 版 本IE的WebBrowser 控 件 的 
      图 标 是 不 同 的，IE4.0 中的WebBrowser 控 件 的 图 标 是 一 个 地 球；IE3.0 
      是 一个 搜 索 图 标。）， 添 加 到 窗 体 的 相 应 位 置 上。&nbsp;<br>
      <br>
      ---- 3 ． 设 计 相 应 代 码， 通 过 使 用WebBrowser 控件 的Navigate 方 法 
      播 放GIF 动 画 文 件。&nbsp;<br>
      <br>
      ---- Navigate 方 法 的 语 法 格 式 为：<br> 
      <br> 
      WebBrowser 控 件 名.Navigate URL [Flags,][TargetFrameName,][PostData,][Headers]<br>
      <br>
      ---- WebBrowser 控 件 支 持 的 主 要 方 法 有:&nbsp;<br>
      <br>
      GoBack ― ― ― 回 退 到 上 一 屏。<br> 
      GoForward ― ― ― 进 入 到 下 一 屏。<br> 
      GoHome ― ― ― 回 家。 即 回 到 主 页。<br> 
      Stop ― ― ― 停 止 导 航。<br> 
      Refresh ― ― ― 刷 新。<br> 
      Navigate ― ― ― 导 航。<br> 
      <br> 
      ---- WebBrowser 控 件 所 响 应 的 事 件:&nbsp;<br>
      <br>
      ---- BeforeNavigate 事 件 ― ― ― 在 开 始 导 航 前 发 生。 一 般 在 此 获 
      取 完 整 的URL 字 符 串。&nbsp;<br>
      <br>
      ---- WebBrowser 控 件 最 主 要 的 参 数:&nbsp;<br>
      <br>
      ---- URL ― ― ― 获 得 导 航 用 的 标 准URL 字 符 串。例 如： 它 能 将”www.MicroSoft.Com” 自 动 翻 译 为” http:// www.MicroSoft.Com”.URL 是Uniform Resource Locator 的 缩 写， 是 在Internet 的WWW 服 务 程 序 上 用 于 
      指 定 信 息 位 置 的 表 示 方 法。&nbsp;<br>
      <br>
      ---- 下 面 我 们 结 合 一 个 实 例 进 行 具 体 说 明。这 是 一 个“ 画 中 画” 
      滚 动 显 示 应 用 程 序， 界 面 由 循 环 滚 动 显 示 的 文 字、 背 景 图 象、 
      和 播 放 的GIF 动 画 三 部 分 组 成。 其 中 循 环 显 示 的 文 字 用 透 明 的Label 控 件 实 现； 动 画 用WebBrowser 控 件 实 现 播 放。&nbsp;<br>
      <br>
      ---- ① 所 需 控 件：&nbsp;<br>
      <br>
      ---- 本 程 序 需 要 一 个PictureBox 控 件、 一 个Label 控 件、 一 个WebBrowser 
      控 件、 一 个Timer 控 件。&nbsp;<br>
      <br>
      ---- ② 各 控 件 的 属 性 设 置 如 下：&nbsp;<br>
      <br>
      控件名称 属性 设置值 含 义<br> 
      Label1控件 BackStyle 0 设置Label1控件的背景是透明的。<br> 
      Timer1控件 Interval 200 设置每0.2秒发生一次Timer1_Timer()事件。<br> 
      <br> 
      ---- ③ 各 事 件 的 相 应 代 码 如 下：&nbsp;<br>
      <br>
      首 先 定 义 一 个 变 量， 以 便 用 它 来 存 放 需 要 滚 动 显 示 的 字 符 串。<br> 
      <br> 
      Dim aa As String<br> 
      <br> 
      在Form_Load() 事 件 中 进 行 初 始 化 工 作， 具 体 代 码 如 下：<br> 
      <br> 
      Private Sub Form_Load()<br> 
      Picture1.Picture = LoadPicture(App.Path &amp; "\demo1.jpg")<br> 
      WebBrowser1.Navigate (App.Path &amp; "\new1.gif")<br> 
      <br> 
      ---- aa = " 这 是 一 个 利 用 网 络 浏 览 器IE 中WebBrowser 控 件 制 作 的GIF 
      动 画 播 放 程 序。 "&nbsp;<br>
      <br>
      Label1.ForeColor = QBColor(11)<br> 
      Label1.FontSize = 18<br> 
      Label1.Caption = aa<br> 
      End Sub<br> 
      <br> 
      ◆ 在Timer1_Timer()事件中，每隔0.2秒改变<br> 
      一次Label1控件的Caption属性值。<br> 
      Private Sub Timer1_Timer()<br> 
      ` 让字符串头尾相接，以便形成滚动效果。&nbsp;<br>
      aa = Mid(aa, 2, 59) + Mid(aa, 1)<br> 
      Label1.Caption = aa<br> 
      End Sub<br> 
      ◆ 在Picture1_Click()事件中，卸载并退出应用程序。<br> 
      Private Sub Picture1_Click()<br> 
      Unload Me<br> 
      End Sub<br> 
      <br> 
      ---- ④ 调 整 各 控 件 至 适 当 的 大 小 和 位 置。&nbsp;<br>
      <br>
      ---- 二、 注 意 事 项 及 附 加 说 明&nbsp;<br>
      <br>
      ---- 1 ． 不 同 版 本IE 的Microsoft Internet Controls 所 包 含 的 控 件 及 控 
      件 数 量 是 不 同 的。 设 计 者 在 使 用 时 必 须 注 意 这 一 点。&nbsp;<br>
      <br>
      ---- ① WINDOWS95 所 带 的IE3.0 的Microsoft Internet Controls 只 包 含 一 个 
      控 件， 即WebBrowser 控 件。&nbsp;<br>
      <br>
      ---- ② 中 文 版IE4.0CN 的Microsoft Internet Controls 包 含 两 个 控 件， 即WebBrowser 控 件 和DownUp 控 件。&nbsp;<br>
      <br>
      ---- ③ 英 文 版IE4.01 的Microsoft Internet Controls 包含 两 个 控 件， 即WebBrowser 控 件 和ShellFolderViewOC控 件。&nbsp;<br>
      <br>
      ---- 2 ． 实 际 上， 在VB5.0 中 也 可 以 使 用WebBrowser控 件 播 放GIF 动 画， 
      但 如 果VB5.0 是 安 装在WINDOWS95 下， 那 么 必 须 安 装IE3.0 或IE4.0； 如 果是 安 装 在WINDOWS98 下， 则 可 不 必（ 因 为WINDOWS98自 带IE4.0）。 然 而 需 
      要 特 别 声 明 的 是： 无 论 是VB5.0 的 联 机 手 册， 还 是 其 它 帮 助 文 件， 
      均 未介 绍 有 关WebBrowser 控 件 的 资 料（ 因 为WebBrowser控 件 不 是Visual 
      Basic 的 控 件， 而 是 由IE 提 供 的。）。 读 者 如 要 详 细 了 解 这 方 面 
      的 情 况， 请 查阅Visual Studio 98 中 的MSDN。 具 体 步 骤 如 下：&nbsp;<br>
      <br>
      ---- 从Microsoft Developer Network 中 选 择MSDN LibraryVisual Studio 6.0, 查 
      找 关 于Reusing the WebBrowserControl 的 主 题， 位 置 在Internet Explorer:PlatfromSDK。 从 哪 可 以 找 到 有 关WebBrowser 控 件 的 详 
      尽资 料。&nbsp;<br>
      <br>
      ---- 3 ． 注 意 你 的 发 布 权 限。 由 于 受 到 软 件 知识 产 权 的 影 响， 
      任 何 软 件 都 有 它 的 发 行 权 限。 在Visual Basic 中, 你 可 以 自 由 地 
      发 布 任 何由Visual Basic 创 建 的 应 用 程 序、 部 件、DLL、Active X 控 件、 
      各 种 媒 体 文 件、 示 例 应 用 程 序 在\Samples 子 目 录 下） 以 及 系 统 第 
      一 次 安 装Visual Basic 时 最 初 复 制 到Visual Basic 主 目 录的\Icons 子 目 
      录、\Graphics 子 目 录、\ODBC 子 目 录下 的 任 何 文 件。 但 除 此 之 外 的 
      其 它 软 件 一 般都 不 允 许 你 发 布。 例 如： 你 的 应 用 程 序 中 包含 有 
      对 网 络 浏 览 器IE 的 引 用， 那 么“ 应 用 程 序 安 装 向 导” 在 创 建 你&nbsp;<br>
      的 安 装 程 序 时， 就 会 因试 图 发 布 无 权 发 布 的 软 件 而 出 错。&nbsp;<br>
      <br>
      ---- 错 误 原 因： 因 为 我 们 无 权 用Visual Basic 的“应 用 程 序 安 装 向 
      导” 来 发 布 网 络 浏 览 器IE。&nbsp;<br>
      <br>
      ---- 那 么 既 然 我 们 不 能 在VB 的 应 用 程 序 中 发布 网 络 浏 览 器IE， 
      又 怎 么 样 保 证 应 用 程 序 中的 引 用 能 得 以 实 现 呢 ？&nbsp;<br>
      <br>
      ---- 解 决 办 法 ①： 如 果 用 户 的 计 算 机 上 已 经安 装 了 网 络 浏 览 
      器IE， 那 么 直 接 安 装 你 开 发的 应 用 程 序 即 可。&nbsp;<br>
      <br>
      ---- 解 决 办 法 ②： 如 果 用 户 的 计 算 机 上 还 未安 装 网 络 浏 览 器IE， 那 么 只 要 在 运 行 你 的 应用 程 序 之 前， 安 装 上 网 络 浏 览 器IE 即 可。&nbsp;<br>
      <br>
      ---- 需 要 说 明 的 是， 上 述 解 决 方 法 具 有 普 遍性， 如 果 你 的 应 用 
      程 序 在 发 布 时 遇 到 类 似 的问 题（ 例 如： 你 的 应 用 程 序 中 包 含 有 
      对Word97、Excel 97 的 引 用）， 均 可 照 此 处 理。</p> 
      <p>　      
    </td>      
  </tr>      
</table>      
</center></div>      
 
</body> 
 
</html> 
