<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0051)http://www.cfan.cn.net/zine/qikan/bbg/9906bb11.html -->
<HTML><HEAD><TITLE></TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type>
<META content="Microsoft FrontPage 4.0" name=GENERATOR></HEAD>
<BODY>
<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="100%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="../progidx.htm">编程技巧</a> --&gt; 
      Visual Basic</b></span></td>  
  </tr>  
</table>  
</center></div><div align="center"><center>  
  
<table border="1" width="100%" style="font-size: 9pt" bgcolor="#FFFFFF"  
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">  
  <tr>  
    <td width="15%" align="center" valign="top"><!--webbot bot="Include"  
      U-Include="../../menu.htm" TAG="BODY" startspan -->

<table border="1" width="101" style="font-size: 9pt" cellspacing="0" cellpadding="2" bordercolorlight="#000000" bordercolordark="#FFFFFF">
  <tr>
    <td width="99" bgcolor="#FFCC66" valign="top" align="left">
      <p align="center">编程技巧</td>
  </tr>
  <tr>
    <td width="97" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15"> 
      <a href="../VisualC/Vcidx098.htm">Visual C</a></td>   
  </tr>   
  <tr>   
    <td width="97" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">   
      <a href="Vbidx099.htm">VB</a></td>  
  </tr>  
  <tr>  
    <td width="97" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">  
      <a href="../Vfp/Vfp_idx.htm">VFoxpro</a></td>  
  </tr>  
  <tr>  
    <td width="97" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">  
      <a href="../Delphi/Del_idx.htm">Delphi</a></td>  
  </tr>  
  <tr>  
    <td width="97" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">  
      <a href="../powerbuild/pow_idx.htm">PB</a></td> 
  </tr> 
  <tr> 
    <td width="97" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">  
      <a href="../linux/linuxidx.htm">Linux</a></td> 
  </tr> 
  <tr> 
    <td width="97" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">  
      <a href="../other/oth_idx.htm">其它</a></td> 
  </tr> 
  <tr> 
    <td width="99" valign="top" align="left"></td> 
  </tr> 
  <tr> 
    <td width="99" valign="top" align="left" bgcolor="#FFCC66"> 
      <p align="center">网站建设</td> 
  </tr> 
  <tr> 
    <td width="99" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">  
      网站评说</td> 
  </tr> 
  <tr> 
    <td width="99" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">  
      ASP</td>
  </tr>
  <tr>
    <td width="99" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15"> 
      CGI</td>
  </tr>
  <tr>
    <td width="99" valign="top" align="left"></td>
  </tr>
  <tr>
    <td width="99" valign="top" align="left" bgcolor="#FFCC66">
      <p align="center">源代码</td>
  </tr>
  <tr>
    <td width="99" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15"> 
      ASP</td> 
  </tr> 
  <tr> 
    <td width="99" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">  
      CGI</td> 
  </tr> 
  <tr> 
    <td width="99" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">  
      系统工具</td> 
  </tr> 
  <tr> 
    <td width="99" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">  
      游戏软件</td> 
  </tr> 
  <tr> 
    <td width="99" valign="top" align="left"><img border="0" src="../../res/dir.gif" width="32" height="15">  
      其它</td> 
  </tr> 
  <tr> 
    <td width="99" valign="top" align="left"></td> 
  </tr> 
</table> 
 
<!--webbot bot="Include" endspan i-checksum="1468" -->

    </td>  
    <td width="85%" align="left" valign="top"><table border="1" width="32%" style="font-size: 9pt" height="30"  
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"  
    bordercolordark="#FFFFFF">  
      <tr>  
        <td width="100%" bgcolor="#4264B5"><p align="center"><span style="font-size: 9pt"><font  
        color="#FFFFFF">资料整理&middot;<a href="http://chinaprog.yeah.net" target="_blank"  
        style="color: rgb(255,255,255)">中国程序员网站</a></font></span></td>  
      </tr>  
    </table>  
      <p align="center"><STRONG>用VB函数轻松访问系统注册表</STRONG>
      <p>
&nbsp;&nbsp;&nbsp;&nbsp;□新疆　王卫<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;<B>注</B>册表在Windows  
9x中的作用是不言而喻的，它除了保存操作系统自身的软件、硬件及环境信息外，一个重要的用途就是保存应用程序中允许用户定制修改的配置信息。  
&nbsp;&nbsp;&nbsp;&nbsp;<B>在</B>Visual  
Basic应用程序中，有两种访问系统注册表的方法：一种是使用VB自带的注册表函数，另一种则是使用Windows  
API函数，这两种方法各有优缺点，前者功能简单但容易使用，后者则功能强大但使用相对复杂一些，本文给大家介绍用VB自带的函数访问系统注册表的方法。  
&nbsp;&nbsp;&nbsp;&nbsp;一、用VB函数访问注册表的方法<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;<B>在</B>VB5.0中自带的注册表函数（命令）共有4条，分别是SaveSetting、GetSetting、GetAllSettings和DeleteSetting，下面是四个函数的详细用法：  
&nbsp;&nbsp;&nbsp;&nbsp;<B>1</B>SaveSetting appname, section, key, setting  
&nbsp;&nbsp;&nbsp;&nbsp;　appname  
应用程序或工程的名称<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;　section　注册表区域名称，在该区域保存注册表项设置<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;　key  
要修改的注册表项的名称<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;　setting　key的设置值<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;<B>S</B>aveSetting的功能是在注册表中指定应用程序的区域中为某注册表项赋值，如果指定的应用程序名、区域名或注册表项不存在，则先建立再赋值。可以利用这条命令建立某个注册表项或修改注册表项的值。  
&nbsp;&nbsp;&nbsp;&nbsp;<B>如</B>命令SaveSetting ″MyApp″, ″Option″, ″MyValue″,  
1的功能是将程序TestApp的Option区中MyValue表项的值赋为1，如果MyValue不存在则先建立该表项再赋值为1。  
&nbsp;&nbsp;&nbsp;&nbsp;<B>2</B>GetSetting(appname, section, key[, default])  
&nbsp;&nbsp;&nbsp;&nbsp;　appname  
应用程序或工程的名称<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;　section  
区域名称<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;　key  
注册表项名称<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;　default　  
key的缺省值，为可选参数<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;<B>G</B>etSetting的功能是从注册表中的应用程序指定区域中返回某注册表项的设置值，如果  
GetSetting 的参数中的任何一项在注册表中都不存在，或key没有赋值（即=″″）时，则返回default指定的值。  
&nbsp;&nbsp;&nbsp;&nbsp;<B>如</B>代码Value=GetSetting(″MyApp″, ″Option″,  
″MyValue″)可以获取程序TestApp的Option区中MyValue表项的值。  
&nbsp;&nbsp;&nbsp;&nbsp;<B>3</B>GetAllSettings(appname, section)  
&nbsp;&nbsp;&nbsp;&nbsp;　appname  
应用程序或工程的名称<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;　section  
区域名称<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;<B>G</B>etAllSettings函数返回Variant型数据，其内容为字符串的二维数组，该二维数组包含指定区域中的所有注册表项设置及其对应值。如果指定的appname或section不存在，则返回未初始化的Variant。  
&nbsp;&nbsp;&nbsp;&nbsp;<B>如</B>命令MySettings=GetAllSettings(″MyApp″,  
″Option″)可获取Option下所有注册表项的名称和取值，并将结果保存在变体型数据MySettings中。  
&nbsp;&nbsp;&nbsp;&nbsp;<B>4</B>DeleteSetting appname[, section[, key] ]  
&nbsp;&nbsp;&nbsp;&nbsp;　appname  
应用程序或工程的名称<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;　section  
要删除注册表项设置的区域名称，为可选参数<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;　key　　  
要删除的注册表项，为可选参数<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;<B>D</B>eleteSetting命令在注册表中，删除应用程序信息、区域或注册表项。当只提供appname参数时，将删除appname指定的应用程序的所有信息，如果提供了appname和section参数，则删除section指定的区域，如果提供了所有参数，则删除指定的注册表项设置。  
&nbsp;&nbsp;&nbsp;&nbsp;<B>如</B>果指定的应用程序、区域或注册表项不存在，DeleteSetting将不做任何事情。  
&nbsp;&nbsp;&nbsp;&nbsp;<B>如</B>：DeleteSetting ″MyApp″将删除MyApp应用程序保存的全部信息。  
&nbsp;&nbsp;&nbsp;&nbsp;二、程序实例<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;下面以一个简单的实例说明四个函数的使用。<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;<B>新</B>建工程，在Form1上放置两个标签，Caption属性分别为“姓名”和“公司”；两个文本框txtName和txtCompany，Text属性均设为空；三个命令按钮cmdSave、cmdFind和cmdDelete，Caption分别设为“保存”、“查看”和“删除”，窗体布局如图1。  
&nbsp;&nbsp;&nbsp;&nbsp;给三个命令按钮添加如下代码：<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;Private  
Sub cmdSave_Click()<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;<B>  
</B>′将两个文本框中的内容分别赋给MyApp下User区中Name和Company &nbsp;&nbsp;&nbsp;&nbsp;<B>  
</B>SaveSetting ″MyApp″, ″User″, ″Name″, txtName &nbsp;&nbsp;&nbsp;&nbsp;<B>  
</B>SaveSetting ″MyApp″, ″User″, ″Company″, txtCompany &nbsp;&nbsp;&nbsp;&nbsp;  
MsgBox ″您的信息已成功保存！″<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;End  
Sub<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;Private Sub  
cmdFind_Click()<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;<B>′</B>查找MyApp下User区中Name和Company的设置值并显示  
&nbsp;&nbsp;&nbsp;&nbsp;<B> </B>MsgBox ″您的姓名是：″ ＆ GetSetting(″MyApp″, ″User″,  
″Name″) ＆ Chr(13) ＆ Chr(10) ＆ ″您的公司是：″ ＆ GetSetting(″MyApp″, ″User″, ″Company″)  
&nbsp;&nbsp;&nbsp;&nbsp;End Sub<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;Private Sub  
cmdDelete_Click()<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;<B>  
</B>′删除MyApp下的User区域及其下的所有注册表项 &nbsp;&nbsp;&nbsp;&nbsp;<B> </B>DeleteSetting  
″MyApp″, ″User″ &nbsp;&nbsp;&nbsp;&nbsp;End  
Sub<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;<B>运</B>行程序，在图窗口中输入姓名和公司名称，之后按“保存”按钮，然后再按“查找”，可以看到显示出了正确的结果（图2），说明保存和查找操作都已正常进行。如果在保存之前或删除之后按“查找”按钮，则出现右图3对话框，说明要找的注册表项不存在。  
&nbsp;&nbsp;&nbsp;&nbsp;<B>使</B>用上面介绍的四个函数（命令），我们可以非常容易地在VB代码中访问系统注册表。但有一点比较遗憾，VB的这几个函数只能在系统注册表的固定位置进行工作，即只能在\KEY_CURRENT_USER\Software\VB  
and VBA Program  
Settings下完成建立、修改和删除操作，当然这个限制对于一般的应用程序无关大局，但对较大的应用程序就会造成一些不便，这时我们就需要借助于Windows  
API函数。?% &nbsp;   
      <p>　   
    </td>   
  </tr>   
  <tr>   
    <td width="100%" colspan="2" align="center" valign="top">　</td>   
  </tr>   
</table>   
</center></div>   
<p>&nbsp;<BR><BR></p> 
</BODY></HTML> 
