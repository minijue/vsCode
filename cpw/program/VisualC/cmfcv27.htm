<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb_2312-80">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title></title>
</head>

<body>

<table border="0" cellspacing="2" cellpadding="0" width="100%" style="font-size: 9pt">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">现在的位置是： <b><a href="Vc_idx.htm">Visual 
    C++/C++</a> &gt;</b> </span><font color="#000000">MFC邮递表的中文翻译-第二十七期</font></td>
  </tr>
  <tr>
    <td></td>
  </tr>
</table>

<table border="0" width="100%" style="font-size: 9pt" bgcolor="#E8E8E8">
  <tr>
    <td width="100%"><table border="1" width="32%" style="font-size: 9pt" height="30"
    cellspacing="0" cellpadding="2">
      <tr>
        <td width="100%" bgcolor="#4264B5"><p align="center"><font color="#FFFFFF">资料整理<span
        class="f">&middot;</span><a href="http://fasoft.yeah.net" target="_blank"
        style="color: rgb(255,255,255)">中国程序员网站</a></font></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%">　<table border="0" width="100%" bgcolor="#E8E8E8">
      <tr>
        <td width="100%">　</td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%"><p align="center"><font color="#000000"><strong>MFC邮递表的中文翻译-第二十七期</strong></font></td>
  </tr>
  <tr>
    <td width="100%">　</td>
  </tr>
  <tr>
    <td width="100%">　<p><font color="#FF0000">第二十七期目录</font> <font size="2">杨晓东 
    1999.3.1</font><ol>
      <li><a href="#vol27q1">画边框</a> </li>
      <li><a href="#vol27q2">运行时指定缺省按钮</a> </li>
      <li><a href="#vol27q3">关于CArchive类</a> </li>
      <li><a href="#vol27q4">自定义文件对话框</a> </li>
      <li><a href="#vol27q5">CFormView类的Fold按钮</a> </li>
      <li><a href="#vol27q6">视的背景色</a> </li>
      <li><a href="#vol27q7">隐藏控件台程序</a> </li>
      <li><a href="#vol27q8">修改SDI窗口标题</a> </li>
    </ol>
    <p><a name="vol27q1"></a></p>
    <p><br>
    </p>
    <font color="Red"><h3>画边框</h3>
    </font><p>问：有谁知道怎样画一个美观的边框？<br>
    </p>
    <p>答：这里有关于画3D文本的代码，我想对你或许会有帮助。 </p>
    <pre>
     if (m_bUse3D) {
          int s =3D (state &amp; ODS_SELECTED) ? -1 : +1;
          cx +=3D 3; cy +=3D 3;

          // draw 3D highlights
          pDC-&gt;SetTextColor(::GetSysColor(COLOR_3DDKSHADOW));
          pDC-&gt;TextOut(cx-s*2,cy+s*2,text);
          pDC-&gt;TextOut(cx+s*2,cy-s*2,text);
          pDC-&gt;TextOut(cx+s*2,cy+s*2,text);
          pDC-&gt;SetTextColor(::GetSysColor(COLOR_3DHILIGHT));
          pDC-&gt;TextOut(cx+s*1,cy-s*2,text);
          pDC-&gt;TextOut(cx-s*2,cy+s*1,text);
          pDC-&gt;TextOut(cx-s*2,cy-s*2,text);
          pDC-&gt;SetTextColor(::GetSysColor(COLOR_3DSHADOW));
          pDC-&gt;TextOut(cx-s*1,cy+s*1,text);
          pDC-&gt;TextOut(cx+s*1,cy-s*1,text);
          pDC-&gt;TextOut(cx+s*1,cy+s*1,text);
          pDC-&gt;SetTextColor(::GetSysColor(COLOR_3DLIGHT));
          pDC-&gt;TextOut(cx,cy-s*1,text);
          pDC-&gt;TextOut(cx-s*1,cy,text);
          pDC-&gt;TextOut(cx-s*1,cy-s*1,text);
          pDC-&gt;SetTextColor(textcol);
     }
     // draw the text
     pDC-&gt;TextOut(cx,cy,text);
</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol27q2"></a><br>
    </p>
    <font color="Red"><h3>运行时指定缺省按钮</h3>
    </font><p>问：在一个简单的对话框里有一个IDOK和IDCANCEL按钮和一个编辑框，IDOK按钮建立时被disable，而 
    IDCANCEL按钮建立时是enable的，所有的设置都是缺省的。当用户改变编辑框里的内容时，将会检查内容 
    是否合法，如果是则enable IDOK按钮，而且我也希望使IDOK这个按钮作为默认按钮。<br>
    </p>
    <p>答：在设置IDOK按钮之前，为什么不试一下关闭cancel按钮的缺省设置， 
    缺省设置只能有一个，所以必须先关闭cancel的缺省设置。象这样<br>
    </p>
    <pre>
CButton* CancelButton = (CButton*)GetDlgItem(IDCANCEL);
// get cancel button
CancelButton-&gt;ModifyStyle(BS_DEFPUSHBUTTON,0);
// remove style from cancel button
CButton* OKButton = (CButton*)GetDlgItem(IDOK);
// get OK button
OKButton-&gt;SetButtonStyle(BS_DEFPUSHBUTTON); 
// set default button style to OK button
</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol27q3"></a><br>
    </p>
    <font color="Red"><h3>关于CArchive类</h3>
    </font><p>问：我建立了一个类（CTimeItem).这个类对象中包含四个嵌入对象：一个简单的字符，两个 
    字符串类和一个时间类，m_ItemArray是关于时间类的CArray的数组类，我想将m_ItemArray 
    系列化和保存一个名为&quot;items.dat&quot;的磁盘文件中，下面的代码展示了具体的做法（省略）， 
    在程序的目录下建立了一个名为items.dat的文件，里面大概包含了我所想要的内容，如果是 
    的话，我该怎样恢复它？<br>
    </p>
    <p>答：1)在程序开始时你可以以读或建立模式打开一个archive对象的文件，象这样：<br>
    </p>
    <pre>
   CArchive ar(&amp;f, CArchive::load);
   m_ItemArray.Serialize(ar);
</pre>
    <p>你可以在OnInitDialog或者OnInitialUpdate里实现。<br>
    &nbsp;&nbsp;2) </p>
    <pre>CFile f;
f.Open(&quot;items.dat&quot;, CFile::modeRead)
CArchive ar(&amp;f, CArchive::Load);
m_ItemArray.Serialize(ar);</pre>
    <p>之后你就可以使用m_itemArray，里面保存了最后所保存的内容。 </p>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol27q4"></a><br>
    </p>
    <font color="Red"><h3>自定义文件对话框</h3>
    </font><p>问：我想对话框里面有一个&quot;details&quot;类型(而不是“list”),应该在对话框的工具条的 
    右上面，另外我也想通过单击列表框中的列表头使列表能按照递减（最新的）<br>
    </p>
    <p>答：1）我想您会在下面的地方找到你所想要的，特别是第二页。<br>
    <a href="http://www.vcdj.com/online/articles/oct98/opensave1.asp">http://www.vcdj.com/online/articles/oct98/opensave1.asp</a><br>
    &nbsp;&nbsp;2）继承一个CFileDialog类，并改写OnFolderChange()函数，放入以下代码：<br>
    </p>
    <pre>
void CMyFileDialog::OnFolderChange()
{
   CFileDialog::OnFolderChange();

   CWnd* pWnd = GetParent()-&gt;GetDlgItem( 0x461 );  // Get the
SHELDLL_DefView
   pWnd = pWnd-&gt;GetTopWindow();      // Get the ListView control

   // Check the window class name
   TCHAR szBuf[64];
   GetClassName( pWnd-&gt;GetSafeHwnd(), szBuf, 64 );
   if ( lstrcmpi( szBuf, &quot;SysListView32&quot; ) )  // This is not a list control,
so forget it
      return;

   if ( !m_wndListCtrl.GetSafeHwnd() ) // Do not subclass list control
twice!
      m_wndListCtrl.SubclassWindow( pWnd-&gt;GetSafeHwnd() );

   m_wndListCtrl.SetExtendedStyle( LVS_EX_HEADERDRAGDROP |
LVS_EX_SUBITEMIMAGES );
   m_wndListCtrl.ModifyStyle( LVS_LIST, LVS_REPORT );

   // Put additional code here
}
</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol27q5"></a><br>
    </p>
    <font color="Red"><h3>CFormView类的Fold按钮</h3>
    </font><p>问：我有一个SDI程序，视类继承CFormView，我想实现在屏幕上一个fold按钮，它能 
    隐藏或显现在屏幕任何适当的地方，但我不知道该怎么去做它。<br>
    </p>
    <p>答：我认为ResizeParentToFit并没有达到所期望的，通常在MS的文档说明中是用在MDI子窗口中 
    的，所以我们需要自己做函数所做的事情。 #define SIZE_TO_FOLD 
    your_dynamically_or_statically_calculated_value </p>
    <pre>
void CCashMachineView::OnBtnFold()
{
    static bool bUnfolded = true;
    CSize sizNew;
    CRect rc, rcMF;

    GetWindowRect(&amp;rc);
    AfxGetMainWnd()-&gt;GetWindowRect(&amp;rcMF);
    if(bUnfolded)   // fold
    {
        rc.bottom -= SIZE_TO_FOLD;
        rcMF.bottom -= SIZE_TO_FOLD;
    }
    else                // unfold
    {
        rc.bottom += SIZE_TO_FOLD;
        rcMF.bottom += SIZE_TO_FOLD;
    }
    bUnfolded = !bUnfolded;
    sizNew.cx = rc.right - rc.left - 5;
    sizNew.cy = rc.bottom - rc.top - 5;
    SetScrollSizes(MM_TEXT, sizNew);
    MoveWindow(0, 0, sizNew.cx, sizNew.cy);
    AfxGetMainWnd()-&gt;SetWindowPos(&amp;wndTop, 0, 0, rcMF.right - rcMF.left,
rcMF.bottom - rcMF.top, SWP_NOMOVE);
}
</pre>
    <p>这可能会带来些付作用，比如闪烁。<br>
    </p>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol27q6"></a><br>
    </p>
    <font color="Red"><h3>视的背景色</h3>
    </font><p>问：我写了一个SDI程序，是用vc5.0分析HTML文件，并显示出来，但我不知道如何 
    改变程序的背景色？<br>
    </p>
    <p>答：1）首先不知道您为什么要自己写一个HTML浏览器，你可以将MS 
    Web Browser控件插入 你的视中。在6.0中你可以使用CHtmlView类。5.0中你同样可以快速建立一个自己的 
    CHtmlView类（建立一个视关于ActiveX控件的）。<br>
    &nbsp;&nbsp;2）在OnCtlColor消息句柄返回所需的画刷。<br>
    </p>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol27q7"></a><br>
    </p>
    <font color="Red"><h3>隐藏控件台程序</h3>
    </font><p>问：我用MFC写了个控件台程序，现在我想让它在启动时隐藏或最小化，使用户尽可能减 
    少相互交流。<br>
    </p>
    <p>答：我认为一个方法是使用32位函数，你能使用FindWindow()得到窗口的句柄， 
    然后就使用ShowWindow函数。 </p>
    <pre>HWND hWnd = FindWindow( LPCTSTR lpClassName, LPCTSTR lpWindowName);
ShowWindow(hWnd, SW_SHOWMINIMIZED )</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol27q8"></a><br>
    </p>
    <font color="Red"><p>修改SDI窗口标题</font> 
    问：我们通常是用向导生成器来完成一个SDI框架，那么怎样才能设置窗口的标题？<br>
    答：1）试一下我程序中由向导生成的代码：<br>
    </p>
    <pre>GetDocument()-&gt;SetTitle(_T(&quot;Meaningful Title&quot;));</pre>
    <p>&nbsp;&nbsp;2）我认为你可以应用类中实现它，InitInstance函数，你有一个成员变量m_pMainWindow，所以 
    只要m_pMainWnd-&gt;SetWindowText(_T(&quot;Ur Text&quot;))就可以了，然后再运行 </p>
    <pre>    m_pMainWnd-&gt;ShowWindow(SW_SHOWNORMAL);
    m_pMainWnd-&gt;UpdateWindow();</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <hr>
    <a href="cmfcv28.htm"><p align="center">前一期</a>|<a href="cmfcv26.htm">后一期</a><br>
    <a href="http://mfc2000.yeah.net" target="_top">玉海园</a>[http://mfc2000.yeah.net]友情提供! 
    </td>
  </tr>
</table>

<p><a name="PageBegin"></a></p>
</body>
</html>
