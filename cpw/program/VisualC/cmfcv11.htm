<html>

<head>
<title></title>
</head>

<body>

<table border="0" width="100%" style="font-size: 9pt" cellspacing="0" cellpadding="2"
bgcolor="#E8E8E8">
  <tr>
    <td width="100%"><table border="1" width="32%" style="font-size: 9pt" height="30"
    cellspacing="0" cellpadding="2" bgcolor="#000000">
      <tr>
        <td width="100%" bgcolor="#4264B5"><p align="center"><font color="#FFFFFF">资料整理<span
        class="f">&middot;</span><a href="http://fasoft.yeah.net" target="_blank"
        style="color: rgb(255,255,255)">中国程序员网站</a></font></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%">　<table border="0" width="100%">
      <tr>
        <td width="100%"></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%"><font COLOR="#FF0000"><h2 align="center"></font><font color="#000000"><span
    style="font-size: 9pt">MFC邮递表的中文翻译</span></font><font COLOR="#FF0000"></h2>
    </font></td>
  </tr>
  <tr>
    <td width="100%"></td>
  </tr>
  <tr>
    <td width="100%">　<h3><font color="#000000">第十一期目录</font> <font SIZE="-1">Yu 
    Hail 1998.11.9</font></h3>
    <ol>
      <li><a HREF="#vol11q1">RegisterWindowMessage中的BroadcastSystemMessage如何处理?</a> </li>
      <li><a HREF="#vol11q2">CListCtrl中选择变化时如何获得通知?</a> </li>
      <li><a HREF="#vol11q3">如何向ATL-COM对象传送一个数组?</a> </li>
      <li><a HREF="#vol11q4">如何选择CTreeCtrl中的节点文本进行编辑?</a> </li>
    </ol>
    <p><a NAME="vol11q1"></a></p>
    <p><br>
    </p>
    <h3><font color="#000000">Q:RegisterWindowMessage中的BroadcastSystemMessage如何处理?</font></h3>
    <p><br>
    我想用BroadcastSystemMessage来在两个进程之间通讯,我从一个进程发送了一个用 
    RegisterWindowMessage注册过的消息,但在目的进程中却没有收到该消息.<br>
    A:我认为你应该在两个进程的最高级窗口中都注册该消息.请看下例:<br>
    </p>
    <pre>
static UINT sBroadcastCommand = ::RegisterWindowMessage( _T(&quot;BroadcastCommand&quot;));
BEGIN_MESSAGE_MAP( Gui_Top_Level_MainFrame, Gui_MainFrame )
    ON_REGISTERED_MESSAGE( sBroadcastCommand, onBroadcastCommand )
END_MESSAGE_MAP()
LRESULT Gui_MainFrame :: onBroadcastCommand( UINT aMsg, LPARAM lParam )
{
    your code...
}
</pre>
    <p>然后发送进行应该包含: </p>
    <pre>
While the sending process would contain:
static UINT sBroadcastCommand = ::RegisterWindowMessage( _T(&quot;BroadcastCommand&quot;));
void Someclass :: someMethod( void )
    {
    ::PostMessage( (HWND)HWND_BROADCAST,sBroadcastCommand, 0,yourMessageId );
    }
</pre>
    <p><a NAME="vol11q2"></a><br>
    </p>
    <h3><font color="#000000">Q:CListCtrl中选择变化时如何获得通知?</font></h3>
    <p><br>
    我在Report View中使用了一个CListCtrl(自绘制类型),我想知道什么时候选择项 
    发生了改变.<br>
    A:在选择项变化时,可以使用按钮有效或失效,按如下操作:<br>
    </p>
    <pre>
  加入LVN_ITEMCHANGED消息处理.
 void CYourClassNameHere::OnItemchangedEventList(NMHDR* pNMHDR, LRESULT* pResult)
{
 NM_LISTVIEW* pNMListView = (NM_LISTVIEW*)pNMHDR;
 *pResult = 0;

 if (pNMListView-&gt;uChanged == LVIF_STATE)
 {
  if (pNMListView-&gt;uNewState)
   GetDlgItem(IDC_DELETE)-&gt;EnableWindow(TRUE);
  else
   GetDlgItem(IDC_DELETE)-&gt;EnableWindow(FALSE);
 }
}
</pre>
    <p><a NAME="vol11q3"></a><br>
    </p>
    <h3><font color="#000000">Q:如何向ATL-COM对象传送一个数组?</font></h3>
    <p><br>
    我想创建一个函数来向ATL-COM对象传送数组.<br>
    A:如下代码的方法用于ACTIVEX中,可能对ATL-COM也有启发吧.<br>
    </p>
    <pre>
CoInitialize(NULL);
 CLSID m_clsid;
 USES_CONVERSION;
 ::CLSIDFromString(T2OLE(&quot;ROUNDANALOG.RoundAnlgAARCtrl.1&quot;), &amp;m_clsid);
 IDispatch FAR* pObj = (IDispatch FAR*)NULL;
 CString str = &quot;UpdateControl&quot;;
 BSTR bstr = str.AllocSysString();
 HRESULT hr = CoCreateInstance(m_clsid, NULL, CLSCTX_ALL, IID_IDispatch,
(void**)&amp;pObj);

 SafeArrayAccessData(psa, (void**)&amp;bstrArray);
 bstrArray[0] = str.AllocSysString();
 bstrArray[1] = str.AllocSysString();
 SafeArrayUnaccessData(psa);

VARIANTARG* pvars = new VARIANTARG[1];
 VariantInit(&amp;pvars[0]);
 pvars[0].vt = VT_ARRAY|VT_BYREF|VT_BSTR;
 pvars[0].pparray = &amp;psa;
 DISPID dispid;

 hr = pObj-&gt;GetIDsOfNames(IID_NULL, &amp;bstr, 1,LOCALE_USER_DEFAULT, &amp;dispid);

DISPPARAMS disp = {pvars, &amp;dispid, 1,1};
 hr = pObj-&gt;Invoke(dispid, IID_NULL,
LOCALE_USER_DEFAULT,DISPATCH_PROPERTYPUT,&amp;disp,NULL, NULL, NULL);
 delete[] pvars;
 pObj-&gt;Release();
 CoUninitialize();
</pre>
    <p>在你的控制中建立如下函数: </p>
    <pre>
void CRoundAnlgAARCtrl::SaveFunc(const VARIANT FAR&amp; var)
{
 // TODO: Add your dispatch handler code here
 ASSERT(var.vt == VT_ARRAY | VT_BYREF | VT_BSTR);
 SAFEARRAY* psa = *var.pparray;
}
</pre>
    <p><a NAME="vol11q4"></a><br>
    </p>
    <h3><font color="#000000">Q:如何选择CTreeCtrl中的节点文本进行编辑?</font></h3>
    <p><br>
    在向CTreeCtrl中加入一项后,有什么方法可以编辑该节点的文本呢?<br>
    A:首先设置你的CcompTreeCtrl具有TVS_EDITLABELS属性.在设计时用控件属性来设置 
    在运行时用GetStyle()/SetStyle()成员函数来设置.然后请看下述代码:<br>
    </p>
    <pre>
HTREEITEM CCompTreeCtrl::AddSet()
{
static int setCnt =3D 1;
HTREEITEM hItem;
CString csSet;

//create text for new note: New Set 1, New Set 2 ...
csSet.Format( _T( &quot;New Set %d&quot; ), setCnt++ );

hItem =3D InsertItem( csSet, IMG_CLOSEDFOLDER, IMG_CLOSEDFOLDER );

if( hItem !=3D NULL )
           EditLabel( hItem );

return hItem;
}
</pre>
    </td>
  </tr>
  <tr>
    <td width="100%"><hr>
    </td>
  </tr>
  <tr>
    <td width="100%" align="center"><a href="cmfcv12.htm">前一期</a>|<a href="cmfcv10.htm">后一期</a></td>
  </tr>
  <tr>
    <td width="100%" align="center"><a href="http://mfc2000.yeah.net" target="_top">玉海园</a>[http://mfc2000.yeah.net]友情提供! 
    </td>
  </tr>
</table>
<a href="cmfcv12.htm">

<p align="center"></a>　</p>
</body>
</html>
