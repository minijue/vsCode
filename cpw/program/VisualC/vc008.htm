<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>Visual C</title>
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
</head>

<body background="../../res/back.JPG">

<p align="center"><strong><span style="font-size: 9pt"><font face="Arial" size="4">Visual 
C</font><font size="4">＋＋中建立滚动视窗</font></span></strong></p>

<p align="center"><span style="font-size: 9pt">录入/江湖小子</span></p>

<p><span style="font-size: 9pt">滚动视窗在应用程序中十分有用，它可以使用户看到比显示器屏幕还大的窗口。下面有一个建立滚动视窗的实例，在该例中，不仅滚动条会与视窗相连，而且HOME、PAGE 
DOWN、PAGE UP和END方向键会与视窗相连。现将本例中需用到的函数和类作一些必要的说明。</span></p>

<p><span style="font-size: 9pt">CscrollView类：它是从Cview类派生出来的，可以支持窗口的滚动。<br>
GetsystemMetrics函数：它是Window中的函数，可以返回Windows显示屏幕的高度和宽度。<br>
OnCreate函数：若Windows发送调用。每次应用要求创建一个窗口时，WM－CREATE消息都会被发送。在本例中，Onc 
WM－CREATE消息，在本例中，Oncreate函数完成一些字初始化操作，如：设置窗口的大小，页的大小和滚动行的大小。<br>
SetScrollSizes它是滚动视窗在初始阶段必要的CscrollView类的成员函数。<br>
该程序的目的是建立一个三倍于屏幕的宽度和高度的大窗口，且有视窗的中央显示出一个大的矩形，视窗最大化时，用户只能看到矩形的1／9。通过滚动条或方向键，用户寸可以见到它的全貌，以下是建立滚动视窗的步骤：<br>
1、运行AppWizard来创建EX例程，其中的Options选项设为lnital Toolbar和Generate 
Source Comments。<br>
2、替换CEXCView类，用Visual Workbench的编辑器将ExView.h和ExView.cpp中所有的CVIEW替换成CScrollView。<br>
3、利用ClassWizard来加进对WM－CREATE和WM－KEYDOWN消息进行控制的函数，CLassWizard能够自动地生成Oncreate和OnkeyDown成员函数。<br>
4、对消息控制函数进行编辑。因为ClassWizard已经自动地为我们生成了函数的框架，因此，用户只需找到这些框架加入代码即可。<br>
在OnCreate函数的returm－1语句后中加入代码：<br>
CSize totalSize=CSize(::GetSystemMetrics(SM-CXSCREEN)*3,<br>
::GetSystemMetrics(SM-CYSCREEN)*3);<br>
CSize pageSize=CSize(totalSize.cx/3,totalSize.cy/3);<br>
CSize lineSize=CSize(totalSize.cx/100,totalSize.cy/100);<br>
SetScrollSizes(MM-TEXT,totalSize,pageSize,lineSize);<br>
在OnKeyDowm函数中加入代码:<br>
switch(nChar){<br>
case VK-HOME:<br>
OnScroll(SB-VERT,SB-TOP,0);<br>
OnScroll(SB-HORZ,SB-TOP,0);<br>
break;<br>
case VDK-END:<br>
OnScroll(SB-VERT,SB-BOTTOM,0);<br>
break;<br>
case VK-UP:<br>
OnScroll(SB-VERT,SB-LINEUP,0);<br>
break;<br>
case VK-DOWN:<br>
OnScroll(SB-VERT,SB-LINEDOWN,0);<br>
break;<br>
case VK-PRIOR;<br>
OnScroll(SB-VERT,SB-PAGEUP,0);<br>
break;<br>
case VK-NEXT;<br>
OnScroll(SB-VERT,SB-PAGEDOWN,0);<br>
break;<br>
case VK-LEFT;<br>
OnScroll(SB-HORZ,SB-PAGEUP,0);<br>
break;<br>
case VK-RIGHT;<br>
OnScroll(SB-HORZ,SB-PAGEDOWN,0);<br>
break;<br>
default:<br>
break;<br>
}<br>
在OnDraw函数中加入以下代码来代替OnDraw函数中原来的代码：<br>
int x=::GetSystemMetrics(SM-CXSCREEN);<br>
int y=::GetSystemMetrics(SM-CYSCREEN);<br>
pDC-&gt;SelectStockObject(GRAY-BRUSH);<br>
pDC-&gt;Rectangle(CRect(x-300,y-300,x+300,y+300));<br>
5、创建,执行程序,在Visual Workench中,在Project菜单中选择Build,然后再选择Execute,程序就会在滚动视窗中显示一个大的正方形,用户可以通过滚动条和HOME等方向键来观察它。<br>
</span></p>
</body>
</html>
