<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb_2312-80">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title></title>
</head>

<body bgcolor="#8080C0">
<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="95%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="Vcidx098.htm">Visual 
    C++/C++</a> --&gt;</b> MFC邮递表的中文翻译(第三十四期)</span></td>
  </tr>
</table>
</center></div><div align="center"><center>

<table border="1" width="95%" style="font-size: 9pt" bgcolor="#FFFFFF"
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">
  <tr>
    <td width="100%"><table border="1" width="32%" style="font-size: 9pt" height="30"
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"
    bordercolordark="#FFFFFF">
      <tr>
        <td width="100%" bgcolor="#4264B5"><p align="center"><font color="#FFFFFF">资料整理<span
        class="f">&middot;</span><a href="http://chinaprog.yeah.net" target="_blank"
        style="color: rgb(255,255,255)">中国程序员网站</a></font></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%">　<h2 align="center"><span style="font-size: 9pt">MFC邮递表的中文翻译</span></h2>
    <p>&nbsp;&nbsp;&nbsp;&nbsp;我是一名mfc程序设计的爱好者,订阅了mfc的maillist,利用业余时间 
    将它翻译出来,希望能对mfc编程的朋友有所帮助,请朋友们指正.<br>
    </p>
    <h3><font color="#FF0000">第三十四期目录</font> <font size="2">杨晓东 1999.4.20</font></h3>
    <ol>
      <li><a href="#volq1">不能Disable在对话条中的按钮</a> </li>
      <li><a href="#volq2">取得一个图标的句柄</a> </li>
      <li><a href="#volq3">CCheckListBox中的水平滚动条</a> </li>
      <li><a href="#volq4">VC的使用</a> </li>
      <li><a href="#volq5">滚动条中的光标键</a> </li>
      <li><a href="#volq6">编译消息</a> </li>
      <li><a href="#volq7">显示工具条</a> </li>
      <li><a href="#volq8">在树形控件中改变字体</a> </li>
      <li><a href="#volq9">CInternet类与代理</a> </li>
    </ol>
    <p><a name="volq1"></a></p>
    <p><br>
    </p>
    <font color="Red"><h3>不能Disable在对话条中的按钮</h3>
    </font><p>问：我想在一个对话条中Disable一个按钮(注意不是对话框)，我想让按钮能在程序启动 
    时为Disable状态，所以我在对话模板中已经置为Disable，但当我每次运行这个程序时 
    这个按钮一直是Enable的，我也试过在启动之后调用代码来Disable它，我是这样做的： 
    </p>
    <pre>m_wndDlgBar.GetDlgItem(IDC_MY_BUTTON)-&gt;EnableWindow(FALSE);</pre>
    <p>&nbsp;&nbsp;可惜它依然不能正确动作。EndableWindow返回非零值，按钮仍然为Enable状态。事实上 
    在程序伊始有一短暂的时间是Disable的，但一会儿就变成Enable.</p>
    <p>答:<ol>
      <li>关于对话条以及工具条不能用EnableWindow()函数，正确的方法应该是这样<br>
        <pre>pCmdUI-&gt;Enable(FALSE); </pre>
      </li>
      <li>我认为对话条中应该使用ON_UPDATE_CMDUI消息,如果你的按钮是处理[ON_COMMAND] 
        而不是update方法,缺省的情况会将按钮enable.</li>
    </ol>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq2"></a><br>
    </p>
    <font color="Red"><h3>取得一个图标的句柄</h3>
    </font><p>问:我有一个16x16的图标想用在CListCtrl中,但它需要一个HICON句柄,怎样我才能 
    从我的图标的ID中取得句柄</p>
    <p>答: <ol>
      <li>下面的方法可以取得图标的句柄 <pre>HICON hIcon = NULL;

hIcon = LoadIcon(IDI_YOURICONID);</pre>
      </li>
      <li>下面的方法可能烦一些,但完全能解决你的问题.建立一个新的位图文件,尺寸为 
        16.它的ID为IDB_IMAGE,贴到你的IDI_IMAGE(图标),接着建立imagelist时使用 
        这个位图的ID.比如:<br>
        <pre>void CMyListView::OnInitialUpdate()

{

    CListView::OnInitialUpdate();



    // TODO: Add your specialized code here and/or call the base class



    m_pImageList = new CImageList();

    m_pImageList-&gt;Create(IDB_IMAGE, 16, 1, RGB(0,0,0));

    GetListCtrl().SetImageList(m_pImageList, LVSIL_SMALL);  /* set

extended stlyes*/



}</pre>
      </li>
    </ol>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq3"></a><br>
    </p>
    <font color="Red"><h3>CCheckListBox中的水平滚动条</h3>
    </font><p>问:CCheckListBox使用了OWNERDRAWFIXED类型,用来显示一些文件名,所以有时那比显示区 
    域大一些,但我不能让滚动条显示出来.为了显示滚动条,我试过了OWNERDRAWVERIABLE类型,重 
    载了DrawItem()和MeasureItem(),都不行.</p>
    <p>答:要让列表框拥有水平滚动条,你必须设置WS_HSCROLL,并设置基本显示的宽度, 
    这可以用CListBox::SetHorizontalExtent来实现.</p>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq4"></a><br>
    </p>
    <font color="Red"><h3>VC的使用</h3>
    </font><p>问:我们在使用VC中总是遇到这样一个对话框,&quot;This file has 
    been modified outside of the source editor. Do you want to reload it?&quot;,每次都是在我们保存文件时,大概在 
    按下CTRL-S的两秒钟之后.为什么会这样?</p>
    <p>答: <ol>
      <li>我注意到在发生这种情况的时候通常都是该文件窗口在IDE编辑窗口的最底下,如果我使用 
        &quot;Find in Files&quot;操作,而这些文件不仅是项目中的文件还包括象.ncb 
        .aps .plg .opb文件等, 又没有关闭那些文件,那么在我建立项目时就会得到象你一样的对话框.<br>
      </li>
      <li>你有没有设置你机器的时间?可能是由于时间的关系.<br>
      </li>
      <li>这可能是与网络有关,你的服务器可能有缓冲,并不马上保存你的文件.所以你可以关闭 
        缓冲区,然后检查一下问题是否还出现或者你就直接在硬盘上使用.<br>
      </li>
    </ol>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq5"></a><br>
    </p>
    <font color="Red"><h3>滚动条中的光标键</h3>
    </font><p>问:我正使用Window的滚动条,除了用鼠标操作外,我还想使用光标键来实现滚动,该怎么办?</p>
    <p>答: <ol>
      <li>使用ClassWizard来处理WM_KEYDOWN消息,会自动生成一个函数,在这个函数里, 
        你可以得知按键消息从而完全你所期望的动作.(比如说在从CScrollView的继承类调用 
        ScrollToPosition()函数,在一个CWnd对象中调用OnVScroll()函数)<br>
      </li>
      <li>你可以看一下方法CWnd.OnKeyDown()和CWnd.OnChar()的帮助(这些事件也是CView类中的一部分) 
        OnKeyDown()第一个参数给出按下键的代码,你可以该函数里面置入一个断点来察看每个光标键的 
        代码,你可以在此基础上实现你要做的处理.<br>
      </li>
    </ol>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq6"></a><br>
    </p>
    <font color="Red"><h3>编译消息</h3>
    </font><p>问:我在编译时遇上这种提示消息: </p>
    <pre>error C2258: illegal pure syntax, must be '= 0'

error C2252: 'THIS_FILE' : pure specifier can only be specified for functions</pre>
    <p>错误周围的代码是这样的: </p>
    <pre>#ifdef _DEBUG

#undef THIS_FILE

static char THIS_FILE[]=__FILE__;

#define new DEBUG_NEW

#endif</pre>
    <p>到底怎么回事?</p>
    <p>答: <ol>
      <li>遇到这种情形通常是在包含文件中有一个语法错误,象语句后面少了一个;号.<br>
      </li>
      <li>只是猜测一下,察看一下#include的文件,可能里面的括号或其他并不搭配.所以可能将 
        &quot;static char THIS_FILE[]=__FILE__;&quot;之类的语句理解为类中的成员函数声明 
      </li>
      <li>我不能确定下面会解决这个问题,但换了我是你,我会<br>
        <ul>
          <li>检查在include文件中是否有&quot;)&quot;,&quot;}&quot;搭配不正确或缺少了&quot;;&quot;.<br>
          </li>
          <li>这个代码块是否是全局的.<br>
          </li>
          <li>重定义__FILE__是否会产生错误?<br>
          </li>
        </ul>
      </li>
    </ol>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq7"></a><br>
    </p>
    <font color="Red"><h3>显示工具条</h3>
    </font><p>问:在我的程序中想在有些窗口打开或关闭时显示,隐藏某些工具条,这些我也都做到了,但 
    我一直不能将那些工具条放置到我想放的位置,我的主工具条非常小,它的右边可以放些工 
    具条(这就是我所想的)但它们总是显示在主工具条的下方.</p>
    <p>答:我从一个示例文件中找到我现在的代码(抱歉我已经记不清从哪儿得来了). 
    </p>
    <pre>I use the following code which I snitched from one of the examples (sorry,

don't remember where).



int CMainFrame::OnCreate(LPCREATESTRUCT lpCreateStruct)

{

......

// create scalebar toolbar as generated by MFC wizard

....

    DockControlBarLeftOf(&amp;m_wndScaleBar,&amp;m_wndToolBar );

}



void CMainFrame::DockControlBarLeftOf(CToolBar* Bar,CToolBar* LeftOf)

{

    CRect rect;

    DWORD dw;

    UINT n;



    // get MFC to adjust the dimensions of all docked ToolBars

    // so that GetWindowRect will be accurate

    RecalcLayout();

    LeftOf-&gt;GetWindowRect(&amp;rect);

    rect.OffsetRect(1,0);

    dw=LeftOf-&gt;GetBarStyle();

    n = 0;

    n = (dw&amp;CBRS_ALIGN_TOP) ? AFX_IDW_DOCKBAR_TOP : n;

    n = (dw&amp;CBRS_ALIGN_BOTTOM &amp;&amp; n==0) ? AFX_IDW_DOCKBAR_BOTTOM : n;

    n = (dw&amp;CBRS_ALIGN_LEFT &amp;&amp; n==0) ? AFX_IDW_DOCKBAR_LEFT : n;

    n = (dw&amp;CBRS_ALIGN_RIGHT &amp;&amp; n==0) ? AFX_IDW_DOCKBAR_RIGHT : n;



    // When we take the default parameters on rect, DockControlBar will dock

    // each Toolbar on a seperate line.  By calculating a rectangle, we in effect

    // are simulating a Toolbar being dragged to that location and docked.

    DockControlBar(Bar,n,&amp;rect);

}</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq8"></a><br>
    </p>
    <font color="Red"><h3>在树形控件中改变字体</h3>
    </font><p>问:我想在一个树形控件中改变字体,但我得不到预期的效果,我调用m_TreeCtrl.SetFont(pFont, 
    bRedraw) 其中pFont是一个有效CFont对象,bRedraw设置为真,树形控件收到了WM_SETFONT消息,但 
    将我所想改的字体属性全部改了,变成<br>
    1.不管设置什么字体,都是System Bold<br>
    2.两个节点间的间隔变成了能容纳变动后的字体的大小,比如选择48pts,那么该控件的<br>
    每项都变得很大以保证48pts的字体.<br>
    3.有时在一些项目的最后几个字符少了.</p>
    <p>答:看上去你所使用的CFont在SetFont()调用后被破坏了.你不能使用局部实例对象, 
    CFont的析构函数会删除HFONT对象,所以树形控件得到了一个不正确的选择字体.<br>
    &nbsp;&nbsp; 为了确保CFont全局性,你可以在你的视类中定义.<br>
    <a href="#PageBegin"></p>
    <p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq9"></a><br>
    </p>
    <font color="Red"><h3>CInternet类与代理</h3>
    </font><p>问:我的问题是关于MFC的Internet类,或者说是他们给我带来一个问题<br>
    &nbsp;&nbsp; 主要是关于internet的设置,当我使用FTP时需要对代理服务器进行设置,MSDN中对MFC的 
    internet类以及internet API的描述中说明支持两种代理服务器:TIS以及GERN,分别用以 
    处理以下情况:<br>
    &nbsp;&nbsp; &quot;Win32 Internet函数仅支持GERN类型的代理服务(只能是HTTP)以及TIS的FTP网关(只 
    能是FTP).如果安装了微软的IE,那么Win32 Internet类也支持SOCK代理.FTP和Gopher 
    需要由一个GERN类型代理转变为一个HTTP的请求&quot;--MSDN 
    &quot;InternetOpen&quot;<br>
    &nbsp;&nbsp; 可是CInternetSession文档并没有给出关于这方面的更多的信息.CInternetSession类中的数据 
    数据成员dwAccessTyppe仅允许用&quot;INTERNET_OPEN_TYPE_PROXY Through CERN 
    proxy.&quot;来指定 GERN代理,否则的话就只能指定为&quot;INTERNET_OPEN_TYPE_DIRECT 
    Direct to Internet&quot;,或者 &quot;INTERNET_OPEN_TYPE_PRECONFIG Preconfigured &quot;. 
    而这也是缺省处理<br>
    &nbsp;&nbsp; 而当能够指定GERN代理时怎样取得TIS代理?,如果我完全按照这上面的说法用INTERNET_OPEN_TYPE_PROXY 
    来指定一个GERN代理,那我还必须取得一个&quot;GERN代理的名字,缺省值是NULL&quot;,我猜测这FTP是不可能的? 
    如果回答是肯定的话,那么怎样才能从代理服务中以FTP方式联接?同样的我也不能猜出&quot;GERN代理服务器 
    的名字&quot;是一个地址?IP地址?某人的姓名?或者...?<br>
    &nbsp;&nbsp; 怎样我才能通过TIS代理联接?如果IE已经安装,那我又该如何通过SOCKS来联接?</p>
    <p>答:我开发了一个简单的的FTP客户程序,使用的是我的代理服务器/防火墙,下面是我程序中的 
    片断. </p>
    <pre>m_pInetSession = new CInternetSession(NULL, 1, PRE_CONFIG_INTERNET_ACCESS);



....

sprintf (st,&quot;anonymous@%s&quot;,(LPCSTR)m_Site);

m_pFtpConnection =

m_pInetSession-&gt;GetFtpConnection(&quot;192.168......&quot;,st,&quot;gianni.franchi@mmedia.it&quot;);</pre>
    <p>你在GetFtpConnection函数的第一个参数中指定代理服务器的地址(我的代理服务器的地址 
    是 192.168...) <a href="#PageBegin"></p>
    <p align="right">回到本期目录</a><br>
    </p>
    <hr>
    <a href="cmfcv35.htm"><p align="center">前一期</a>|<a href="cmfcv33.htm">后一期</a><br>
    <a href="http://mfc2000.yeah.net" target="_top">玉海园</a>[http://mfc2000.yeah.net]友情提供! 
    </td>
  </tr>
</table>
</center></div>

<p><a name="PageBegin"></a></p>
</body>
</html>
