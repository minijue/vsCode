<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>您现在的位置是</title>
</head>

<body>

<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="100%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="../../progidx.htm">编程技巧</a> --&gt; 
      <a href="../Vcidx098.htm">VisualC++</a></b></span></td>    
  </tr>    
</table>    
</center></div><div align="center"><center>    
    
<table border="1" width="100%" style="font-size: 9pt" bgcolor="#FFFFFF"    
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">    
  <tr>    
    <td width="85%" align="left" valign="top"><table border="1" width="32%" style="font-size: 9pt" height="30"    
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"    
    bordercolordark="#FFFFFF">    
      <tr>    
        <td width="100%" bgcolor="#4264B5"><p align="center"><span style="font-size: 9pt"><font    
        color="#FFFFFF">资料整理&middot;<a href="http://chinaprog.yeah.net" target="_blank"    
        style="color: rgb(255,255,255)">中国程序员网站</a></font></span></td>    
      </tr>    
    </table>    
      <p align="center">自解密的加密程序的制作<br>
      <br>
                                (浙江 吴善磊)     
      <p><br> 
      <br> 
      　　为了保证自己的数据不被别人非法地窃取，有必要对数据文件进行适当地加密。本程序采取一定的算法，对密码和数据进行加密，生成一个自解密的EXE文件。这个自解密文件是由两部分组成的。第一部分为可执行代码部分，其作用是对密码进行判断，对数据进行解密；后一部分是被加过密的密码和数据。<br>
      　　本程序分两个模块进行编写。第一个是main.c，它是用来进行加密，产生EXE文件的；第二个是main2.c，它是用来解密的。分别对它们进行编译生成main.exe和main2.exe，再对其进行合并即可。<br>
      　　合并方法如下：<br>
      　　COPY /B main.EXE＋main2.EXE Key.EXE(注意main.EXET和main2.EXE的顺序)<br> 
      　　使用时请按下列格式键入。<br>
      　　Key〈欲加密文件〉〈产生后的EXE文件名〉<br>
      　　按提示输入密码后将生成指定的可执行文件。解密时运行这个可执行文件。输入密码后(若输入三次都不正确，将退出解密程序)，即把原文件内容还原到你指定的文件中。解密程序格式如下。<br>
      　　可执行文件名 (filename)<br> 
      　　源程序如下：<br>
      　　第一个源代码文件 main.c<br> 
      　　＃include “stdio.h”<br> 
      　　main (int argc,char ＊argv[])<br> 
      　　{FILE ＊fp0, ＊fp1, ＊fp2;<br> 
      　　char ch,＊password,i,str[10];password=str;<br> 
      　　if(argc!=3)<br>
      　　{printf(“usage:key ");<br> 
      　　exit(0);<br>
      　　}<br>
      　　if((fp0=fopen(argv[0],“rb"))=NULL)<br>
      　　{printf(“can`t open ％s",argv[0]);<br> 
      　　exit(0)<br>
      　　}<br>
      　　if((fp1=fopen(argv[1],“r"))=NULL)<br>
      　　{printf(“can`t open ％s")argv[1]);<br> 
      　　exit(0);<br>
      　　}<br>
      　　if((fp2=fopen(argv[2],“wb"))=NULL)<br>
      　　{printf(“can`t open ％s",argv[2]);<br> 
      　　}<br>
      　　password=(char ＊)getpass(“please input password:");<br> 
      　　fseek(fp0,1394OL,SEEK_SET);/＊ 13940是main.exe文件的长度，不同的工作环境会有不同的值。请以实际长度加以修改 ＊/<br> 
      　　while(!feOf(fp0))<br>
      　　fputc(fgetc(fp0),fp2);/＊把main2.exe输入fp2指定的文件中＊/<br>
      　　for(i=0;password[i]!=`10`；i＋＋)<br>
      　　{fputc((i＋password[i])&amp;i,fp2);/＊将密码加密后写入文件＊/<br>
      　　}<br>
      　　fputc(`10`,fp2), /＊将“10”放入密码后 ＊/<br> 
      　　do{<br>
      　　{for(i=0;password[i]!=`10`,i＋＋<br>
      　　{ch=fgetc(fp1) /＊从欲加密文件读一个字符＊/<br> 
      　　if(feof(fp1))break;<br>
      　　ch=ch&amp;password[i];<br>
      　　ch＋=i;<br>
      　　ch=nch; /＊将此字符同密码i值进行运算后写入fp2指定文件＊/<br> 
      　　fputc(ch,fp2)；<br>
      　　}<br>
      　　}While(!feof(fp1))；<br>
      　　fcloseal(c);<br>
      　　}<br>
      　　第二个源代码文件main2.c<br>
      　　＃include “stdio.h"<br> 
      　　＃include “string.h"<br> 
      　　main(int argc,char ＊argv[])<br> 
      　　{FILE ＊FP0,＊FP1;<br> 
      　　char ＊password,old password[10],str[10],ch,i;<br> 
      　　if(argc!=2)<br>
      　　{printf(“Usage=％s",argv[0]);<br>
      　　exit(o);<br>
      　　}<br>
      　　fseek(fp0,16888L,SEEK_SET); /＊同理16888也视实际情况而定＊/<br> 
      　　fgetc(fp0); /＊读掉一个无效字符＊/<br> 
      　　for(i=0;(oldpassword[i]=fget((fp0))!=`10`;i＋＋)<br>
      　　Oldpassword[i]=(oldpassword[i]&amp;i)－i; /＊对密码进行还原＊/<br> 
      　　oldpassword[i]=`10`; /＊把“10”藏于密码后 ＊/<br> 
      　　password=(char ＊)getpass(“please input password:");<br> 
      　　for(i=0;i　　{if(strcmp(password,oldpassword))<br>
      　　{password=(ch ＊)getpass(“<br> 
 password is wrong.&nbsp;<br>
      please input agai:");<br> 
      　　if(i==2)<br>
      　　{printf(“<br>
 press any Key to exit……<br> 
      ");<br> 
      　　getch();exit(o)<br>
      　　}<br>
      　　}<br>
      　　}/＊对密码进行判断，有三次机会，都不正确则返回到操作系统＊/<br>
      　　do{<br>
      　　for (i=0;password[i]!=`10`;i＋＋)<br> 
      　　{ch=fgetc(fp0);<br>
      　　if(feof(fp0))break;<br>
      　　ch=nch;<br>
      　　ch－=i;<br>
      　　ch&amp;=password[i];<br>
      　　}<br>
      　　}while(!feof(fp0);<br>
      　　fcloseal(c);<br>
      　　{<br>
      　　上述程序在COMPAQ 586.TC2.0集成环境里通过。     
    </td>     
  </tr>     
</table>     
</center></div>     
<p>　</p> 
 
</body> 
 
</html> 
