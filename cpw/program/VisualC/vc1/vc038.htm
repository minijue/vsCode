<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>您现在的位置是</title>
</head>

<body>

<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="100%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="../../progidx.htm">编程技巧</a> --&gt; 
      <a href="../Vcidx098.htm">VC</a></b></span></td>      
  </tr>      
</table>      
</center></div><div align="center"><center>      
      
<table border="1" width="100%" style="font-size: 9pt" bgcolor="#FFFFFF"      
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">      
  <tr>      
    <td width="85%" align="left" valign="top"><table border="1" width="32%" style="font-size: 9pt" height="30"      
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"      
    bordercolordark="#FFFFFF">      
      <tr>      
        <td width="100%" bgcolor="#4264B5"><p align="center"><span style="font-size: 9pt"><font      
        color="#FFFFFF">资料整理&middot;<a href="http://chinaprog.yeah.net" target="_blank"      
        style="color: rgb(255,255,255)">中国程序员网站</a></font></span></td>      
      </tr>      
    </table>      
      <p align="center">如何在VC5下定制多媒体真彩封页<br>
      <br>
                 辽宁省铁岭市委办公室   宋立波       
      <p>----在自己的应用程序定制多媒体真彩封页，可以使应用程序在显示名称和版权特性时丰富程序界面，避免由于应用程序启动前进行大量数据初始化时用户进行较长时间的空等待过程，在给应用程序增加了生动特性和专业特性的同时，也起到了宣传和广告的作用。虽然VC5中具有特定的类来实现这一功能，但通过定制自己的应用程序多媒体启动封页，还可使自己的应用程序别具一格。VC5中的实现步骤：<br> 
      <br> 
      ----一、制作封页位图：制作应用程序多媒体启动封页真彩位图，记录位图的高度和宽度，建立所需要的其它多媒体声音等文件；<br> 
      <br> 
      ----二、建立应用程序：利用FILE->NEW菜单建立名为START的多文档应用程序框架，并利用类向导AppWizard增加基类为generic CWnd的新类CSplashWnd，将新类的文件改名为splash.h和splash.cpp，并增加WM_CREATE和WM_PAINT的消息映射函数；<br> 
      <br> 
      ----三、定义变量和函数：在splash.h中定义如下成员变量和函数：<br> 
      <br> 
      public:<br> 
      BOOL Create(CWnd* pParentWnd=NULL);<br> 
      HANDLE hBitsSrc;<br> 
      LPSTR pBitsSrc;<br> 
      UINT iW,iH;<br> 
      <br> 
      ----四、建立启动封页窗口：在splash.cpp中增加Create函数，建立显示位图的弹出窗口：<br> 
      <br> 
      #include "windowsx.h"//增加扩展窗口建立<br> 
      ......<br> 
      struct{//位图文件头结构<br> 
      BITMAPINFOHEADER Header;<br> 
      }Info;<br> 
      BOOL CSplashWnd::Create(CWnd* pParentWnd)<br> 
      { //建立显示位图的弹出窗口<br> 
      return CreateEx(0,AfxRegisterWndClass(0,<br> 
      AfxGetApp()- >LoadStandardCursor(IDC_ARROW)),<br> 
      NULL,WS_POPUP|WS_VISIBLE,0,0,672,480,<br> 
      pParentWnd- >GetSafeHwnd(),NULL);<br> 
      }<br> 
      int CSplashWnd::OnCreate(LPCREATESTRUCT lpCreateStruct)<br> 
      { ......<br> 
      // TODO: Add your specialized creation code here<br> 
      CenterWindow();//使弹出窗口居中<br> 
      return 0;<br> 
      }<br> 
      <br> 
      ----五、完善析构函数：在splash.cpp中完善析构函数，为显示位图作准备：&nbsp;<br>
      <br>
      CSplashWnd::CSplashWnd()//完善析构函数<br>
      { iW=672;iH=480;//位图的宽度和高度<br> 
      Info.Header.biSize=sizeof(BITMAPINFOHEADER);<br> 
      Info.Header.biWidth=iW;<br> 
      Info.Header.biHeight=iH;<br> 
      Info.Header.biPlanes=1L;<br> 
      Info.Header.biBitCount=24L;<br> 
      hBitsSrc=::GlobalAlloc(GHND,(long)(iW*iH*3));//分配内存<br> 
      pBitsSrc=(LPSTR)::GlobalLock(hBitsSrc);//加锁内存<br> 
      }<br> 
      CSplashWnd::~CSplashWnd()<br> 
      { ::GlobalUnlock(hBitsSrc);//解锁内存<br> 
      ::GlobalFree(hBitsSrc);//释放内存<br> 
      }<br> 
      <br> 
      ----六、显示真彩位图：在splash.cpp中完善Onpaint函数，实现真彩位图<br> 
      的显示：&nbsp;<br>
      <br>
      void CSplashWnd::OnPaint()<br> 
      {......// TODO: Add your message handler code here<br> 
      CFile fbmp;<br> 
      fbmp.Open("c:\\windows\\EMC1.BMP",CFile::modeRead|<br> 
      CFile::typeBinary|CFile::shareExclusive);//打开文件<br> 
      fbmp.Seek(54,CFile::begin);//位图文件头为54字节<br> 
      fbmp.ReadHuge(pBitsSrc,(long)(iW*iH*3));//读文件<br> 
      fbmp.Close();//关闭文件<br> 
      HBITMAP hBitmap=::CreateDIBitmap(dc.m_hDC,<br> 
      (BITMAPINFOHEADER FAR*)&amp;(Info.Header),CBM_INIT,<br> 
      pBitsSrc,(LPBITMAPINFO)&amp;Info,DIB_RGB_COLORS);//建立位图<br> 
      HDC hMemDC=::CreateCompatibleDC(dc.m_hDC);//建立内存<br> 
      HBITMAP hBitmapOld=SelectBitmap(hMemDC,hBitmap);//选择对象<br> 
      ::StretchBlt(dc.m_hDC,0,0,iW,iH,hMemDC,<br> 
      0,0,iW,iH,SRCCOPY);//显示真彩位图<br> 
      ::DeleteObject(SelectObject(hMemDC,hBitmapOld));//删除位图<br> 
      }<br> 
      <br> 
      ----七、弹出窗口类声明：在Mainfrm.h中增加代码，为显示和撤销弹<br> 
      出窗口作准备：<br> 
      <br> 
      class CsplashWnd;//闪烁窗口类<br> 
      ......<br> 
      class CMainFrame : public CMDIFrameWnd<br> 
      {......<br> 
      public:<br> 
      CSplashWnd SplashWnd;//声明类<br> 
      <br> 
      ----八、真彩封页的实现：在Mainfrm.cpp中增加显示弹出窗口、播放音乐、<br> 
      延时功能和撤销弹出窗口的代码，以实现真彩封页的整个处理过程：<br> 
      <br> 
      #include "splash.h" //新类支持<br> 
      #include "mmsystem.h"//多媒体支持<br> 
      #pragma comment(lib,"WINMM.LIB")//多媒体支持<br> 
      ......<br> 
      int CMainFrame::OnCreate(LPCREATESTRUCT lpCreateStruct)<br> 
      {<br> 
      SplashWnd.Create(this);//创建弹出窗口<br> 
      SplashWnd.ShowWindow(SW_SHOW);//显示弹出窗口<br> 
      SplashWnd.UpdateWindow();//更新弹出窗口<br> 
      int dd=sndPlaySound("c:\\windows\\reminder.wav",<br> 
      SND_ASYNC|SND_LOOP);//异步播放WAV文件<br> 
      if (dd==FALSE){//参数SND_ASYNC|SND_LOOP可循环播放<br> 
      AfxMessageBox("播放WAV文件错误~");<br> 
      }<br> 
      ::Sleep(2000);//进程休眠2秒<br> 
      ......//应用程序初始化工作<br> 
      dd=sndPlaySound("",SND_ASYNC);//终止播放.WAV文件<br> 
      SplashWnd.DestroyWindow();//撤消弹出窗口<br> 
      return 0;<br> 
      }<br> 
      <br> 
      ----经过上述八个步骤的处理，整个多媒体真彩启动封页制作完毕。读者还可根据需要增加动画和移动字幕等其它多媒体效果。 
      <br>
    </td>     
  </tr>     
</table>     
</center></div>     

</body>

</html>
