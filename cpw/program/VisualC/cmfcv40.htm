<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb_2312-80">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title></title>
</head>

<body bgcolor="#8080C0">
<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="95%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="Vcidx098.htm">Visual 
    C++/C++</a> --&gt;</b> MFC邮递表的中文翻译(第四十期)</span></td>
  </tr>
</table>
</center></div><div align="center"><center>

<table border="1" width="95%" style="font-size: 9pt" bgcolor="#FFFFFF"
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">
  <tr>
    <td width="100%"><table border="1" width="32%" style="font-size: 9pt" height="30"
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"
    bordercolordark="#FFFFFF">
      <tr>
        <td width="100%" bgcolor="#4264B5"><p align="center"><font color="#FFFFFF">资料整理<span
        class="f">&middot;</span><a href="http://chinaprog.yeah.net" target="_blank"
        style="color: rgb(255,255,255)">中国程序员网站</a></font></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%">　<h2 align="center"><span style="font-size: 9pt">MFC邮递表的中文翻译</span></h2>
    <p>&nbsp;&nbsp;&nbsp;&nbsp;我是一名mfc程序设计的爱好者,订阅了mfc的maillist,利用业余时间 
    将它翻译出来,希望能对mfc编程的朋友有所帮助,请朋友们指正.<br>
    </p>
    <h3><font color="#FF0000">第四十期目录</font> <fontsize="2">杨晓东 1999.6.1</h3>
    <ol>
      <li><a href="#volq1">怎样才在一个子窗口中包含两个文档、两个视？</a> </li>
      <li><a href="#volq2">建立Active X有困难</a> </li>
      <li><a href="#volq3">组合框中的多重选择</a> </li>
      <li><a href="#volq4">调用在DLL中的一个图标</a> </li>
      <li><a href="#volq5">从别的类刷新CEditView</a> </li>
    </ol>
    <p><a name="volq1"></a></p>
    <p><br>
    </p>
    <font color="Red"><h3>怎样才在一个子窗口中包含两个文档、两个视？</h3>
    </font><p>问：我有两个文档CMyDoc1 和 CMyDoc2. 其中CMyDoc2继承于CMyDoc1。 
    我的程序中有一个视CMyTreeView 是继承于CTreeView。几个类的关系 
    如下：文档类obCMyDoc1与ob1CMyTreeView相关联，文档类obCMyDoc2 与ob2CMyTreeView相关联。我想在一个子窗口中包含以上几个，该怎 
    么处理？</p>
    <p>答：VC6允许你建立一个explorer类型的应用程序。我建立了一个并改变了右边视 
    的类型。在应用程序向导中不允许改变左边的视，但我通过修改OnCreateClient（） 
    同样可以实现。我希望这样能对你有所帮助。<br>
    </p>
    <pre>BOOL CMainFrame::OnCreateClient(LPCREATESTRUCT /*lpcs*/,
    CCreateContext* pContext)
{
    // create splitter window
    if (!m_wndSplitter.CreateStatic(this, 1, 2))
        return FALSE;

    if (!m_wndSplitter.CreateView(0, 0, RUNTIME_CLASS(CSplitTestView),
CSize(100, 100), pContext) ||
        !m_wndSplitter.CreateView(0, 1,
RUNTIME_CLASS(CSplitTestView), CSize(100, 100), pContext))
    {
        m_wndSplitter.DestroyWindow();
        return FALSE;
    }

    return TRUE;
}</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq2"></a><br>
    </p>
    <font color="Red"><h3>建立Active X有困难</h3>
    </font><p>问：我准备动态建立一个Active X控件，我的应用程序没有使用文档/视。 
    CMainFrame是在CWinApp的InitInstance建立的，应用程序是独立的，建立 
    时指定了窗口的大小。但当我于其中建立一个 ActiveX控件时， 
    CWind::InitControlContainer()出错，这段包含在Occcont.cpp.</p>
    <p>答： <ul>
      <li>试一下在CSimpleExtMFCApp::InitInstance()的开始处增加一句： <pre>AfxEnableControlContainer() </pre>
      </li>
      <li>我想你是在主窗口中建立一个ActiveX子控件。如果是的话，那么 
        你的控件应该建立在 <pre>  CMainFrame::OnCreate(LPCREATESTRUCT lpCreateStruct)，</pre>
        <p>首先当然要确定你的主窗口已经建立。<br>
        另外，如果你在你的代码中使用了 </p>
        <pre>   m_FaxPrnt.Create(NULL, WS_VISIBLE, CRect(50,50,100,100), m_pMainWnd, 0);</pre>
        <p>那么应该用“this”来代替m_pMainWnd.</p>
      </li>
      <li>为什么不试一下m_FaxzPrnt.CreateControl(.....)？ </li>
    </ul>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq3"></a><br>
    </p>
    <font color="Red"><h3>组合框中的多重选择</h3>
    </font><p>问：CComboBoxMulSel::OnCreate为什么没有调用到？</p>
    <p>答 <ul>
      <li>试试重载PreSubclassWindow来代替OnCreate.</li>
      <li>在对话框模板中，一个子控件的OnCreate并不由这个控件所调用。创建工 
        作是在对话框建立时发生的。所以标准的组合框控件建立工作也在此完成。 
      </li>
    </ul>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq4"></a><br>
    </p>
    <font color="Red"><h3>调用在DLL中的一个图标</h3>
    </font><p>问：我不能在一个DLL中调用一个图标，但相同的代码在.exe中工作很好。</p>
    <p>答： <ul>
      <li>在LoadIcon()之前先调用AFX_MANAGE_STATE(AfxGetStaticModuleState()); </li>
      <li>你可以使用ExtractIcon().无论是DLL或是可执行文件都可以取得图标。</li>
      <li>可以将缺省的资源指向DLL（非.exe） <pre>HINSTANCE hDLL;

hDLL = LoadLibrary( &quot;MyIconDll&quot; );

ASSERT (hDLL )

if (hDLL != NULL)
{
    AfxSetResourceHandle( hDLL );
}

....

HICON h;
h = LoadIcon(AfxGetResourceHandle(), MAKEINTRESOURCE(IDI_ICON1));
ASSERT(h);

....

if ( hDLL )
    FreeLibrary( hDLL );</pre>
      </li>
    </ul>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq5"></a><br>
    </p>
    <font color="Red"><h3>从别的类刷新CEditView</h3>
    </font><p>问：我有一个应用程序，包含一个分隔视。上面一个视是CFormView， 
    里面有一个DBGrid控件。下半部分是CEditView.我想让CEditView的内 容与DBGrid的当前记录有关。那么如何我才能刷新它呢？</p>
    <p>答 <ul>
      <li>可以用这种方法完成。在你的CMainFrame类中声明 <pre>CWnd * GetPane(int row, int col) { return m_wndSplitter.GetPane (row,col); }</pre>
        <p>在 </p>
        <pre>void CPTDBGView::OnRowColChangeDbgrid1(VARIANT FAR* LastRow,short LastCol)</pre>
        <p>中加入 </p>
        <pre>    CEditView * pEditView = ((CEditView *)((CMainFrame
*)GetParent())-&gt;GetPane(1,0));
    CEdit &amp;pEdit = pEditView-&gt;GetEditCtrl();</pre>
      </li>
      <li>我有一个类似的程序，上面是一个List视，下面是一个Edit视。这些视有着相同的文档。 
        <pre>void CMyListView::OnItemchanged(NMHDR* pNMHDR, LRESULT* pResult)
{
    NM_LISTVIEW* pNMListView = (NM_LISTVIEW*)pNMHDR;
    // TODO: Add your control notification handler code here
    CListCtrl* pListCtrl = &amp;GetListCtrl();
    CDocument* pDoc = GetDocument();

    int selItem = pListCtrl-&gt;GetNextItem(-1, LVIS_SELECTED);
    CString selStr = pListCtrl-&gt;GetItemText( selItem, 0 );
    ((CMyDoc*)pDoc)-&gt;SetTitle(selStr);

    CString selStatusStr = pListCtrl-&gt;GetItemText(selItem, 3);

    //Storing data in document class, here I have public data members
CString m_sFunctionStatus and m_sFunctionListSel
    //in my document class.

    ((CMyDoc*)pDoc)-&gt;m_sFunctionStatus = selStatusStr;
    ((CMyDoc*)pDoc)-&gt;m_sFuncListSel = selStr;
    ((CMyDoc*)pDoc)-&gt;UpdateAllViews(NULL);
}

void CMyEditView::OnDraw(CDC* pDC)
{
    CDocument* pDoc = GetDocument();
    // TODO: add draw code here
    CString selStr = ((CMyDoc*)pDoc)-&gt;m_sFuncListSel;
    CString funcStatusStr = ((CMyDoc*)pDoc)-&gt;m_sFunctionStatus;

    if(selStr == &quot;One&quot;)
    {
        if(funcStatusStr == &quot;Executed&quot;)
        {
            pDC-&gt;TextOut( 0, 0, &quot;Line 1&quot;);
            pDC-&gt;TextOut( 0, 20,&quot;Line 2&quot;);
        }
        else if(funcStatusStr == &quot;Warning&quot;)
        {
            ///some code here..
        }

    }
    else if(selStr == &quot;Two&quot;)
    {
        if(funcStatusStr == &quot;Failed&quot;)
        {
            pDC-&gt;SetTextColor(RGB(255,0,0));
            pDC-&gt;TextOut( 0, 0, &quot;Line 1&quot;);
            pDC-&gt;TextOut( 0, 20, &quot;Line 2&quot;);
        }

    }

}</pre>
      </li>
    </ul>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <hr>
    <a href="cmfcv41.htm"><p align="center">前一期</a>|<a href="cmfcv39.htm">后一期</a><br>
    <a href="http://mfc2000.yeah.net" target="_top">玉海园</a>[http://mfc2000.yeah.net]友情提供! 
    </td>
  </tr>
</table>
</center></div>

<p><a name="PageBegin"></a></p>
</body>
</html>
