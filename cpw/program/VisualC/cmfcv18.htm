<html>

<head>
<title></title>
</head>

<body>

<table border="0" cellspacing="2" cellpadding="0" width="100%" style="font-size: 9pt">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">现在的位置是： <b><a href="Vc_idx.htm">Visual 
    C++/C++</a> &gt;</b> </span><font color="#000000">MFC邮递表的中文翻译-第十八期</font></td>
  </tr>
  <tr>
    <td></td>
  </tr>
</table>

<table border="0" width="100%" style="font-size: 9pt" bgcolor="#E8E8E8">
  <tr>
    <td width="100%"><table border="1" width="32%" style="font-size: 9pt" height="30"
    cellspacing="0" cellpadding="2">
      <tr>
        <td width="100%" bgcolor="#4264B5"><p align="center"><font color="#FFFFFF">资料整理<span
        class="f">&middot;</span><a href="http://fasoft.yeah.net" target="_blank"
        style="color: rgb(255,255,255)">中国程序员网站</a></font></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%">　<table border="0" width="100%" bgcolor="#E8E8E8">
      <tr>
        <td width="100%"></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%"><p align="center"><font color="#000000"><strong>MFC邮递表的中文翻译-第十八期</strong></font></td>
  </tr>
  <tr>
    <td width="100%"></td>
  </tr>
  <tr>
    <td width="100%">　<p><font color="Red">第十八期目录</font> <font size="-1">杨晓东 
    1998.12.12</font><ol>
      <li><a href="#vol18q1">怎样知道CWinThread对象的状态？</a> </li>
      <li><a href="#vol18q2">调整控件对话框条的大小</a> </li>
      <li><a href="#vol18q3">顶端显示CStatic类文字</a> </li>
      <li><a href="#vol18q4">神秘的消息句柄</a> </li>
      <li><a href="#vol18q5">树形控件为何闪烁</a> </li>
      <li><a href="#vol18q6">怎样才能关闭树形控件的滚动条</a> </li>
      <li><a href="#vol18q7">建立一个带滚动条的窗口</a> </li>
      <li><a href="#vol18q8">如何实现对话框的拖放</a> </li>
    </ol>
    <p><a name="vol18q1"></a></p>
    <p><br>
    </p>
    <font color="Red"><h3>问:怎样知道CWinThread对象的状态？</h3>
    </font><p>问： 怎样才能知道一个线程是在运行还是已经终止?<br>
    </p>
    <p>答：可以利用线程句柄所指的::GetExitCodeThread()函数,如果线程已经结束, 
    它将返回一个退出代码,如果还在运行,则返回一个STILL_ACTIVE.不过在之此前,先将 
    CWinThread成员对象m_bAutoDelete设置为FALSE.另外对象在线程结束时会自动检测到. 
    <br>
    </p>
    <p align="right"><a href="#vol18home">回到本期目录</a> </p>
    <font color="Red"><h3>问:如何调整控件对话框条的大小?</h3>
    </font><p>问:我想让用户能够在控制条出现时控制它的大小,在所有的例子中,在控件浮动时,改 
    变尺寸还可以,但在工具条停靠在框架上时就无法调整其大小,该怎样实现?<br>
    答:1)也许你错过了一些注意点,我用的是codeguru站点上下载的CCoolDialogBar类, 
    在工具条停靠时也可以重新改变其大小.<br>
    2)我开发了一个应用程序,它的界面跟你所说的差不多,让我试着解释一下我是怎样做的.<br>
    1.从CDialogBar类中继承一个类,名为CMyBar;<br>
    2.在CMyBar中增加一个成员变量,int m_iWidth;<br>
    3.在CMyBar中的OnPaint和OnNcPaint中画出工具条(grab bar);<br>
    4.拖动工具条时在鼠标事件时绘出轨迹;<br>
    5.释放鼠标时,计算CMyBar新宽度.可以通过取得当前轨迹位置,使m_iWidth等于 
    新的宽度;<br>
    6.(重要)GetDockingFrame()-&gt;RecalcLayout();<br>
    7.在CMybar中增加一个成员方法CalcDynamicLayout;<br>
    8.在CalcDynamicLayout中,当工具条停靠时,通过计算m_iWidth返回值.<br>
    当然,这只是一个很简单的方法,你可以做得比这更好.<br>
    3)可以试一下VC6.0中的CReBar类 <br>
    </p>
    <p align="right"><a href="#vol18home">回到本期目录</a> </p>
    <font color="Red"><h3>问:如何顶端显示CStatic类文字?</h3>
    </font><p>问:我正写一个小的应用程序,我想显示一串文本(CStatic)并且无论别的应用程序运 
    行时是否覆盖,这些文字总会在最上面显示.<br>
    答:1)用CreateEx来建立一个WS_POPUP窗口,使这个窗口总在最上面(always on 
    top) 然后在该窗口中实现文字显示.<br>
    2)建立窗口时用SetWindowPos()函数,用&amp;wndTopMost作为第一个参数,这样就可以 
    完成你想做的了. <br>
    </p>
    <p align="right"><a href="#vol18home">回到本期目录</a> </p>
    <font color="Red"><h3>问:消息句柄出了什么事?</h3>
    </font><p>问:我在CParentView中为WM_LBUTTONDOWN定义一个句柄,但我建个新的CChildView, 
    句柄得不到处理.<br>
    答:1)仔细看一下你ChildView文件中的MESSAGE_MAP,可能在第两个参数匹配 
    BEGIN_MESSAGE_MAP(Child,Parent)中有着错误的基类.如果你是用向导生成器, 
    那么你很容易就会发生这种事情.<br>
    2)检查一下消息映象宏中的类名和父类名是否正确,比如BEGIN_MESSAGE_MAP 
    (CChildView,CParentView).<br>
    如果你用自己的消息句柄手工代替了向导所做的,确信你的改动是正确的, 
    一个错误的参数或者加了一个&quot;const&quot;将会改变消息映象而不会被正确调用.<br>
    3)我猜想你一定是用类向导生成器来建立你的CChildView,而且在基类的选择中 
    一定是选了CView,自己动手在消息映象中把它修改过来. <br>
    </p>
    <p align="right"><a href="#vol18home">回到本期目录</a> </p>
    <font color="Red"><h3>问:树形控件为何闪烁?</h3>
    </font><p>问：我从CTreeCtrl中继承了一个类，以缩进的格式显示节点，现在我碰上些问题，当树 
    被重画两次之后（一次为缺省，另一次为对齐文本时）点选节点树就会闪烁.<br>
    答：1）试一下LockWindowUpdate()API函数。<br>
    2）试一下加入TVS――HASBUTTONS标志，<br>
    </p>
    <pre>
ModifyStyleEx(TVS_HASBUTTONS, 0);
....//drawing
ModifyStyleEx(0, TVS_HASBUTTONS);
</pre>
    <p>如果它不再闪烁，那么在将其定义为自画属性，用PreCreateWindow()中加入CS――OWNDC。 
    <br>
    </p>
    <p align="right"><a href="#vol18home">回到本期目录</a> </p>
    <font color="Red"><h3>问:怎样才能关闭树形控件中的滚动条?</h3>
    </font><p>问：我想关闭树形控件的滚动条，但它依然显示出来，怎样才能隐藏它？<br>
    答：1）在建立时加入TVS_NOSCROLL，注意此时你就不可以用键盘来实现翻页，这种类型 
    需要comct32.dll4.71版本以上才可以，并且要在commctrl.h中定义如#define 
    TVS_NOSCROLL 0x2000.<br>
    2）值得这样试一下 ModifyStyle(WS_VSCROLL,0),将这段代码放在建立之后，显示之前。 
    <br>
    </p>
    <p align="right"><a href="#vol18home">回到本期目录</a> </p>
    <font color="Red"><h3>问:如何建立一个带滚动条的窗口?</h3>
    </font><p>问：我想建立一个带滚动的子窗口，但我没有用向导生成器。<br>
    答：如果你让你的窗口有一个滚动条，你必须首先初始化。如下<br>
    </p>
    <pre>
   SCROLLINFO si;
   si.cbSize = sizeof( SCROLLINFO );
   si.fMask = SIF_PAGE | SIF_RANGE;

   si.nMin = 0;
   si.nMax = 100;
   si.nPage = 10;
   SetScrollInfo( SB_HORZ, &amp;si );

   si.nMin = 0;
   si.nMax = 50;
   si.nPage = 5;
   SetScrollInfo( SB_VERT, &amp;si );
</pre>
    <p>如果程序运行时你的窗口内容已经改变或者窗口被改变大小而重画时，你必须重新设置滚动条。在MFC中包含 
    类CScrollView，它已内建滚动条。 <br>
    </p>
    <p align="right"><a href="#vol18home">回到本期目录</a> </p>
    <font color="Red"><h3>问:如何实现对话框的拖放?</h3>
    </font><p>问：我有一个对话框程序，想让它实现拖放。但无论用OnDrag或OnDrop等等，所有的 
    的消息都发送给CView类而不是CDialog类，为什么？<br>
    答：1）。你应该使用COleDropTarget类，试一下这些：<br>
    </p>
    <pre>
class CMyOleDropTarget: public COleDropTarget
{
protected:
    virtual DROPEFFECT OnDragEnter( CWnd* pWnd, COleDataObject*
pDataObject, DWORD dwKeyState, CPoint point )
    {
        TRACE( &quot;DRAG Enter\n&quot; );
        return DROPEFFECT_MOVE;
    };

    virtual DROPEFFECT OnDragOver( CWnd* pWnd, COleDataObject*
pDataObject, DWORD dwKeyState, CPoint point )
    {
        TRACE( &quot;DRAG Over\n&quot; );
        return DROPEFFECT_MOVE;
    };
};

CMyOleDropTarget DropTarget;

BOOL CDlgDlg::OnInitDialog()
{
    CDialog::OnInitDialog();

    DropTarget.Register( this );

不要忘记调用AfxOleInit()
BOOL CDlgApp::InitInstance()
{
    AfxEnableControlContainer();
    AfxOleInit();

}</pre>
    <hr>
    <a href="cmfcv19.htm"><p align="center">前一期</a>|<a href="cmfcv17.htm">后一期</a><br>
    <a href="http://mfc2000.yeah.net" target="_top">玉海园</a>[http://mfc2000.yeah.net]友情提供!</td>
  </tr>
</table>

<p><a name="vol18home"></a> </p>
</body>
</html>
