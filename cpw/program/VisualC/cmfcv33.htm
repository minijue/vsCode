<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb_2312-80">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title></title>
</head>

<body bgcolor="#8080C0">
<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="95%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="Vcidx098.htm">Visual 
    C++/C++</a>--&gt;</b> MFC邮递表的中文翻译(第三十三期)</span></td>
  </tr>
</table>
</center></div><div align="center"><center>

<table border="1" width="95%" style="font-size: 9pt" bgcolor="#FFFFFF"
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">
  <tr>
    <td width="100%"><table border="1" width="32%" style="font-size: 9pt" height="30"
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"
    bordercolordark="#FFFFFF">
      <tr>
        <td width="100%" bgcolor="#4264B5"><p align="center"><font color="#FFFFFF">资料整理<span
        class="f">&middot;</span><a href="http://chinaprog.yeah.net" target="_blank"
        style="color: rgb(255,255,255)">中国程序员网站</a></font></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%">　<h2 align="center"><span style="font-size: 9pt">MFC邮递表的中文翻译</span></h2>
    <p>&nbsp;&nbsp;&nbsp;&nbsp;我是一名mfc程序设计的爱好者,订阅了mfc的maillist,利用业余时间 
    将它翻译出来,希望能对mfc编程的朋友有所帮助,请朋友们指正.<br>
    </p>
    <h3><font color="#FF0000">第三十三期目录</font> <font size="2">杨晓东 1999.4.15</font></h3>
    <ol>
      <li><a href="#volq1">动态创建线程</a> </li>
      <li><a href="#volq2">如何知道一个文档已经改变</a> </li>
      <li><a href="#volq3">设置系统图标</a> </li>
      <li><a href="#volq4">CWnd::Create中的nID是什么?</a> </li>
      <li><a href="#volq5">树型控件的TVS_SINGLEEXPAND</a> </li>
      <li><a href="#volq6">改变鼠标的指针</a> </li>
      <li><a href="#volq7">怎样检测CEdit文本的限制</a> </li>
      <li><a href="#volq8">编译不同语言版本的资源文件</a> </li>
    </ol>
    <p><a name="volq1"></a></p>
    <p><br>
    </p>
    <font color="Red"><h3>动态创建线程</h3>
    </font><p>问:一个CWinThread子类,类向导自动添加了IMPLEMENT_DYNCREATE和DECLARE_DYNCREATE 
    两个宏,但这却产生了错误:error C2512: 'CSpawner' : no appropriate default 
    constructor available... 如果我用CSpawner( const CString&amp; )的构造函数中的 
    DYNCREATE改为DYNAMIC宏,问题就不再出现,为什么?</p>
    <p>答:1)类CObject(许多MFC类的基类)需要一个缺省的构造函数来动态构造(使用 
    CRuntimeClass类的 CreateObject方法)你可以用两种方法来解决这个问题,1是 
    你现在的构造函数提供一个缺省的值,或者加入没有一个参数的构造函数,比如: 
    CSpawner();如果你不想使用这个构造函数的话,请设为私有或者保护.<br>
    2).要使用DYNCREATE,你必须提供一个&quot;缺省的构造函数&quot;: </p>
    <pre>CSpawner:CScpawner() { ...}</pre>
    <p>&nbsp;&nbsp; DYNCTEATE是指编译器允许建立这个对象的一个动态的实例,这个'动态'事实不做任何 
    事情在堆栈中建立时,就是在编译时实际上对象的类型并不确定,只知道是CObject的 
    子类.在通过该对象的建立而调用构造函数之后,它的变量才可以通过成员函数初始化. 
    &nbsp;&nbsp; 另外一方面,CYNAMIC只允许你处理CSpawner's RTTI(运行时类型信息),所以你能使用 
    函数IsKindOf(myobject).DYNAMIC并不比DYNCREATE功能强大,(DYNCREATE包括 DYNAMIC),看一下关于这个宏的定义(在afx.h) 
    </p>
    <pre>
#define IMPLEMENT_DYNCREATE(class_name, base_class_name) \
	CObject* PASCAL class_name::CreateObject() \
		{ return new class_name; } \
	IMPLEMENT_RUNTIMECLASS(class_name, base_class_name, 0xFFFF, \
		class_name::CreateObject)</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq2"></a><br>
    </p>
    <font color="Red"><h3>如何知道一个文档已经改变</h3>
    </font><p>问:我有一个MDI程序,视类采用CFormView,有没有简单的方法通过设置一个标志来得知 
    用户已经修改了数据?</p>
    <p>答:1)如果我没有理解错你的意思的话,你可以捕获视中的一个编辑控件的EN_CHANGE消息并 
    在其中加入SetModifiedFlag函数.<br>
    &nbsp;&nbsp; 如果你有一个列表框,你可以在总数变化时采用这种方法,在选项被改变时它就能得知 
    数据的更动,比如你有一个Add按钮,你就能截获这个变动.<br>
    2)这是我的程序中所做的方法,使用前必须对WM_COMMAND进行消息映像. </p>
    <pre>//- a description of WM_COMMAND
// WM_COMMAND
// wNotifyCode = HIWORD(wParam); // notification code
// wID = LOWORD(wParam);         // item, control, or accelerator identifier
// hwndCtl = (HWND) lParam;      // handle of control

BOOL CSomeView::OnCommand(WPARAM wParam, LPARAM lParam)
{
	int nMsg = HIWORD(wParam);

	//- these are but a few messages.  Check for the others you are
interested in.
	//- from the description above, you can wID tells you the control that
the message
	//- is for.  HwndCtl is the HWND of the control.
	if( nMsg == EN_CHANGE || nMsg == CBN_SELCHANGE || nMsg == CBN_EDITCHANGE
||
		nMsg == BN_CLICKED )
	{
		GetDocument()-&gt;SetModifiedFlag(TRUE);
	}

	return CFormView::OnCommand(wParam, lParam);
}</pre>
    <p>有一件事你必须注意:如果你带参数初始化控件后(就是初始化使控件内容有变动时) 
    必须在初始化之后调用GetDocument()-&gt;SetModifiedFlag(FALSE),因为在你的 
    初始化时也会调用OnCommand()函数.<br>
    <a href="#PageBegin"></p>
    <p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq3"></a><br>
    </p>
    <font color="Red"><h3>设置系统图标</h3>
    </font><p>问:我有一个对话框,拥有WS_SYSMENU类型,显示在窗口左上角的图标是窗口的缺省图标 
    那么如何我才能把它变成我自己的图标?我能改变程序的主窗口图标,但想改变对话框 
    缺省的图标却一直不行.</p>
    <p>答:你在InitDialog中试过下面几行吗? </p>
    <pre>    HICON hIcon = AfxGetApp()-&gt;LoadIcon (IDD_SOMEICON);
    SetIcon (hIcon, TRUE);      // Set big icon 设置大图标
    SetIcon (hIcon, FALSE);     // Set small icon  设置小图标</pre>
    <p>&nbsp;&nbsp;2)在图标资源中找IDR_MAINFRAME ID,只要把它按你的意愿改变就可以了.不要忘了 
    32x32和16x16需同时改变.<br>
    <a href="#PageBegin"></p>
    <p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq4"></a><br>
    </p>
    <font color="Red"><h3>CWnd::Create中的nID是什么?</h3>
    </font><p>问:我想通过调用pWnd-&gt;Create(NULL, NULL, (WS_CHILD | WS_VISIBLE), 
    &gt;CRect(0,0,0,0), this, nID, pContext)); 来建立一个窗口,在这个调用中 
    我所用的nID参数是用来干什么的?文档说是:子窗口的ID.</p>
    <p>答:1)如果你的窗口是一个控件(子窗口),系统将会用这个ID发送给它的父窗口.<br>
    &nbsp;&nbsp;2)每个窗口能有许多的子窗口,典型的例子是对话框,里面每个控件都不同的ID与其它的控 
    件相互区分开,如果你想加入一个子窗口,你几乎可以使用大部分的ID,注意工具条,状态条 
    等也都是子窗口.我通常为每个子视建立一个IDR_whatever,加在IDR_MAINFRAME后面. 
    我的建立代码是这样的: </p>
    <pre>if (mLinesetView == NULL) {
    CCreateContext context;
    context.m_pNewViewClass = RUNTIME_CLASS (CLinesetView);
    context.m_pCurrentDoc = mActiveView-&gt;GetDocument ();
    context.m_pCurrentFrame = this;
    mLinesetView = STATIC_DOWNCAST (CLinesetView, CreateView (&amp;context,
IDR_LINESET_VIEW));
// etc</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq5"></a><br>
    </p>
    <font color="Red"><h3>树型控件的TVS_SINGLEEXPAND</h3>
    </font><p>问：我的问题是有没有好的方法得知用户是否按了树型控件的+或-按钮？<br>
    答:这有一个例子关于双击的代码，摘自于我的程序中 </p>
    <pre>  void CMyTreeView::OnDblclk(NMHDR* /*pNMHDR*/, LRESULT* pResult)
  {
    // A double-click only counts if the mouse was clicked on
    // the item (e.g. the label, the icon, or a state icon, if
    // it exists)
    UINT ClickLocation;
    CPoint pt(::GetMessagePos());
    ScreenToClient(&amp;pt);
    (void) GetTreeCtrl().HitTest(pt, &amp;ClickLocation);
    if (ClickLocation &amp; TVHT_ONITEM)
    {
        // Get handle of item that now is selected &amp;
        // do its default action
        HTREEITEM hItem = GetTreeCtrl().GetSelectedItem();
        DoDefaultAction(hItem);
    }

    *pResult = 0;
  }</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq6"></a><br>
    </p>
    <font color="Red"><h3>改变鼠标的指针</h3>
    </font><p>问:我想让鼠标在移到对话框的一个静态对象时改变指针,怎么办?<br>
    答:为什么你不这样试一下? </p>
    <pre>BOOL CAboutDlg::OnSetCursor(CWnd* pWnd, UINT nHitTest, UINT message)
{
    if ( m_bSomeThing ) // True when you want your cursor to be displayed,
False elsewise
    {
        SetCursor( m_hSomeCursor ); // Handle to the cursor to display
        return -1;
    }
    return COleControl::OnSetCursor(pWnd, nHitTest, message);
}</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq7"></a><br>
    </p>
    <font color="Red"><h3>怎样检测CEdit文本的限制</h3>
    </font><p>问:我在使用CEdit控件时遇上了下面一个问题,我使用了一个表格控件,每个格子都有一 
    个CEdit控件,在CEdit中,我想检测一下插入标志位置的显示,是在第一个字符之前,或者 
    是最后一个字符后?</p>
    <p>答:一个方法是在运行时检查文本长度是否大于编辑框的本文长度设定.代码行中用 
    CEdit::LineLength来取得文本的长度,用CEdit::GetLimitText来取得文本的限制, 
    然后通过比较两个值来决定是否激活下一个编辑框控件.</p>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="volq8"></a><br>
    </p>
    <font color="Red"><h3>编译不同语言版本的资源文件</h3>
    </font><p>问:我有些资源文件包含一些字串表,每个资源文件包含一种语言,比如我有一个资源文件 
    MYJPN.rc,字串表里全部包含的是日语,我想将它在一个英语操作系统中编译进一个DLL中去, 
    但我联接资源文件时使用了/l LANGID /fo OUTRESFILE /d NDEBUG RCFILE参数,也没有成功 
    怎么办?<br>
    答:用应用程序向导程序生成一个项目,然后在其第一步中的选择你的资源文件中语言 
    &quot;What language would you like resource in&quot;,这里面只要选择你所想的语言就可以了<br>
    <a href="#PageBegin"></p>
    <p align="right">回到本期目录</a><br>
    </p>
    <hr>
    <a href="cmfcv34.htm"><p align="center">前一期</a>|<a href="cmfcv32.htm">后一期</a><br>
    <a href="http://mfc2000.yeah.net" target="_top">玉海园</a>[http://mfc2000.yeah.net]友情提供! 
    </td>
  </tr>
</table>
</center></div>

<p><a name="PageBegin"></a></p>
</body>
</html>
