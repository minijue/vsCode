<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb_2312-80">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title></title>
</head>

<body>

<table border="0" cellspacing="2" cellpadding="0" width="100%" style="font-size: 9pt">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">现在的位置是： <b><a href="Vc_idx.htm">Visual 
    C++/C++</a> &gt;</b> </span><font color="#000000">MFC邮递表的中文翻译-第二十八期</font></td>
  </tr>
  <tr>
    <td></td>
  </tr>
</table>

<table border="0" width="100%" style="font-size: 9pt" bgcolor="#E8E8E8">
  <tr>
    <td width="100%"><table border="1" width="32%" style="font-size: 9pt" height="30"
    cellspacing="0" cellpadding="2">
      <tr>
        <td width="100%" bgcolor="#4264B5"><p align="center"><font color="#FFFFFF">资料整理<span
        class="f">&middot;</span><a href="http://fasoft.yeah.net" target="_blank"
        style="color: rgb(255,255,255)">中国程序员网站</a></font></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%">　<table border="0" width="100%" bgcolor="#E8E8E8">
      <tr>
        <td width="100%">　</td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%"><p align="center"><font color="#000000"><strong>MFC邮递表的中文翻译-第二十八期</strong></font></td>
  </tr>
  <tr>
    <td width="100%">　</td>
  </tr>
  <tr>
    <td width="100%">　<h3><font color="#FF0000">第二十八期目录</font> <font size="2">杨晓东 
    1999.3.7</font></h3>
    <ol>
      <li><a href="#vol28q1">焦点问题</a> </li>
      <li><a href="#vol28q2">从一个OCX调用另一个OCX的方法。</a> </li>
      <li><a href="#vol28q3">得到视</a> </li>
      <li><a href="#vol28q4">字符转化时间</a> </li>
      <li><a href="#vol28q5">二进制还是文本方式</a> </li>
      <li><a href="#vol28q6">发送消息</a> </li>
      <li><a href="#vol28q7">怎样知道菜单运行时的状态</a> </li>
      <li><a href="#vol28q8">DLL编译出错</a> </li>
    </ol>
    <p><a name="vol28q1"></a></p>
    <p><br>
    </p>
    <font color="Red"><h3>焦点问题</h3>
    </font><p>问：我有一个非模态属性表，其中的一页包含7个控件，我的问题是，如果现在焦点在一个 
    编辑控件上，当我最小化窗口后又最大化，那么该控件就会失去焦点，怎样才能恢复原状？<br>
    答：在消息WM_SHOW中这样做： </p>
    <pre>void CPropPage::OnShowWindow(BOOL bShow, UINT nStatus)
{
   ...
  if( bShow ) {
    // restore current focused control
     if( m_pCurFocusWnd != NULL ) {
        m_pCurFocusWnd-&gt;SetFocus();
     }
  }
  else {
   // save current focused wnd
    m_pCurFocusWnd = GetFocus();
  }

  YourBaseClass::OnShowWindow(bShow, nStatus);
   ...
}</pre>
    <p>注意：pCurFocusWnd是一个CWnd指针，必须在构造函数中初始化为NULL；你也必须声明 
    对话框中的所有变量，否则调用OnShowWindow时，指针通过GetFocus()所返回的值将是 
    非法的。希望你能满意！ </p>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    <a name="vol28q2"></a><br>
    </p>
    <font color="Red"><h3>从一个OCX调用另一个OCX的方法。</h3>
    </font><p>问：我们能否在一个OCX中建立另外一个OCX的句柄？我想做一个OCX，里面包含VC的应用 
    向导生成器的OCX，第一个OCX需要第二个OCX的支持（插入的控件需要交流）当我建立第二 
    个OCX句柄时，总是失败。<br>
    答：将你的initlnstance()作如下修改。 </p>
    <pre>BOOL CScheduleXVer1App::InitInstance()
{
    BOOL bInit = COleControlModule::InitInstance();

    if (bInit)
    {
        AfxEnableControlContainer();
    }

    return bInit;
}</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol28q3"></a><br>
    </p>
    <font color="Red"><h3>得到视</h3>
    </font><p>问：我写了一个SDI程序，怎样我才能从框架窗口中得到指向视的指针？<br>
    答：试一下CFrameWnd中的GetActiveView() </p>
    <pre>    CView* theView = MyFrameWnd.GetActiveView();

    if (CView)
        // do something...</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    <a name="vol28q4"></a><br>
    </p>
    <font color="Red"><h3>字符转化时间</h3>
    </font><p>问:我想将字符转化为CTime对象。<br>
    答：这有一个非常简单的函数，您可以在此上面加入你所需要的： </p>
    <pre>BOOL ScanTime
(
   CTime   &amp;time,                // o - filled in time structure
   LPCTSTR lpszTime,             // i - the string containing the time to
be extracted
   LPCTSTR lpszFormat            // i - the time format to extract
according to
)
{
   int nYear  = 1980;            // extracted time fields
   int nMonth = 1;
   int nDay   = 1;
   int nHour  = 0;
   int nMin   = 0;
   int nSec   = 0;
   int nFlag  = DATE_TIME;       // DATE_TIME / DATE_ONLY / TIME_ONLY
   CString msg;

   // start at the beginning

   char *pTime = (char *)lpszTime;
   char *pFmt  = (char *)lpszFormat;

   while (*pFmt != '\0')
   {
      if (*pFmt == '%')
      {
         pFmt++;
         switch (*pFmt)
         {
            case 'Y' : // year with century
               sscanf (pTime,&quot;%4d&quot;,&amp;nYear);
               if (nYear <1980 || nYear> 2036)
               {
                  msg.Format (&quot;Invalid year (%d)&quot;,nYear);
                  AfxMessageBox (msg);
                  return (FALSE);
               }
               pTime+=4;
               break;

            case 'y' : // year without century (00-99)
               sscanf (pTime,&quot;%2d&quot;,&amp;nYear);
               nYear = nYear + (nYear &gt; 36 ? 1900 : 2000);
               if (nYear <1980 || nYear> 2036)
               {
                  msg.Format (&quot;Invalid year (%d)&quot;,nYear);
                  AfxMessageBox (msg);
                  return (FALSE);
               }
               pTime+=2;
               break;

            case 'm' : // month (01-12)
               sscanf (pTime,&quot;%2d&quot;,&amp;nMonth);
               if (nMonth <1 || nMonth> 12)
               {
                  msg.Format (&quot;Invalid month (%d)&quot;,nMonth);
                  AfxMessageBox (msg);
                  return (FALSE);
               }
               pTime+=2;
               break;

            case 'd' : // day of month (01-31)
               sscanf (pTime,&quot;%2d&quot;,&amp;nDay);
               if (nDay <1 || nDay> 31)
               {
                  msg.Format (&quot;Invalid day (%d)&quot;,nDay);
                  AfxMessageBox (msg);
                  return (FALSE);
               }
               pTime+=2;
               break;

            case 'H' : // hour (00-23)
               sscanf (pTime,&quot;%2d&quot;,&amp;nHour);
               if (nHour <0 || nHour> 23)
               {
                  msg.Format (&quot;Invalid hour (%d)&quot;,nHour);
                  AfxMessageBox (msg);
                  return (FALSE);
               }
               pTime+=2;
               break;

            case 'M' : // minute (00-59)
               sscanf (pTime,&quot;%2d&quot;,&amp;nMin);
               if (nMin <0 || nMin> 59)
               {
                  msg.Format (&quot;Invalid minute (%d)&quot;,nMin);
                  AfxMessageBox (msg);
                  return (FALSE);
               }
               pTime+=2;
               break;

            case 'S' : // second (00-59)
               sscanf (pTime,&quot;%2d&quot;,&amp;nSec);
               if (nSec <1 || nSec> 31)
               {
                  msg.Format (&quot;Invalid second (%d)&quot;,nSec);
                  AfxMessageBox (msg);
                  return (FALSE);
               }
               pTime+=2;
               break;

            default :
               msg.Format(&quot;Invalid format specifier (%c)&quot;,*pFmt);
               AfxMessageBox(msg);
               return (FALSE);
               break;
         }
      }
      else
      {
         if (!isdigit((int)(*pTime)))
         {
            if (*pTime == *pFmt)
            {
               pTime++;
            }
            else
            {
               msg.Format (&quot;Character mismatch : Expected %c, found
%c&quot;,*pFmt,*pTime);
               AfxMessageBox ((LPCTSTR)msg);
               return (FALSE);
            }
         }
      }
      pFmt++;
   }

   // success

   time = CTime(nYear,nMonth,nDay,nHour,nMin,nSec);
   return (TRUE);
}</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol28q5"></a><br>
    </p>
    <font color="Red"><h3>二进制还是文本方式?</h3>
    </font><p>问：怎样测定一个文件是用二进制模式还是文本模式打开?<br>
    答：所有的文件（数据文件或应用文件）都一系列的字节组成的，通常是通过文件的扩展名 
    来知道某一文件的内容。当程序读一个文件时，你需要说明这个文件的格式，这通常 
    文件格式会有相应的说明。比如可能是这个样子的，“第11到14字节是一个长字节，指 
    向图像数据的开始处”。<br>
    &nbsp;&nbsp;&nbsp;&nbsp;如果文件是你自己定义的格式，那么你的读取数据的程序必须与写入数据的程序相 
    匹配，如果是一个已确定的文件格式，可以通过以下的站点得到具体内容。<br>
    <a href="http://www.wotsit.org">http://www.wotsit.org</a> </p>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol28q6"></a><br>
    </p>
    <font color="Red"><h3>发送消息</h3>
    </font><p>问：怎样发送一个消息CBN_SELCHANGE给组合框？<br>
    答：下面的代码会使你满意的。 </p>
    <pre>CWnd *pWnd = GetTopLevelParent();

    if ( pWnd )
    {
        lResult = pWnd-&gt;SendMessage ( WM_COMMAND, wParam, ( LONG ) hWnd );
        if ( lResult == 0 ) //perhaps may parent is a dialog box;
        {
            pWnd = GetParent ();
            lResult = pWnd-&gt;SendMessage ( WM_COMMAND, wParam, ( LONG ) hWnd );
        }
    }</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol28q7"></a><br>
    </p>
    <font color="Red"><h3>怎样知道菜单运行时的状态</h3>
    </font><p>问：我想在程序运行时从一个属性表中检查某菜单是否enable或disable，但我不会做， 
    有谁能告诉我该怎么办？<br>
    答：如果你想通过MFC来完成你所想的，而使用CN_UPDATE_COMMAND_UI事件，你的代码 
    不能正常运行，这是因为MFC enable/disable菜单在激活之前就已经完成了。你可以用 
    MFC的CWnd::OnCommand函数来解决这个问题，就象下面所做的，<br>
    </p>
    <pre>CTestCmdUI state;
state.m_nID =3D ID_MODIFY;  // All will work fine without this line
AfxGetMainWnd()-&gt;OnCmdMsg(ID_MODIFY, CN_UPDATE_COMMAND_UI, &amp;state, NULL);
if (state.m_bEnabled)
{
       CMyPage* pMyPage=3D( CMyPage*)GetParent();
       pMyPage-&gt;Modify();  //   this is my function
}</pre>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <p><a name="vol28q8"></a><br>
    </p>
    <font color="Red"><h3>DLL编译出错</h3>
    </font><p>问：我建立了一个常规DLL，在VC环境下编译联接没有任何错误。但在命令行中编译却发现有 
    如下错误： </p>
    <pre> link.exe @C:\TEMP\nme00204. mfcs42d.lib(dllmodul.obj) : error LNK2005:
_DllMain@12 already defined in MSVCRTD.lib(dllmain.obj)
</pre>
    <p>答：1）可能你有些cpp文件包括了stadafx.h，而又有些包括了windows.h？在这种情况下你应该在 
    文件中使用stdafx.h。<br>
    &nbsp;&nbsp;2）VC环境是使用.DSP来建立一个项目，可能你的编译器或连接器设置中与你的.MAK文件中的 
    设置不匹配。 </p>
    <a href="#PageBegin"><p align="right">回到本期目录</a><br>
    </p>
    <hr>
    <a href="cmfcv29.htm"><p align="center">前一期</a>|<a href="cmfcv27.htm">后一期</a><br>
    <a href="http://mfc2000.yeah.net" target="_top">玉海园</a>[http://mfc2000.yeah.net]友情提供! 
    </td>
  </tr>
</table>

<p><a name="PageBegin"></a></p>
</body>
</html>
