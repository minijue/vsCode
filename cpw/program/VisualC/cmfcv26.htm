<html>

<head>
<title></title>
</head>

<body>

<table border="0" cellspacing="2" cellpadding="0" width="100%" style="font-size: 9pt">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">现在的位置是： <b><a href="Vc_idx.htm">Visual 
    C++/C++</a> &gt;</b> </span><font color="#000000">MFC邮递表的中文翻译-第二十六期</font></td>
  </tr>
  <tr>
    <td></td>
  </tr>
</table>

<table border="0" width="100%" style="font-size: 9pt" bgcolor="#E8E8E8">
  <tr>
    <td width="100%"><table border="1" width="32%" style="font-size: 9pt" height="30"
    cellspacing="0" cellpadding="2">
      <tr>
        <td width="100%" bgcolor="#4264B5"><p align="center"><font color="#FFFFFF">资料整理<span
        class="f">&middot;</span><a href="http://fasoft.yeah.net" target="_blank"
        style="color: rgb(255,255,255)">中国程序员网站</a></font></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%">　<table border="0" width="100%" bgcolor="#E8E8E8">
      <tr>
        <td width="100%">　</td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%"><p align="center"><font color="#000000"><strong>MFC邮递表的中文翻译-第二十六期</strong></font></td>
  </tr>
  <tr>
    <td width="100%">　</td>
  </tr>
  <tr>
    <td width="100%">　<h3><font COLOR="#FF0000">第二十六期目录</font> <font SIZE="-1">杨晓东 
    1999.2.23</font></h3>
    <ol>
      <li><a href="#vol26q1">怎样使窗口总是浮现在最上面?</a> </li>
      <li><a href="#vol26q2">改变拖放时的光标外形?</a> </li>
      <li><a href="#vol26q3">如何定位到最新的记录上?</a> </li>
      <li><a href="#vol26q4">改变检查框的背景颜色?</a> </li>
      <li><a href="#vol26q5">MVC和Doc-View?</a> </li>
      <li><a href="#vol26q6">被禁止(Disable)的控件如何改变其文本或背景色?</a> </li>
    </ol>
    <p><a name="vol26q1"></a></p>
    <font color="Red"><h3>怎样使窗口总是浮现在最上面?</h3>
    </font><p>问：我想让一个窗口浮在最上面,我用过许多函数,但都没有一个能在98下工作.<br>
    答：1.在CWnd::ModifyStyleEx()函数中加入WS_EX_TOPMOST状态参数;<br>
    2.这是个老问题,下面的代码将会对你有所启示 </p>
    <pre>
#include &quot;Windows.h&quot;

#pragma data_seg(&quot;shared&quot;)

HHOOK      g_hHook   = NULL;
HINSTANCE  g_DllInst = NULL;

#pragma data_seg()

BOOL WINAPI DllMain(HANDLE hInst, ULONG ul_reason_for_call, LPVOID lpReserved)
{
    g_DllInst = hInst;
    return TRUE;
}

LRESULT CALLBACK GetMsgProc(  int code,WPARAM wParam,LPARAM lParam)
{
 UINT nMsg = RegisterWindowMessage(&quot;Set foreground window&quot;);
 MSG * pMsg;
 HWND hWnd;

 pMsg = (MSG *)lParam;
 if(pMsg-&gt;message==nMsg)
 {
   hWnd = (HWND)pMsg-&gt;wParam;
   OpenIcon(hWnd);
   if(IsIconic(hWnd))
      OpenIcon(hWnd);
   else
      SetForegroundWindow(hWnd);
 }
 return CallNextHookEx(g_hHook, code, wParam,lParam);
}
BOOL __declspec(dllexport) ReallySetForegroundWindow(HWND hWnd)
{
 int nMsg;
 HWND fhWnd = GetForegroundWindow();

 if(IsIconic(hWnd))
  OpenIcon(hWnd);
 else
  SetForegroundWindow(hWnd);

 if(fhWnd == GetForegroundWindow())
 {
  if (g_hHook)
    UnhookWindowsHookEx(g_hHook);
    g_hHook = NULL;
  }
  g_hHook = SetWindowsHookEx(WH_GETMESSAGE , GetMsgProc,
g_DllInst,GetWindowThreadProcessId(fhWnd, NULL));
  nMsg = RegisterWindowMessage(&quot;Set foreground window&quot;);
  PostMessage(fhWnd,nMsg, (WPARAM)hWnd, 0);
 }
 return TRUE;
}
</pre>
    <a href="#PageBegin"><p align="right">返回页首</a> <a name="vol26q2"></a> </p>
    <font color="Red"><h3>改变拖放时的光标外形?</h3>
    </font><p>问：我用CView::OnDragEnter(), CView::OnDragOver(), CView::OnDragOver()来实现 
    拖放功能,但我不想用标准的拖动光标,有没有方法将它改一下,我试过SetCursor().<br>
    答：有没有检查过SetCursor()的参数,试试下面的代码,在我这儿一切正常 
    </p>
    <pre>
    HCURSOR hlCursor;
    hlCursor = AfxGetApp()-&gt;LoadStandardCursor(IDC_WAIT);
    SetCursor(hlCursor);
</pre>
    <p>顺便提一下,最好在SetCursor()时设置一个断点,用来检查指针是否为NULL<br>
    </p>
    <a href="#PageBegin"><p align="right">返回页首</a> <a name="vol26q3"></a> </p>
    <font color="Red"><h3>如何定位到最新的记录上?</h3>
    </font><p>问：我需要将最后插入ACCESS数据库中的记录显示出来,在DAO中我知道可以用 
    CDaoRecordset::GetLastModifiedBookmark()实现,但在CRecordset中不行.<br>
    答：1)试一下下面的代码 </p>
    <pre>
	void Refresh( CRecordset* pSet)
		{
		 ASSERT(pSet &amp;&amp; pSet-&gt;CanScroll() );
		 if (pSet &amp;&amp; pSet-&gt;CanBookmark())
			 {
			// CRecordset-derived object
			CDBVariant varCurrentRecord;
			pSet-&gt;GetBookmark(varCurrentRecord);
			pSet-&gt;SetBookmark(varCurrentRecord);
	 		}
		}
</pre>
    <p>2).在Update()后,使用SetBookmark(GetLastModifiedBookmark())函数,这样你就 
    能得到最新的插入或改写的记录的位置,然后使用GetFieldValue得到你所期望的. 
    </p>
    <pre>
	if(rs.CanAppend())
		{
	    rs.AddNew();
    	rs.SetBookmark(rs.GetLastModifiedBookmark());
		}
</pre>
    <a href="#PageBegin"><p align="right">返回页首</a> <a name="vol26q4"></a> </p>
    <font color="Red"><h3>改变检查框的背景颜色?</h3>
    </font><p>问:我想用不同的颜色来替换缺省的颜色(检查标记区域)<br>
    答:1).你可以在component library中选择MS Form checkbox2.0,里面可以通过 
    设置属性&quot;Backcolor&quot;和&quot;Forecolor&quot;来改变.<br>
    2).检查框也是个按钮,可能使用自画按钮可以完成你所期望的,更多的消息 
    可以看BS_OWNERDRAW和WM_DRAWITEM<br>
    </p>
    <a href="#PageBegin"><p align="right">返回页首</a> <a name="vol26q5"></a> </p>
    <font color="Red"><h3>MVC和Doc-View?</h3>
    </font><p>问:谁知道MVC(文档,视,控制)结构与MFC(文档,视)的优异?<br>
    答:文档视比起MVC来少了一个控制,在MVC中你不可以使用一视多文档,当然文档 
    视结构比起MVC来可能自己要做得更多些.<br>
    (其实,MVC是BC中采用的一种方法,但BORLAND公司已不再辉煌,再做比较可能已 
    经没有多大用处了--译者注)<br>
    </p>
    <a href="#PageBegin"><p align="right">返回页首</a> <a name="vol26q6"></a> </p>
    <font color="Red"><h3>被禁止(Disable)的控件如何改变其文本或背景色?</h3>
    </font><p>问:能否可以改变一个已经被禁止(Disable)的文本颜色或者背景色?<br>
    答:你可以捕获OnCrlColor消息,然后检查控件是否在同一个函数中被禁止,接着 
    如果是被禁止的话返回你的画刷,那么系统会自动照返回的颜色绘色. </p>
    <pre>
HBRUSH OnCtlColor( CDC* pDC, CWnd* pWnd, UINT nCtlColor )
{
     if (GetDlgItem (IDC_SOMECTL) == pWnd)
     {
          SetTextColor (dwReqdColor);
          return hReqdBrush;
     }
     return NULL;
}
</pre>
    <a href="#PageBegin"><p align="right">返回页首</a> </p>
    <hr>
    <a href="cmfcv27.htm"><p align="center">前一期</a>|<a href="cmfcv25.htm">后一期</a><br>
    <a href="http://mfc2000.yeah.net" target="_top">玉海园</a>[http://mfc2000.yeah.net]友情提供! 
    </td>
  </tr>
</table>

<p><a name="PageBegin"></a></p>
</body>
</html>
