<html>

<head>
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=gb_2312-80">
<meta NAME="GENERATOR" CONTENT="Microsoft FrontPage 3.0">
<meta NAME="doccomm" CONTENT="sss">
<meta NAME="Template" CONTENT="C:\MSOffice\Template\Sl_BOOK.dot">
<meta NAME="Author" CONTENT="Cheng Jinxing">
<title>Visual C++编程技巧之三</title>
</head>

<body TEXT="#000000" LINK="#0000EE" VLINK="#551A8B" background="../../res/back.JPG">

<p align="center"><strong><font face="Arial" size="4">Visual C++</font><font size="4">编程技巧之三 
</font></strong></p>

<p align="center"><span style="font-size: 9pt">转载于&quot;<a
href="http://kahn.xj.cninfo.net/wwchina/" target="_blank">程序员集中营</a>&quot;</span></p>

<p><a HREF="#tip17"><font SIZE="+0" FACE="Times New Roman">17</font><font SIZE="+0">、如何创建一个字回绕的</font><font
SIZE="+0" FACE="Times New Roman">CEditView</font></a> </p>

<p><a HREF="#tip18"><font SIZE="+0" FACE="Times New Roman">18</font><font SIZE="+0">、通用控件的显示窗口</font></a> 
</p>

<p><a HREF="#tip19"><font SIZE="+0" FACE="Times New Roman">19</font><font SIZE="+0">、移动窗口</font></a> 
</p>

<p><a HREF="#tip20"><font SIZE="+0" FACE="Times New Roman">20</font><font SIZE="+0">、重置窗口的大小</font></a> 
</p>

<p><a HREF="#tip21"><font SIZE="+0" FACE="Times New Roman">21</font><font SIZE="+0">、如何单击除了窗口标题栏以外的区域使窗口移动</font></a> 
</p>

<p><a HREF="#tip22"><font SIZE="+0" FACE="Times New Roman">22</font><font SIZE="+0">、如何改变视窗的背景颜色</font></a> 
</p>

<p><a HREF="#tip23"><font SIZE="+0" FACE="Times New Roman">23</font><font SIZE="+0">、如何改变窗口标题</font></a> 
</p>

<p><a HREF="#tip24"><font SIZE="+0" FACE="Times New Roman">24</font><font SIZE="+0">、如何防止主框窗口在其说明中显示活动的文档名</font></a> 
</p>

<p><font SIZE="+2"><b>　</b></font> </p>

<p><a NAME="tip17"></a><b><font SIZE="+2"><font FACE="Times New Roman">17</font><font
FACE="黑体">、如何创建一个字回绕的</font><font FACE="Times New Roman">CEditView</font></font></b> 
</p>

<p><font SIZE="+0">重载<font FACE="Times New Roman">CWnd : : PreCreateWindow</font>和修改<font
FACE="Times New Roman">CREATESTRUCT</font>结构，关闭<font FACE="Times New Roman">CEditView</font>对象的<font
FACE="Times New Roman">ES_AUTOHSCROLL</font>和<font FACE="Times New Roman">WS_HSCROLL</font>风格位， 
由于<font FACE="Times New Roman">CEditView : : PreCreateWindow</font>显示设置<font
FACE="Times New Roman">cs. style</font>，调用基类函数后要修改<font
FACE="Times New Roman">cs . style</font>。</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">BOOL CSampleEDitView : : PreCreateWindow 
(CREATESTRUCT&amp;cs)</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">{</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">//First call basse class function .</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">BOOL bResutl =CEditView : : PreCreateWindow (cs) 
;</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">// Now specify the new window style .</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">cs.style &amp;= ~ (ES_AUTOHSCROLL </font>｜<font
FACE="Times New Roman">WS_HSCROLL);</font></font> </p>

<p><font SIZE="+0" FACE="Times New Roman">return bResult ;</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">}</font> </p>

<p><a NAME="tip18"></a><b><font SIZE="+2"><font FACE="Times New Roman">18</font><font
FACE="黑体">、通用控件的显示窗口</font></font></b> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">MFC</font>提供了几个<font
FACE="Times New Roman">CView</font>派生的视窗类， 
封装了通用控件的功能，但仍然使用工</font> </p>

<p><font SIZE="+0">作框文档显示窗口体系结构：<font FACE="Times New Roman">CEditView</font>封装了编辑控件，<font
FACE="Times New Roman">CTreeView</font>保持了树列表</font> </p>

<p><font SIZE="+0">控件，<font FACE="Times New Roman">CListView</font>封装了列表显示窗口控件，<font
FACE="Times New Roman">CRichEditView</font>可以处理多种编辑控件。</font> </p>

<p><a NAME="tip19"></a><b><font SIZE="+2"><font FACE="Times New Roman">19</font><font
FACE="黑体">、移动窗口</font></font></b> </p>

<p><font SIZE="+0">调用<font FACE="Times New Roman">CWnd : : SetWindowPos</font>并指定<font
FACE="Times New Roman">SWP_NOSIZE</font>标志。目的位置与父窗口</font> </p>

<p><font SIZE="+0">有关（顶层窗口与屏幕有关）。调用<font
FACE="Times New Roman">CWnd : : MoveWindow</font>时必须要指定窗口</font> </p>

<p><font SIZE="+0">的大小。</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">//Move window to positoin 100 , 100 of its 
parent window .</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">SetWindowPos (NULL, 100 , 100 , 0 , 0 , 
SWP_NOSIZE </font>｜<font FACE="Times New Roman">SWP_NOAORDER);</font></font> </p>

<p><a NAME="tip20"></a><b><font SIZE="+2"><font FACE="Times New Roman">20</font><font
FACE="黑体">、重置窗口的大小</font></font></b> </p>

<p><font SIZE="+0">调用<font FACE="Times New Roman">CWnd: : SetWindowPos</font>并指定<font
FACE="Times New Roman">SWP_NOMOVE</font>标志， 也可调用</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">CWnd : : MoveWindow </font>但必须指定窗口的位置。</font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">// Get the size of the window .</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">Crect reWindow ;</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">GetWindowRect (reWindow );</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">//Make the window twice as wide and twice as 
tall .</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">SetWindowPos (NULL , 0 , 0 , reWindow . Width ( 
) *2,</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">reWindow . Height () * 2,</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">SWP_NOMOVE </font>｜<font
FACE="Times New Roman">SWP_NOZORDER );</font></font> </p>

<p><a NAME="tip21"></a><b><font SIZE="+2"><font FACE="Times New Roman">21</font><font
FACE="黑体">、如何单击除了窗口标题栏以外的区域使窗口移动</font></font></b> 
</p>

<p><font SIZE="+0">当窗口需要确定鼠标位置时<font FACE="Times New Roman">Windows</font>向窗口发送<font
FACE="Times New Roman">WM_NCHITTEST</font>信息，可以处理</font> </p>

<p><font SIZE="+0">该信息使<font FACE="Times New Roman">Windows</font>认为鼠标在窗口标题上。对于对话框和基于对话的应用程序，可</font> 
</p>

<p><font SIZE="+0">以使用<font FACE="Times New Roman">ClassWizard</font>处理该信息并调用基类函数， 
如果函数返回<font FACE="Times New Roman">HTCLIENT </font>则表明</font> </p>

<p><font SIZE="+0">鼠标在客房区域，返回<font FACE="Times New Roman">HTCAPTION</font>表明鼠标在<font
FACE="Times New Roman">Windows</font>的标题栏中。</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">UINT CSampleDialog : : OnNcHitTest (Cpoint point 
)</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">{</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">UINT nHitTest =Cdialog: : OnNcHitTest (point );</font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">return (nHitTest = =HTCLIENT)? HTCAPTION : 
nHitTest ;</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">}</font> </p>

<p><font SIZE="+0">上述技术有两点不利之处， 
其一是在窗口的客户区域双击时， 窗口将极大；</font> </p>

<p><font SIZE="+0">其二， 
它不适合包含几个视窗的主框窗口。还有一种方法，当用户按下鼠标左键</font> 
</p>

<p><font SIZE="+0">使主框窗口认为鼠标在其窗口标题上，使用<font
FACE="Times New Roman">ClassWizard</font>在视窗中处理<font FACE="Times New Roman">WM_LBUTTODOWN</font></font> 
</p>

<p><font SIZE="+0">信息并向主框窗口发送一个<font FACE="Times New Roman">WM_NCLBUTTONDOWN</font>信息和一个单击测试<font
FACE="Times New Roman">HTCAPTION</font>。</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">void CSampleView : : OnLButtonDown (UINT nFlags 
, Cpoint point )</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">{</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">CView : : OnLButtonDow (nFlags , pont );</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">//Fool frame window into thinking somene clicked 
on</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">its caption bar .</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">GetParentFrame ( ) </font>―<font
FACE="Times New Roman">&gt; PostMessage (</font></font> </p>

<p><font SIZE="+0" FACE="Times New Roman">WM_NCLBUTTONDOWN , HTCAPTION , MAKELPARAM (poitn 
.x , point .y) );</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">}</font> </p>

<p><font SIZE="+0">该技术也适用于对话框和基于对的应用程序，只是不必调用<font
FACE="Times New Roman">CWnd : : GetParentFrame </font>。</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">void CSampleDialog : : OnLbuttonDown (UINT 
nFlags, Cpoint point )</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">{</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">Cdialog : : OnLButtonDow (nFlags, goint );</font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">//Fool dialog into thinking simeone clicked on 
its caption bar .</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">PostMessage (WM_NCLBUTTONDOWN , HTCAPTION , 
MAKELPARM (point.x , point. y ) )</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">}</font> </p>

<p><a NAME="tip22"></a><b><font SIZE="+2"><font FACE="Times New Roman">22</font><font
FACE="黑体">、如何改变视窗的背景颜色</font></font></b> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">Windows</font>向窗口发送一个<font
FACE="Times New Roman">WM_ERASEBKGND</font>消息通知该窗口擦除背景，可以使用</font> 
</p>

<p><font SIZE="+0"><font FACE="Times New Roman">ClassWizard</font>重载该消息的缺省处理程序来擦除背景（实际是画），并返回<font
FACE="Times New Roman">TRUE</font>以</font> </p>

<p><font SIZE="+0">防止<font FACE="Times New Roman">Windows</font>擦除窗口。</font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">//Paint area that needs to be erased.</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">BOOL CSampleView : : OnEraseBkgnd (CDC* pDC)</font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">{</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">// Create a pruple brush.</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">CBrush Brush (RGB (128 , 0 , 128) );</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">// Select the brush into the device context .</font> 
</p>

<p><font SIZE="+0"><font FACE="Times New Roman">CBrush* pOldBrush = pDC</font>―<font
FACE="Times New Roman">&gt;SelcetObject (&amp;brush);</font></font> </p>

<p><font SIZE="+0" FACE="Times New Roman">// Get the area that needs to be erased .</font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">CRect reClip ;</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">pDC</font>―<font FACE="Times New Roman">&gt;GetCilpBox 
(&amp;rcClip);</font></font> </p>

<p><font SIZE="+0" FACE="Times New Roman">//Paint the area.</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">pDC</font>―<font FACE="Times New Roman">&gt; 
PatBlt (rcClip.left , rcClip.top ,</font></font> </p>

<p><font SIZE="+0" FACE="Times New Roman">rcClip.Width ( ) , rcClip.Height ( ) , PATCOPY 
);</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">//Unselect brush out of device context .</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">pDC</font>―<font FACE="Times New Roman">&gt;SelectObject 
(pOldBrush );</font></font> </p>

<p><font SIZE="+0" FACE="Times New Roman">// Return nonzero to half fruther processing .</font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">return TRUE;</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">}</font> </p>

<p><a NAME="tip23"></a><b><font SIZE="+2"><font FACE="Times New Roman">23</font><font
FACE="黑体">、如何改变窗口标题</font></font></b> </p>

<p><font SIZE="+0">调用<font FACE="Times New Roman">CWnd : : SetWindowText</font>可以改变任何窗口（包括控件）的标题。</font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">//Set title for application's main frame window 
.</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">AfxGetMainWnd ( ) </font>―<font
FACE="Times New Roman">&gt; SetWindowText (_T(&quot;Application title&quot;) );</font></font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">//Set title for View's MDI child frame window .</font> 
</p>

<p><font SIZE="+0"><font FACE="Times New Roman">GetParentFrame ( ) </font>―<font
FACE="Times New Roman">&gt; SetWindowText (&quot;_T (&quot;MDI Child Frame new 
title&quot;) );</font></font> </p>

<p><font SIZE="+0" FACE="Times New Roman">//Set title for dialog's push button control.</font> 
</p>

<p><font SIZE="+0"><font FACE="Times New Roman">GetDigitem (IDC_BUTTON) </font>―<font
FACE="Times New Roman">&gt; SetWindowText (_T (&quot;Button new title &quot;) );</font></font> 
</p>

<p><font SIZE="+0">如果需要经常修改窗口的标题（注：控件也是窗口），应该考虑使用半文档化</font> 
</p>

<p><font SIZE="+0">的函数<font FACE="Times New Roman">AfxSetWindowText</font>。该函数在<font
FACE="Times New Roman">AFXPRIV.H</font>中说明，在<font FACE="Times New Roman">WINUTIL.CPP</font>中实现，在</font> 
</p>

<p><font SIZE="+0">联机帮助中找不到它，它在<font FACE="Times New Roman">AFXPRIV.H</font>中半文档化， 
在以后发行的<font FACE="Times New Roman">MFC</font>中将文档化。</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">AfxSetWindowText</font>的实现如下：</font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">voik AFXAPI AfxSetWindowText (HWND hWndCtrl , 
LPCTSTR IpszNew )</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">{</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">itn nNewLen= Istrlen (Ipaznew);</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">TCHAR szOld [256];</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">//fast check to see if text really changes 
(reduces flash in the controls )</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">if (nNewLen &gt;_contof (szOld) </font>｜｜</font> 
</p>

<p><font SIZE="+0"><font FACE="Times New Roman">: : GetWindowText (hWndCrtl , szOld , 
_countof (szOld) !=nNewLen </font>｜｜</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">Istrcmp (szOld , IpszNew )! = 0</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">{</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">//change it</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">: : SetWindowText (hWndCtrl , IpszNew );</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">}</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">}</font> </p>

<p><a NAME="tip24"></a><b><font SIZE="+2"><font FACE="Times New Roman">24</font><font
FACE="黑体">、如何防止主框窗口在其说明中显示活动的文档名</font></font></b> 
</p>

<p><font SIZE="+0">创建主框窗口和<font FACE="Times New Roman">MDI</font>子窗口进通常具有<font
FACE="Times New Roman">FWS_ADDTOTITLE</font>风格位， 如果不希望在</font> </p>

<p><font SIZE="+0">说明中自动添加文档名， 必须禁止该风格位， 
可以使用<font FACE="Times New Roman">ClassWizard</font>重置</font> </p>

<p><font SIZE="+0"><font FACE="Times New Roman">CWnd: : PreCreateWindow</font>并关闭<font
FACE="Times New Roman">FWS_ADDTOTITLE</font>风格。</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">BOOL CMainFrame : : PreCreateWindow 
(CREATESTRUCT&amp;cs)</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">{</font> </p>

<p><font SIZE="+0" FACE="Times New Roman">//Turn off FWS_ADDTOTITLE in main frame .</font> 
</p>

<p><font SIZE="+0"><font FACE="Times New Roman">cs.styel &amp; = ~FWS_ADDTOTITLE ;</font>　</font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">return CMDIFrameWnd : : PreCreateWindow (cs );</font> 
</p>

<p><font SIZE="+0" FACE="Times New Roman">}</font> </p>

<p><font SIZE="+0">关闭<font FACE="Times New Roman">MDI</font>子窗口的<font
FACE="Times New Roman">FWS _ADDTOTITLE</font>风格将创建一个具有空标题的窗口，可以调</font> 
</p>

<p><font SIZE="+0">用<font FACE="Times New Roman">CWnd: : SetWindowText</font>来设置标题。记住自己设置标题时要遵循接口风格指南。</font> 
</p>
</body>
</html>
