<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>您现在的位置是</title>
</head>

<body>

<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="100%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="../progidx.htm">编程技巧</a> --&gt; 
      <a href="pow_idx.htm">        
    PowerBuilder</a></b></span></td>      
  </tr>      
</table>      
</center></div><div align="center"><center>      
      
<table border="1" width="100%" style="font-size: 9pt" bgcolor="#FFFFFF"      
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">      
  <tr>      
    <td width="85%" align="left" valign="top"><table border="1" width="32%" style="font-size: 9pt" height="30"      
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"      
    bordercolordark="#FFFFFF">      
      <tr>      
        <td width="100%" bgcolor="#4264B5"><p align="center"><span style="font-size: 9pt"><font      
        color="#FFFFFF">资料整理&middot;<a href="http://chinaprog.yeah.net" target="_blank"      
        style="color: rgb(255,255,255)">中国程序员网站</a></font></span></td>      
      </tr>      
    </table>      
      <p align="center">PowerBuilder的大文本数据打印<br>
      <br>
                 胜利油田钻井信息中心   崔杰----饶蕾       
      <p><br> 
      <br> 
      ----1991年6月，美国著名的数据库应用开发工具生产厂家PowerSoft公司推出了功能强大的开发工具PowerBuilder，这是一套客户/服务器体系结构、面向对象的数据库应用开发工具，这确实是一件令人振奋的事情。但在PowerBuilder4.0及最新推出的powerBuilder6.0版中，均未解决大文本数据的打印问题。在企业管理中，经常打印几页甚至几十页长的材料，这个材料可能长，也可能短，（在PB中存放大文本的单机库数据类型是LongVarchar），利用程序设计批量打印，设计此类数据高度时，不知道设计多高，（若设计不合适，短数据量会造成打印空行或空页，而长数据量又可能造成只打印了部分数据的情况），虽然程序设计时有AutoHeight属性，但在实际运行时效果并不理想，因此，此问题的解决具有重要意义。下面，我介绍一种利用Powersoft Script函数来解决此问题的方法：<br> 
      <br> 
      ----例如，对于表text,其字段如下：<br> 
      <br> 
      1、姓名name char(8)；<br> 
      2、性别sex char(2)；<br> 
      3、出生日期birthday date；<br> 
      4、个人简历resume long；<br> 
      <br> 
      Name(姓名) Sex(性别) BirthDay(生日)<br> 
      resume(个人简历)<br> 
      张三 男 1950.09.12&nbsp;<br>
      55.9.1北京市光明 小学<br> 
      60.9.1北京市南安中学<br> 
      70. 8.1.清华大学毕业，在原子能研究所工作。<br> 
      71年获国家项目设计一等奖，同年，被评为先进个人。<br> 
      72年………(等等)<br> 
      李四 男 1985.02.12<br> 
      90. 9.1在南京市上福利小学<br> 
      95.9.1毕业，正选择中学就读<br> 
      <br> 
      ----里面有张三，李四两条记录。张三经历丰富，可能在resume栏中内容很多，从小学到大学，及至工作20年来的所有经历，能写成一篇文章了；而李四刚小学毕业，那么resume栏中内容就很少。<br> 
      <br> 
      ----由于大文本字段其数据量大，数据长度不一定，在设计打印数据窗口时，这种字段的高度不好定位，如果按最大可能高度定位（这个高度也不好掌握），对于小数据就会出现打印空行，甚至空页的情况。<br> 
      <br> 
      ----为了解决这个问题，我们用程序来控制这种字段高度。(以text表为例)：<br> 
      <br> 
      ----1、以自由格式定义一个数据窗口，保存这种缺省状态(resume字段高度为缺省高度)；生成一个窗口，窗口中包含上述数据窗口(被定义成dw_1）；窗口中还有上翻(cb_1)，下翻(cb_2)两个按钮。<br> 
      <br> 
      ----（下面的程序行，根据实际情况写到cb_1或cb_2按钮中。）<br> 
      <br> 
      ----2、获得要打印的记录的resume字段中数据，放到变量field中<br> 
      dw_1.scrollnextrow()：<br> 
      string field<br> 
      field=dw_1.getitemstring(1,”resume”)&nbsp;<br>
      //假设，这是第一行张三的数据<br>
      <br>
      ---- 3、我们用B5纸打印，字体为PowerBuilder缺省字体(T Arial)，可计算出每行59个字符，字体高度为80个点。那么用如下程序可计算field变量的内容占用的打印高度：&nbsp;<br>
      <br>
      int i<br> 
      long tt<br> 
      tt=len(field) //获得这个变量的长度<br> 
      i=(int(tt)/59)*80+1 //计算出高度点，<br> 
      <br> 
      ---- 4、改变resume字段高度。&nbsp;<br>
      <br>
      ----dw_1.Describe(“resume.Height”)&nbsp;<br>
      <br>
      ----dw_1.Modify(“resume.Height=string(i)”)&nbsp;<br>
      <br>
      ----程序每打印一条记录，就调用上诉2,3,4步骤的程序行，将resume字段高度，随resume内容的长度改变而改变，就可动态改变字段高度，从而保证纸张资源的充分利用，不打印行或空页。 
    </td>     
  </tr>     
</table>     
</center></div>     
<p>　</p>

</body>

</html>
