<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title>用 Foxpro 制 作 Windows 输 入 法 码 表</title>
</head>

<body style="font-size: 9pt" background="../../res/back.JPG">

<table border="0" width="100%" style="font-size: 9pt">
  <tr>
    <td width="100%" align="center"><strong>用Foxpro制作Windows输入法码表</strong></td>
  </tr>
  <tr>
    <td width="100%" align="center">文/李继宏 录入/江湖小子</td>
  </tr>
  <tr>
    <td width="100%" align="center">1999.08.07</td>
  </tr>
  <tr>
    <td width="100%" align="center"></td>
  </tr>
</table>

<p>摘 　 要： 本 文 介 绍 了 一 种 制 作Windows 汉 字 输 入 法 码 表 
的 方 法 ， 其 特 点 是 自 动 生 成 编 码 及 码 表 文 件 。 <br>
关 键 词： 码 表 生 成 器 、 码 表 编 译 、 排 序 、 词 组 文 本 文 
件 、 词 组 库 文 件 、Windows 码 表 文 件 。 <br>
Windows 的 码 表 生 成 器 为 人 们 提 供 了 自 制 汉 字 输 入 法 的 
手 段 ， 但 在 编 译 前 需 做 大 量 的 预 备 工 作 ， 在 实 际 操 
作 过 程 中 存 在 着 以 下 三 方 面 的 问 题 ， 现 以 制 作 五 笔 
字 型 输 入 法 为 例 加 以 分 析： <br>
<br>
1. 格 式 问 题 　 我 们 虽 然 能 从 许 多 汉 字 系 统 中 取 得 五 笔 
字 型 码 表, 但 这 些 码 表 格 式 很 少 与Windows 码 表 格 式 相 同, 
因 此 在 用 码 表 生 成 器 编 译 前 需 进 行 格 式 调 整； <br>
<br>
<br>
2. 编 码 问 题 　 从 任 何 一 个 汉 字 系 统 都 只 能 得 到 数 量 有 
限 的 词 条 ， 因 此 我 们 有 必 要 根 据 需 要 自 建 词 组 ， 或 
把 非 五 笔 字 型 输 入 法（ 如Windows3.2 中 的 郑 码） 中 大 量 的 
词 组 增 加 到 五 笔 字 型 输 入 法 中 ， 而 为 这 些 词 组 逐 一 
人 工 编 码 既 费 时 又 易 错； <br>
<br>
<br>
3. 编 译 限 制 　Windows 中 的 码 表 生 成 器 在 对 没 有 按 编 码 排 
序 的 码 表 文 件 编 译 时 需 要 排 序 ， 但 这 时 它 能 实 际 接 
受 的 最 大 编 码 数 为16000 条 左 右 ， 超 过 的 部 分 则 无 法 处 
理 ， 而 且 排 序 时 间 较 长 。 针 对 上 述 问 题 ， 我 用Foxpro 编 
制 了 一 段 程 序 ， 能 较 满 意 地 解 决 以 上 问 题 ， 其 特 点 
为： <br>
<br>
自 动 生 成 编 码 。 只 需 从 任 一 汉 字 输 入 法 中 提 取 词 组 
并 舍 去 其 编 码 ， 再 不 需 做 任 何 格 式 调 整 ， 这 样 我 们 
就 会 有 众 多 词 组 源 可 以 利 用 。 <br>
<br>
自 动 生 成Windows 的 码 表 文 件 。 由 于 在 生 成 码 表 文 件 时 就 
已 对 编 码 做 了 排 序 处 理 ， 因 而 无 需Windows 的 码 表 编 译 器 
再 排 序(Sort=0) ， 从 而 不 但 省 去 了 费 时 的 排 序 过 程 ， 而 
且 使 编 码 数 目 几 乎 没 有 限 制 。 <br>
一 、 程 序 说 明 <br>
本 程 序 涉 及 的 库 文 件 结 构 为: <br>
<br>
Field Field Name Type Width Dec <br>
1 CODE Character 4 <br>
2 WORD Character 22 <br>
<br>
<br>
程 序 运 行 之 前 ， 需 制 作 两 个 库 文 件：&quot; 单 字.DBF&quot; 和&quot; 
字 码.DBF&quot; 。 &quot; 单 字.DBF&quot; 存 放 每 个 汉 字 的 一 、 二 、 
三 、 四 级 五 笔 字 型 编 码 。&quot; 单 字.DBF&quot; 可 以 从 其 他 
汉 字 系 统 的 五 笔 字 型 码 表 文 件 中 取 得 。 将 取 得 的 单 
个 汉 字 及 其 编 码 添 加 到&quot; 单 字.DBF&quot; 即 可 。 <br>
<br>
<br>
&quot; 字 码.DBF&quot; 中 的Word 字 段 是6850 个 汉 字 ，Code 字 段 是 每 
个 汉 字 五 笔 字 型 编 码 的 前 二 码 。&quot; 字 码.DBF&quot; 可 以 
利 用&quot; 单 字.DBF&quot; 制 作: 先 删 除 其 中 的 一 级 简 码, 再 取 
得 每 个 汉 字 和 其 编 码 的 前 两 码, 最 后 删 除 相 同 的 记 录 
。 <br>
<br>
二 、 运 行 过 程 <br>
1. 运 行 程 序 的 第 一 步 ， 将 要 增 加 的 词 组 文 本 文 件&amp;AppFile..txt 
增 补 到 库 文 件&amp;AppDBFile..dbf 的Word 字 段 中； <br>
<br>
2. 调 用 过 程DelExistWord 删 除 库 文 件&amp;AppDBFile..dbf 中 与 词 组 库 
文 件&quot; 词 组 库.dbf&quot; 重 复 的 记 录 ， 以 保 证 增 加 时 不 
会 重 复 加 入&quot; 词 组 库.dbf&quot; 中 已 有 的 词 组； <br>
<br>
<br>
3. 调 用 过 程Generate_WBCode 生 成 库 文 件&amp;AppDBFile..dbf 中Code 字 段 
的 五 笔 字 型 编 码 。 首 次 运 行 时 ， 本 程 序 将 生 成 库 文 
件&quot; 词 组 库.dbf&quot; ， 以 后 运 行 时 ， 会 把 欲 增 加 的 词 
组 及 其 编 码 增 补 到 库 文 件&quot; 词 组 库.dbf&quot; 中 。 在 生 
成 编 码 时 要 用 到 库 文 件&quot; 字 码.dbf&quot; 及 其 关 于Word 字 
段 的 索 引 文 件&quot; 字 码.cdx&quot;； <br>
<br>
<br>
4. 调 用 过 程ToWinForm 生 成Windows 码 表 文 件 。 运 行 中 用&quot; 单 
字.dbf&quot; 和&quot; 词 组 库.dbf&quot; 合 成 所 有 汉 字 、 词 组 的 编 
码 库 文 件MBase.dbf 并 生 成 其 索 引 文 件MBase.cdx 。 最 后 由MBase.bdf 
生 成Windows 的 码 表 文 件&quot; 五 笔 字 型.txt&quot; 。 <br>
<br>
三 、 程 序 清 单 <br>
Set Talk Off<br>
Set Notify Off<br>
Clear<br>
* 将此程序所在路径设为默认路径<br>
ProgPath=Substr(SYS(16),1,RAT('\',SYS(16))-1)<br>
Set Default To &amp;ProgPath<br>
AppFile = GetFile('TXT', '要增加的词组文件.TXT:', '选择')<br>
AppDBFile= Stuff(AppFile,AT('TXT',AppFile),3,'DBF')<br>
If File(AppDBFile)<br>
&nbsp;&nbsp;&nbsp; Delete File &amp;AppDBFile<br>
EndIf&nbsp;&nbsp;&nbsp; <br>
Create &amp;AppDBFile From Struc<br>
Use &amp;AppDBFile Alias App<br>
Append From &amp;AppFile Fields Word Deli<br>
Delete All For Len(alltrim(word))=0<br>
Pack<br>
If File('词组库.DBF')<br>
Set Message To &quot;删除与'词组库.DBF'重复的词组&quot;<br>
Do DelExistWord<br>
EndIf<br>
Set Message To '正在生成编码'<br>
Do Generate_WBCode<br>
If File('词组库.DBF')<br>
Set Message To '增补到词组库并重新索引'<br>
Use词组库<br>
Append From &amp;AppDBFile<br>
Else<br>
Set Message To '建立词组库和其索引'<br>
Copy File &amp;AppDBFile To词组库.DBF<br>
Use词组库<br>
Index On code Tag code<br>
&nbsp;&nbsp;&nbsp; Index On Word Tag Word Of词组库<br>
EndIf<br>
Use<br>
Delete File &amp;AppDBFile<br>
Set Message To '正在生成Windows的码表文件'<br>
Do ToWinForm<br>
Set Message To 'Windows格式码表文件生成完毕!'<br>
Wait Window TimeOut 5<br>
Set Talk On<br>
Set Notify On<br>
Set Message To<br>
Return<br>
* ******** 子过程 ***********<br>
&amp;&amp;检查是否和'词组库.DBF'有重码<br>
Procedure DelExistWord<br>
Select 0<br>
Use词组库<br>
Set Order to Word<br>
Select App<br>
Set Relation To Word Into词组库<br>
Go Top<br>
Do While .Not.Eof('App')<br>
IF .Not.Eof('词组库')<br>
Delete<br>
EndIf<br>
Skip<br>
EndDo&nbsp;&nbsp;&nbsp; <br>
Pack<br>
Select词组库<br>
Use<br>
Return<br>
<br>
&amp;&amp;生成五笔字型编码<br>
Procedure Generate_WBCode<br>
Private WBCode,WordString,WordLength,I<br>
Select 0<br>
Use字码 Order Tag Word of字码<br>
Select App<br>
Goto Top<br>
Do While .Not.Eof('App')<br>
WBCode=''<br>
WordString=Word<br>
WordLength=Len(AllTrim(WordString))<br>
Select字码<br>
Do Case<br>
Case WordLength=4<br>
For I=1 TO 2<br>
ZI=SubStr(WordString,2*I-1,2)<br>
Find &amp;ZI<br>
WBCode=WBCode+Code<br>
Next<br>
Case WordLength=6<br>
For I=1 TO 3<br>
ZI=SubStr(WordString,2*I-1,2)<br>
Find &amp;ZI<br>
Do Case<br>
Case I=1 .OR. I=2<br>
WBCode=WBCode+SubStr(Code,1,1)<br>
Case I=3<br>
WBCode=WBCode+Code<br>
EndCase<br>
Next<br>
Case WordLength=8<br>
For I=1 TO 4<br>
ZI=SubStr(WordString,2*I-1,2)<br>
&nbsp;&nbsp;&nbsp; Find &amp;ZI<br>
WBCode=WBCode+SubStr(Code,1,1)<br>
Next<br>
Case WordLength&gt;8<br>
For I=1 TO 3<br>
&nbsp;&nbsp;&nbsp; ZI=SubStr(WordString,2*I-1,2)<br>
Find &amp;ZI<br>
WBCode=WBCode+SubStr(Code,1,1)<br>
Next<br>
ZI=SubStr(WordString,WordLength-1,2)<br>
Find &amp;ZI<br>
WBCode=WBCode+SubStr(Code,1,1)<br>
EndCase<br>
Select App<br>
Replace Code With WBCode<br>
Skip<br>
EndDo<br>
Close Databases<br>
Return<br>
<br>
&amp;&amp;生成Windows格式码表文件<br>
Procedure ToWinForm<br>
Private Head,Word_Code,txt,i<br>
<br>
If File('MBase.DBF')<br>
Delete File MBase.DBF<br>
Delete File MBase.CDX<br>
EndIf&nbsp;&nbsp;&nbsp; <br>
Create MBase From Struc<br>
Append From单字<br>
Append From词组库<br>
Index On Code Tag Code Of Mbase<br>
<br>
Dimension MbHead[7]<br>
Dimension Word_Code[2]<br>
MbHead[1]= '[Description]'<br>
MbHead[2]= 'Name=五笔字型'<br>
MbHead[3]= 'MaxCodes = 4'<br>
MbHead[4]= &quot;UsedCodes='abcdefghijklmnopqrstuvwxy&quot;<br>
MbHead[5]= 'WildChar=z'<br>
MbHead[6]= 'Sort=0'<br>
MbHead[7]= '[text]' <br>
<br>
MBText= '五笔字型.txt'<br>
txt=FCreate(MBText)<br>
For i=1 to 7<br>
= Fputs(txt,MbHead[i])<br>
Next<br>
Goto Top<br>
Do While .Not.Eof()<br>
Scatter TO Word_Code<br>
Skip<br>
= Fputs(txt,AllTrim(Word_Code[2])+AllTrim(Word_Code[1]))<br>
EndDo<br>
Use<br>
=FClose(txt)<br>
Delete File MBase.DBF<br>
Delete File MBase.CDX<br>
Return<br>
该 程 序 使 用 的 机 器 为386DX33,4M ， 在Foxpro For Windows2.5b 环 境 下 
运 行 通 过 。 <br>
<br>
<br>
</p>
</body>
</html>
