<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title></title>
</head>

<body background="../../res/back.JPG">
<div align="center"><center>

<table border="0" width="560" height="4" cellspacing="0" cellpadding="0">
  <tr>
    <td width="570" height="8"><span style="font-size: 9pt"><font face="宋体" size="2"><p
    align="center"></font><strong>FOXPRO FOR WINDOWS报表生成器使用技巧</strong></span></td>
  </tr>
  <tr>
    <td width="570" height="9"><span style="font-size: 9pt"><p align="center">(国防科技大学 
    王军 王国玉 廖湘平)</span></td>
  </tr>
  <tr>
    <td width="570" height="8"><span style="font-size: 9pt"><p align="center">录入:江湖小子</span></td>
  </tr>
</table>
</center></div>

<p><span style="font-size: 9pt">摘要: 
本文在阐述报表生成器一般使用技巧的同时，针对财务报表的特殊要求，讨论用编程方式实现特殊输出格式的方法。<br>
<br>
关键词: FOXPRO数据库报表编辑<br>
<br>
1 引言<br>
<br>
FOXPRO FOR WINDOWS数据库管理系统以其执行速度快、界面友好、使用方便而赢得广大用户和编辑人员的喜爱。其功能强大的屏幕生成器、菜单生成器、报表生成器等编程工具可以快速生成程序原型，极大的减轻了编辑的工作量，提高了编辑人员的工作效率。<br>
<br>
FOXPRO的REPORT WRITER报表生成器可以对单个数据库或多个数据库通过关联方式来产生报表。其数据来源可以是内存变量，也可以是数据库中的记录。<br>
<br>
报表的封面，表头，表体，表尾分别对应REPORT WRITER的不同的带(BAND)。一般在TITLE带里制作封面：在HEADER带里制作各种表头：在DETAIL带里制作表体；在FOOTER或SUMMERY带里制作表尾。<br>
<br>
2 制表<br>
<br>
一张表的制作过程主要有如下几个步骤：<br>
<br>
(1)打开要制表的各个相关的数据库，设置索引，设置数据库的关联。<br>
<br>
(2)当前工作区选择到主库工作区。<br>
<br>
(3)用FILE菜单生成一个新表，选择系统菜单中的REPORT选项，在弹出的下拉菜单中选择Quick 
Repor选项，在弹出的对话框中点击Field可以选择要输出的域：点击Titles可以在HEADER带里输出或取消字段名；点出Add 
Alias可以在每个字段变量前加上当前工作区数据库的别名。确认后即可自动在报表各个带里摆放相应的域变量和变本。建议不要加别名，否则当多个数据库共用一张表时，会出现找不到变量的错误!<br>
<br>
(4)用画线工具画出适当的表格线，用Object下拉菜单中的Text Alignment设置各个域的对齐方式，画出表头和表尾，一张表就基本上制作完了。<br>
<br>
(5)保存设计的报表。系统提问是否保存环境时，如果选择保存则当程序中调用报表文件时，系统会自动打开相应数据库并设置相应的关联；如果选择放弃，当程序中调用报表文件时，要编辑打开相应的数据库并设置相应的关联。<br>
<br>
只是在保存一张新表时系统才提示是否保存环境。对于已有的表，可以选择REPORT下拉菜单中Layout选项，设置保存或清除环境。<br>
<br>
3 制表的技巧<br>
<br>
(1)表格线对齐：<br>
<br>
通常表格线对齐是用鼠标拖曳线段的段点，往往不易作到一次就能对齐，经常需要反复调整，实际上，当需要按象素调整线段的长度时，可以采用如下的方法：<br>
<br>
水平线段，鼠标点击线段右端点，线段向右拉长一个象素，左段点位置不变；点击左端点，线段向右缩短一个象素，右段点位置不变，用这种方法，便于精确对齐。<br>
<br>
同样，对垂直线段，点击上端或下端，分别向下缩短或拉长一个象素。这种方法同样适合于屏幕生成器画线的对齐。<br>
<br>
(2)对象组的选取：<br>
<br>
在制表的过程中，经常要移动各个带里的对象的摆放位置，或者把一个带里的对象拷贝到其它带里，把要移动的对象标记为一个对象组会使对象移动或拷贝的操作更加方便，标记对象组的方法有如下几种：<br>
<br>
〈1〉当要标记一个带里的所有对象时,可以用鼠标双击该带下端的分隔条,选取该带里的所有对象,然后选择OBJECT下拉菜单中的Group选项,把所有选取的对象标记为一个对象组,方便移动或拷贝。<br>
<br>
〈2〉当要标记相邻的多个对象时，用鼠标拖曳出一矩形框，使要选取的对象落入矩形框中，释放鼠标，则可同时选取多个对象。<br>
<br>
〈3〉当要标记不相邻的多个对象时，按下SHIFT键，同时鼠标点击要选取的对象，选中后再组合为一个对象组。当同时移动多个对象时，如果不把这些对象标记为一个对象组，则当用光标多次移动对象位置时，FOXPRO会报内存不够的错误信息。<br>
<br>
(3)对象的条件打印：<br>
<br>
制表时经常要控制在特定条件下打印特定的信息，这可以用对象的条件打印来实现，我们以页号的输出为例来讨论对象的条件打印。通常页号的输出直接利用系统变量_pageno来打印阿拉伯数字，现在我们页号变为中文一、二、三(假设不超过十页文本)等。利用文本输入工具，在报表中创建文本对象“一”、“二”“三”等，鼠标双击“一”，在弹出的对话框中选择print 
When，在弹出的打印条件设置对话框中点击print only when选择框，在表达式中填入_pageno=1，确认后退出。<br>
<br>
如上操作，对文本对象“二”设置其打印条件为_pageno=2；对文本对象“三”设置其打印条件_pageno=3。设置完成各个文本对象的打印打件后，把它们移动到要输出页号的位置，重叠放置。用预示功能查看，可看到页号已变成中文数字。<br>
<br>
4 编辑实现特殊内容特殊打印<br>
<br>
对于格式比较特殊的表格，一般要采取编程的方式进行处理。对于需制表的数据库先添加必要的格式控制字段，即在定义库结构时多定义几个辅助字段，以利于控制表格的输出格式。<br>
<br>
然后编程在数据库的格式控制字段中添入不同的字符或数字，以便达到特殊的输出效果。<br>
<br>
以帐务报表输出为例：表1所示为一简化的财务年度后表中的某一页，列1输出的是记帐日期，列2输出的是摘要，列3、列4、列5输出的分别是借方金额、贷方金额、期末余额。<br>
<br>
在年度报表中，月底应打印输出本月的借、贷金额合计及期末余额；截止本月的借、贷金额累计及期末余额。为醒目起见，相应的摘要“本月合计”、“本月累计”以不同于其以不同于其它摘要的较大字体输出，相应的数字也以不同的字体输出，如表1中大写“XXXX”与小写的“xxxx”所示。大写“XXXX”表示要以特殊字体输出。显然，对这样的报表不借助于编辑直接利用报表生成器是难以达到要求的效果的。<br>
<br>
上述报表的实现方法如下：在表1对应的数据库中填加rpt_format辅助字段，编辑对正常输出格式的记录在rpt_format字段置1，对特殊的输出格式如要输出“本月合计”的记录在rpt_format字段置2；输出“本月累计”的记录在rpt_format字段置3。<br>
用报表生成器创建表1的报表文件，采用对象的条件打印方法，对列2到列5对应的各变量设置其打印条件为rpt_format=1。用文本输入工具创建“本月合计”、“本月累计”的文本对象，设置好打印的字体(不同于一般摘要的输出字体)，并设置其打印条件分别为rpt_format=2、rpt_format=3。把这两个文本对象重叠放置到要输出的摘要的位置。<br>
<br>
用打印预示功能显示报表，可看到“本月合计”、“本月累计”的输出字体区别于其它摘要的字体。用这种方法，可以作到特殊内容特殊打印由于我们对列3到列5的打印对象都加上了rpt_format=1的打印打件，因此不含“本月合计”、“本月累计”的输出行可看到借方、贷方、余额等金额数字，而对应“本月合计”、“本月累计”的输出行却看不到这几个金额数字，这是因为我们还没有创建相关的对象。<br>
<br>
在报表生成器中利用域变量定义工具创建三个变量，变量名分别为m_jfje、 
m_dfje、m_qmye，分别表示借方、贷方、余额的数值。设置好要打印的字体，并设置它们的打印条件为rpt_format=2ORrpt_format=3，问题是怎样使其能够反映数据库中对应记录的值?解决这个问题要用到报表生成器的变量定义功能。<br>
<br>
鼠标点击系统菜单上的REPORT选项，在下拉中菜单选择Variables项，点击Add增加变量，在弹出的对话框中敲入变量名m_jfje，在Value 
to Store下键入jfje(此外假设表1对应的数据库借方金额字段名为jfje)，确认后退出，如上操作，再增加m_dfje，m_qmye两个变量，并把数据库中相应的贷方金额和期末余额段名分别赋予这两个变量。<br>
<br>
预示报表，可看到我们要求的输出格式已经实现。<br>
<br>
综合利用编程与对象的条件打印还可以实现文字的纵向打印，如打印如下输出格式的报表：<br>
<br>
列1 列2 列3<br>
…… …… …… <br>
纵 正常打印1 正常打印1<br>
向 正常打印2 正常打印2<br>
打 正常打印3 正常打印3<br>
印 正常打印4 正常打印4<br>
…… …… ……<br>
表2<br>
<br>
如表2所示的报表，第一列表是把一段文字按纵向打印，一般有两种一种实现方法，一是要在打印输出的数据库中增加列1对应的字段，预先把纵向输出的文字保存到对应的记录中，打印时即可纵向输出，这种方法实现起来简单些。<br>
<br>
另一种方法是在屏幕上创建要纵向输出的文本对象，设置其打印打件，然后重叠放置到合适的位置，在要打印输出的数据库中增设格式控制域，在对应的记录中利用格式控制域设置各个对象的输出打印条件，应注意这些条件应是互斥的，否则会出现重叠打印的现象，对表2所示的报表，假设数据为rpt_dpt，其格式控制域为<br>
<br>
aux_rpt，可以这样设置：<br>
SELECTrpt_dpt<br>
GO TOP<br>
REPL aux_rpt WITH`L1'<br>
SKIP<br>
REPL aux_rptWITH`L2'<br>
SKIP<br>
REPL aux_rptWITH`L3'<br>
SKIP<br>
REPL aux_rptWITH‘L4’<br>
<br>
在REPORT WRITER中设置各个文本对象的PRINT WHEN条件如下：‘纵’字的 
Print/when为 aux_rpt=‘L1’，‘向’字的Print/when 为aux_rpt=“L2”，‘打’字的Print/when为 
aux_rpt=‘L3’‘印’字的Print/when 为aux_rpt=‘L1’，打印时即可得到纵向打印的效果。第二种方法实现起来麻烦些，适用于纵向输出的文字不是太多的场合，某特点是可以灵活控制要输出的文本对象的字体，在某些情况下还是有用的。<br>
<br>
5结束语<br>
<br>
本文讨论了用编程方式结合数据库辅助格式控制字段的定义来生成具有特殊格式要求的报表的一般方法。文中的讨论只在数据库中增加了一个辅助字段，当要求的输出格式更加复杂时，需增加多个辅助的格式控制字段，并通过编辑对不同的辅助字段赋予不同的控制码，相应的在报表文件中还应设置好各个对象的打印条件。<br>
<br>
</span></p>
</body>
</html>
