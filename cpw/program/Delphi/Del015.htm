<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0055)http://person.zj.cninfo.net/~lifu/netpage/delphi-sc.htm -->
<HTML><HEAD><TITLE>用Delphi开发windows95屏幕保护预览程序</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK 
href="用Delph.files/my.css" rel=stylesheet>
<META content="Microsoft FrontPage 4.0" name=GENERATOR></HEAD>
<BODY stylesrc="../../index1.htm" background="../../res/back.gif">
<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="95%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="../progidx1.htm">编程技巧</a> --&gt;  
      </b></span><SPAN class=p11><FONT class=p11>用Delphi开发windows95屏幕保护预览程序</FONT>（包 伟）</SPAN></td>  
  </tr>  
</table>  
</center></div><div align="center"><center>  
  
<table border="1" width="95%" style="font-size: 9pt" bgcolor="#FFFFFF"  
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">  
  <tr>  
    <td width="15%" align="center" valign="top"><!--webbot bot="Include" 
      U-Include="../progmenu.htm" TAG="BODY" startspan -->

<table border="1" width="13%" bordercolor="#000000" cellspacing="3" cellpadding="3" style="font-size: 9pt; border-style: solid; border-color: #FFFFFF">
  <tr>
    <td width="100%" align="center"><a href="../VisualC/Vcidx098.htm" target="_self"><strong>Visual 
      C</strong></a></td> 
  </tr> 
  <tr> 
    <td width="100%" align="center"><a href="../Vb/Vbidx099.htm" target="_self"><strong>VBasic</strong></a></td>
  </tr>
  <tr>
    <td width="100%" align="center"><strong><a href="../Vfp/Vfp_idx.htm" target="_self">VFoxpro</a></strong></td>
  </tr>
  <tr>
    <td width="100%" align="center"><strong><a href="Del_idx.htm" target="_self">Delphi</a></strong></td>
  </tr>
  <tr>
    <td width="100%" align="center"><a href="../powerbuild/pow_idx.htm" target="_self"><b>PowerBuilder</b></a></td>
  </tr>
  <tr>
    <td width="100%" align="center"><a href="../linux/linuxidx.htm" target="_self"><b>Linux</b></a></td>
  </tr>
  <tr>
    <td width="100%" align="center"><strong><a href="../other/oth_idx.htm" target="_self">其它</a></strong></td>
  </tr>
</table>
<!--webbot bot="Include" endspan i-checksum="43485" --> 
 
    </td> 
    <td width="85%" align="left" valign="top"><table border="1" width="32%" style="font-size: 9pt" height="30" 
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000" 
    bordercolordark="#FFFFFF"> 
      <tr> 
        <td width="100%" bgcolor="#4264B5"><p align="center"><span style="font-size: 9pt"><font 
        color="#FFFFFF">资料整理&middot;<a href="http://chinaprog.yeah.net" target="_blank" 
        style="color: rgb(255,255,255)">中国程序员网站</a></font></span></td> 
      </tr> 
    </table> 
      <p align="center"><B><SPAN class=p11><FONT class=p11>用Delphi开发windows95屏幕保护预览程序</FONT>（包 伟）</SPAN></B></p>  
      <p><br>  
      ---- 大 家 都 知 道windows 屏 幕 保 护 程 序 的 作 用,而 且 新 的 屏 幕 保 护 程 序 越 来 越 漂 亮.   
      如 果在win95 的 桌 面 右 键 菜 单 选 属 性, 就 弹 出 显 示器 设 置 界 面, 有 一 个 标 签 是 设 置 屏 幕 保 护   
      程序 的. <BR>---- 在 该 页 的 画 面 上, 有 一 个 显 示 器 图 案, 如果 你 选 择win95 所 带 的 屏 幕 保 护   
      程 序, 这 个 屏 幕保 护 程 序 就 会 在 这 个 小' 显 示 器' 上 自 动 运 行,你 可 以 直 接 看 到 运 行 效 果. 这   
      功 能 大 大 方 便了 屏 幕 保 护 程 序 的 选 择, 这 就 是win95 对 屏 幕 保护 程 序 的 新 增 接 口: 预 览 功   
      能. <BR>---- 目 前 大 多 数 新 推 出 的 屏 幕 保 护 程 序 都 支持 这 个 接 口. <BR>---- 屏 幕 保 护 程   
      序 从 它 的 诞 生 那 时 起, 在 同 一时 刻 只 能 运 行 一 个, 不 能 多 个 同 时 运 行, 然 而预 览 接 口 的 推   
      出, 使 同 时 预 览 多 个 屏 幕 保 护程 序 成 为 可 能, 本 文 将 向 读 者 介 绍 如 何用Delphi 开 发 这 样 一   
      个 程 序. <BR>---- 1. 屏 幕 保 护 预 览 接 口 <BR>---- 屏 幕 保 护 预 览 接 口 的 使 用 很 简 单, 这   
      是 通过 传 给 屏 幕 保 护 程 序 的 命 令 行 参 数 来 实 现 的, 该 命 令 行 参 数 格 式 为: <BR>----   
      screensaver.exe /p ##### <BR>---- 其 中##### 为 一 个 有 效 的 窗 口 句 柄 的10 进 制表 示.   
      <BR>---- 这 个 窗 口 我 们 可 以 称 之 为 预 览 窗 口. <BR>---- 实 际 上, 支 持 预 览 接 口 的 屏 幕   
      保 护 程 序 将自 己 的 窗 口 创 建 为 预 览 窗 口 的 子 窗 口 来 实 现预 览 功 能 的. <BR>---- 2. 画 面 布   
      局 <BR>---- 我 们 这 个 程 序 的 窗 口 分 为 3 部 分, 为 倒'品' 字 形, 上 左 部 分 列 出 所 有 可 用 的   
      屏 幕 保 护程 序, 上 右 部 分 列 出 所 有 预 览 的 屏 幕 保 护 程序, 下 面 当 然 是 预 览 窗 口 了.   
      <BR>---- 用Delphi 实 现 时, 首 先 在Form 里 放2 个TPanel 组件, Panel1 对 齐 方 式 为 顶 部 对   
      齐,Panel2 为 撑 满 用户 区, 再 在Panel1 中 放1 个TFileListBox 组 件 和 一个TListBox 组   
      件,FileListBox1 左 对 齐, ListBox1 撑 满用 户 区. <BR>---- 这 样, FileListBox1 为 屏 幕   
      保 护 列 表, ListBox1为 预 览 列 表, Panel2 为 预 览 窗 口. <BR>---- 3. 列 出 屏 幕 保 护 程 序.   
      <BR>---- 将FileListBox1 的Mask 属 性 设 为'*.scr', 这 是 屏幕 保 护 程 序 的 扩 展 名.   
      <BR>---- 在FormCreate 方 法 中 将FileListBox1.directory 设为windows 系 统 目   
      录GetSystemDirectory; <BR>---- 4. 预 览 屏 幕 保 护 程 序. <BR>----   
      在FileListBox1DblClick 方 法 中 运 行 该 屏 幕 保护 程 序, 并 将Panel2 的 窗 口 句 柄 传 给 它.   
      <BR>---- WinExec(pchar(FileListBox1.FileName + ' /p '   
      +inttostr(Panel2.handle)), SW_Show); <BR>---- 运 行 程 序, 怎 么 样? COOL!   
      <BR>---- 5. 增 加 一 些 新 特 性: 隐 藏/ 显 示/ 关 闭. <BR>---- 增 加2 个 函 数: 用 于 更   
      新ListBox1.<BR>function EnumProc(<BR>h : HWND ;// handle of child   
      window<BR>l : integer// application-defined value<BR>):   
      boolean;stdcall;<BR>var buf : array[0..255] of   
      char;<BR>begin<BR>GetWindowText(h, buf, sizeof(buf)- 1);<BR>if   
      iswindowvisible(h) then<BR>Form1.ListBox1.items.add<BR>(' ' +strpas(buf) +   
      ' : ' + inttostr(h))<BR>else<BR>Form1.ListBox1.items.add<BR>('-'   
      +strpas(buf) + ' : ' + inttostr(h));<BR>Result :=   
      true;<BR>end;<BR><BR>procedure   
      TForm1.Fresh1;<BR>begin<BR>ListBox1.clear;<BR>enumChildwindows(Panel2.handle,<BR>TFNWndEnumProc(@enumproc),   
      0);<BR>end;<BR><BR>---- 增 加 一 个 弹 出 菜 单Popupmenu1, 3 个 菜 单 项, 'Show, Hide,   
      Close', 将ListBox1.popupmemu 指 向Popupmenu1. <BR><BR>---- Hide 的 处 理 函 数 是:   
      <BR>procedure TForm1.Hide1Click(Sender: TObject);<BR>var h : integer;<BR>s   
      : string;<BR>begin<BR>if ListBox1.itemindex = -1 then exit;<BR>s :=   
      Listbox1.items[ListBox1.itemindex];<BR>h := strtoint(copy(s, pos(':', s) +   
      1, length(s)));<BR>ShowWindow(h, SW_HIDE);<BR>Fresh1;<BR>end;<BR>Show 的 处   
      理 函 数 是:<BR>procedure TForm1.Show1Click(Sender: TObject);<BR>var h :   
      integer;<BR>s : string;<BR>begin<BR>if ListBox1.itemindex = -1 then   
      exit;<BR>s := Listbox1.items[ListBox1.itemindex];<BR>h := strtoint(copy(s,   
      pos(':', s) + 1, length(s)));<BR>ShowWindow(h,   
      SW_SHOW);<BR>Fresh1;<BR>end;<BR>Close 的 处 理 函 数 是:<BR>procedure   
      TForm1.Close1Click(Sender: TObject);<BR>var h : integer;<BR>s :   
      string;<BR>begin<BR>if ListBox1.itemindex = -1 then exit;<BR>s :=   
      Listbox1.items[ListBox1.itemindex];<BR>h := strtoint(copy(s, pos(':', s) +   
      1, length(s)));<BR>PostMessage(h, WM_QUIT, 0,   
      0);<BR>Fresh1;<BR>end;<BR><BR>---- 本 程 序 在Delphi 3.0 下 调 试 通 过, 应 该 能   
      用Delphi 1.0 / 2.0 编 译. <BR><BR>---- 完 整 程 序 如 下: <BR><BR>unit   
      Unit1;<BR><BR>interface<BR><BR>uses<BR>Windows, Messages, SysUtils,   
      Classes, <BR>Graphics, Controls, Forms, Dialogs,<BR>StdCtrls, FileCtrl,   
      ExtCtrls, Menus;<BR><BR>type<BR>TForm1 = class(TForm)<BR>Panel1:   
      TPanel;<BR>Panel2: TPanel;<BR>FileListBox1: TFileListBox;<BR>ListBox1:   
      TListBox;<BR>PopupMenu1: TPopupMenu;<BR>Hide1: TMenuItem;<BR>Show1:   
      TMenuItem;<BR>Close1: TMenuItem;<BR>procedure FormCreate(Sender:   
      TObject);<BR>procedure FileListBox1DblClick(Sender: TObject);<BR>procedure   
      Hide1Click(Sender: TObject);<BR>procedure Show1Click(Sender:   
      TObject);<BR>procedure Close1Click(Sender: TObject);<BR>private<BR>{   
      Private declarations }<BR>public<BR>{ Public declarations }<BR>procedure   
      Fresh1;<BR>end;<BR><BR>var<BR>Form1:   
      TForm1;<BR><BR>implementation<BR><BR>{$R *.DFM}<BR>function EnumProc(<BR>h   
      : HWND ;// handle of child window<BR>l : integer// application-defined   
      value<BR>): boolean;stdcall;<BR>var buf : array[0..255] of   
      char;<BR>begin<BR>GetWindowText(h, buf, sizeof(buf)- 1);<BR>if   
      iswindowvisible(h) then<BR>Form1.ListBox1.items.add<BR>(' ' +strpas(buf) +   
      ' : ' + inttostr(h))<BR>else<BR>Form1.ListBox1.items.add<BR>('-'   
      +strpas(buf) + ' : ' + inttostr(h));<BR>Result :=   
      true;<BR>end;<BR><BR>procedure   
      TForm1.Fresh1;<BR>begin<BR>ListBox1.clear;<BR>enumChildwindows(Panel2.handle,<BR>TFNWndEnumProc(@enumproc),   
      0);<BR>end;<BR><BR>procedure TForm1.FormCreate(Sender: TObject);<BR>var   
      buf : array[0..256] of char;<BR>begin<BR>GetSystemDirectory(buf,   
      sizeof(buf) - 1);<BR>FileListBox1.directory :=   
      strpas(buf);<BR>ListBox1.popupmenu := Popupmenu1;<BR>end;<BR><BR>procedure   
      TForm1.FileList<BR>Box1DblClick(Sender:   
      TObject);<BR>begin<BR>WinExec(pchar(FileListBox1.FileName <BR>+ ' /p ' +   
      inttostr(Panel2.handle)),<BR>SW_Show);<BR>Fresh1;<BR>end;<BR><BR>procedure   
      TForm1.Hide1Click(Sender: TObject);<BR>var h : integer;<BR>s :   
      string;<BR>begin<BR>if ListBox1.itemindex = -1 then exit;<BR>s :=   
      Listbox1.items[ListBox1.itemindex];<BR>h := strtoint(copy(s, pos(':', s) +   
      1, length(s)));<BR>ShowWindow(h,   
      SW_HIDE);<BR>Fresh1;<BR>end;<BR><BR>procedure TForm1.Show1Click(Sender:   
      TObject);<BR>var h : integer;<BR>s : string;<BR>begin<BR>if   
      ListBox1.itemindex = -1 then exit;<BR>s :=   
      Listbox1.items[ListBox1.itemindex];<BR>h := strtoint(copy(s, pos(':', s) +   
      1, length(s)));<BR>ShowWindow(h,   
      SW_SHOW);<BR>Fresh1;<BR>end;<BR><BR>procedure TForm1.Close1Click(Sender:   
      TObject);<BR>var h : integer;<BR>s : string;<BR>begin<BR>if   
      ListBox1.itemindex = -1 then exit;<BR>s :=   
      Listbox1.items[ListBox1.itemindex];<BR>h := strtoint(copy(s, pos(':', s) +   
      1, length(s)));<BR>PostMessage(h, WM_QUIT, 0,   
      0);<BR>Fresh1;<BR>end;<BR><BR>end.  
    </td>  
  </tr>  
  <tr>  
    <td width="100%" colspan="2" align="center" valign="top">　</td>  
  </tr>  
</table>  
</center></div>  
</BODY></HTML>  
