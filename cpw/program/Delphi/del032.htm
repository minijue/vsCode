<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>您现在的位置是</title>
</head>

<body>

<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="100%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="../progidx.htm">编程技巧</a> --&gt; 
      <a href="Del_idx.htm">DELPHI</a></b></span></td>      
  </tr>      
</table>      
</center></div><div align="center"><center>      
      
<table border="1" width="100%" style="font-size: 9pt" bgcolor="#FFFFFF"      
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">      
  <tr>      
    <td width="85%" align="left" valign="top"><table border="1" width="32%" style="font-size: 9pt" height="30"      
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"      
    bordercolordark="#FFFFFF">      
      <tr>      
        <td width="100%" bgcolor="#4264B5"><p align="center"><span style="font-size: 9pt"><font      
        color="#FFFFFF">资料整理&middot;<a href="http://chinaprog.yeah.net" target="_blank"      
        style="color: rgb(255,255,255)">中国程序员网站</a></font></span></td>      
      </tr>      
    </table>      
      <p align="center">如何在DELPHI中使用系统状态栏图标<br>
      <br>
                                陆坦      
      <p><br>
      ----SYSTRAY ICON就是在WINDOWS 95桌面系统下边状态栏右边的区域，通常这里有输入法和时间的小图标。程序中增加使用该功能时，须在USES中添加`SHELLAPI`。添加图标时需要的函数是: Shell_NotifyIconA，它需要2个参数，一个参数是`TNotifyIconDataA`的结构，该结构如下：<br> 
      TNOTIFYICONDATAA = record<br> 
      cbSize: DWORD;<br> 
      Wnd: HWND;<br> 
      uID: UINT;<br> 
      uFlags: UINT;<br> 
      uCallbackMessage: UINT;<br> 
      hIcon: HICON;<br> 
      szTip: array [0..63] of AnsiChar;<br> 
      end;<br> 
      <br> 
      ----cbSize是该结构的长度；Wnd是调用Shell_NotifyIconA函数的窗口的Handle；uID是用户自定义的一个数值，在uCallbackMessage参数指定的消息中使用；uCallbackMessage是一个参数，当添加的图标上出现鼠标事件时，系统向Wnd参数指定的窗口发送一个消息，该消息的Msg参数是uCallbackMessage，该消息的wParam参数是uID，该消息的lParam参数是鼠标事件的Msg值。这样应用程序可使用几个图标，但只用一个消息处理函数，通过wParam参数决定处理哪一个图标的消息。uFlags是该结构中哪些项目有效，若有NIF_MESSAGE则uCallbackMessage参数是有效的；若有NIF_ICON则hIcon参数是有效的；若有NIF_TIP则szTip参数有效。<br> 
      <br> 
      ----uCallbackMessage是发送到Wnd参数所指定的窗口的消息。hIcon是出现系统状态栏的图标的Handle。<br> 
      <br> 
      ----szTip是当鼠标停留在系统状态栏图标上时，出现的提示。<br> 
      <br> 
      ----该结构添好后，可调用Shell_NotifyIconA函数，格式为：<br> 
      <br> 
      Shell_NotifyIconA(dwMessage:<br> 
      DWORD;lpData:PNotifyIconDataA)<br> 
      dwMessage取值为<br> 
      NIM_ADD：增加一个新图标<br> 
      NIM_MODIFY：修改一个已有的图标<br> 
      NIM_DELETE：删除一个已有的图标<br> 
      <br> 
      <br> 
      ----下面给出一个演示程序，该程序有两个按钮、一个弹出式菜单和一个Image构件。一个按钮用于添加图标，一个按钮用于删除图标，Image构件内有一个图标(从Delphi自带的图标中装入)，在图标上用鼠标右键单击时，会弹出一个菜单。程序中自定义一个消息处理函数处理系统状态栏图标消息。<br> 
      --------------------------------------------------------<br> 
      unit Unit1;<br> 
      <br> 
      interface<br> 
      <br> 
      uses<br> 
      Windows, Messages, SysUtils,&nbsp;<br>
      Classes, Graphics, Controls, Forms, Dialogs,<br> 
      StdCtrls, ShellApi, ExtCtrls, Menus;<br> 
      <br> 
      const mymsg=wm_user+1;iid=100;<br> 
      type<br> 
      TForm1 = class(TForm)<br> 
      Button1: TButton;<br> 
      Button2: TButton;<br> 
      Image1: TImage;<br> 
      PopupMenu1: TPopupMenu;<br> 
      a1: TMenuItem;<br> 
      b1: TMenuItem;<br> 
      c1: TMenuItem;<br> 
      procedure Button1Click(Sender: TObject);<br> 
      procedure Button2Click(Sender: TObject);<br> 
      private<br> 
      procedure mymessage(var message:<br> 
      tmessage);message mymsg;<br> 
      public<br> 
      { Public declarations }<br> 
      end;<br> 
      var<br> 
      Form1: TForm1;ntid:tnotifyicondataa;<br> 
      <br> 
      implementation<br> 
      <br> 
      {$R *.DFM}<br> 
      <br> 
      procedure TForm1.mymessage(var message:tmessage);<br> 
      var mypt:tpoint;<br> 
      begin<br> 
      inherited;<br> 
      if message.lparam=wm_rbuttonup then begin<br> 
      getcursorpos(mypt);<br> 
      popupmenu1.popup(mypt.x,mypt.y);end;<br> 
      message.Result:=0;<br> 
      end;<br> 
      <br> 
      procedure TForm1.Button1Click(Sender: TObject);<br> 
      begin<br> 
      ntid.cbSize:=sizeof(tnotifyicondataa);<br> 
      ntid.Wnd:=handle;<br> 
      ntid.uID:=iid;<br> 
      ntid.uFlags:=nif_icon+nif_tip+nif_message;<br> 
      ntid.uCallbackMessage:=mymsg;<br> 
      ntid.hIcon:=image1.Picture.Icon.handle;<br> 
      ntid.szTip:=`asdf`;<br> 
      shell_notifyicona(NIM_ADD,@ntid);<br> 
      end;<br> 
      <br> 
      procedure TForm1.Button2Click(Sender: TObject);<br> 
      begin<br> 
      ntid.cbSize:=sizeof(tnotifyicondataa);<br> 
      ntid.Wnd:=handle;<br> 
      ntid.uID:=iid;<br> 
      ntid.uFlags:=nif_icon+nif_tip+nif_message;<br> 
      ntid.uCallbackMessage:=mymsg;<br> 
      ntid.hIcon:=image1.Picture.Icon.handle;<br> 
      ntid.szTip:=`asdf`;<br> 
      shell_notifyicona(NIM_DELETE,@ntid);<br> 
      end;<br> 
      <br> 
      end.      
    </td>      
  </tr>      
</table>      
</center></div>      
<p>　</p> 
 
</body> 
 
</html> 
