<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>您现在的位置是</title>
</head>

<body>

<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="100%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="../progidx.htm">编程技巧</a> --&gt; 
      <a href="Del_idx.htm">DELPHI</a></b></span></td>      
  </tr>      
</table>      
</center></div><div align="center"><center>      
      
<table border="1" width="100%" style="font-size: 9pt" bgcolor="#FFFFFF"      
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">      
  <tr>      
    <td width="85%" align="left" valign="top"><table border="1" width="32%" style="font-size: 9pt" height="30"      
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"      
    bordercolordark="#FFFFFF">      
      <tr>      
        <td width="100%" bgcolor="#4264B5"><p align="center"><span style="font-size: 9pt"><font      
        color="#FFFFFF">资料整理&middot;<a href="http://chinaprog.yeah.net" target="_blank"      
        style="color: rgb(255,255,255)">中国程序员网站</a></font></span></td>      
      </tr>      
    </table>      
      <p align="center">将JPEG格式文件转化为Windows墙纸&nbsp;<br>
      <br>
                              (长沙 汤文)</p> 
      <p>　　JPEG是一种图像压缩标准，很多精美的图片都是采用这种格式标准，其特点是文件体积较小，而且支持24位色深。但是，Windows9x只支持位图文件(即以bmp为扩展名的文件)的墙纸。下面这个程序就是将以jpg或jpeg为扩展名的图片文件转化为位图文件，并通过修改注册表的键值来通知Windows更换墙纸。本程序使用了一个Tform；一个OpenPictureDialog用来让用户选择图片；三个SpeedButton；分别用来打开OpenPictureDialog对话框，确定更换墙纸,退出程序。程序全部代码如下：<br>
      　　unit Unit1;<br> 
      　　interface<br>
      　　uses<br>
      　　 Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms,&nbsp;<br>
      Dialogs, jpeg, registry, ExtDlgs, StdCtrls, Buttons;<br> 
      　　type<br>
      　　 TForm1 = class(TForm)<br> 
      　　 SpeedButton1: TSpeedButton;<br> 
      　　 SpeedButton2: TSpeedButton;<br> 
      　　 SpeedButton3: TSpeedButton;<br> 
      　　 OpenPictureDialog1: TOpenPictureDialog;<br> 
      　　procedure SpeedButton1Click(Sender: TObject);<br> 
      　　procedure SpeedButton2Click(Sender: TObject);<br> 
      　　procedure SpeedButton3Click(Sender: TObject);<br> 
      　　 private<br> 
      　　 { Private declarations }<br> 
      　　 public<br> 
      　　 { Public declarations }<br> 
      　　 end;<br> 
      　　var<br>
      　　 Form1: TForm1;<br> 
      　　implementation<br>
      　　{＄R ＊.DFM}<br> 
      　　procedure TForm1.SpeedButton1Click(Sender: TObject);<br> 
      　　begin<br>
      　　 openpicturedialog1.execute;{打开OpenPictureDialog对话框}<br> 
      　　end;<br>
      　　procedure TForm1.SpeedButton2Click(Sender: TObject);<br> 
      　　var<br>
      　　 reg: tregistry;{Tregistry对象在Registry单元中声明，需要在Uese 中引用Registry单元}<br> 
      　　 jpeg: tjpegimage;{Tjpegimage对象在Jpeg单元中声明，需要在Uese 中引用Jpeg单元}<br> 
      　　 bmp: tbitmap;<br> 
      　　begin<br>
      　　 if (openpicturedialog1.filename=``)<br> 
      　　 then {判断OpenPictureDialog1中有无文件被选中}&nbsp;<br>
     messagedlg(`请选择一张图片`,mtinformation,[mbOK],0)<br>
      　　 else<br> 
      　　 begin<br> 
      　　 jpeg:=tjpegimage.Create;<br> 
      　　 jpeg.LoadFromFile(openpicturedialog1.filename);{加载被用户选中的文件}<br> 
      　　 bmp:=tbitmap.Create;<br> 
      　　 bmp.assign(jpeg);<br> 
      　　 bmp.savetofile(`c:\windows\wall.bmp`);{将转换成功的文件保存的路径及文件名}<br> 
      　　 reg:=tregistry.Create;<br> 
      　　reg.rootkey:=hkey_current_user;{设置根键名称}<br>
      　　reg.openkey(`control panel\desktop`,false);{打开Control Panel\Desktop路径对应的主<br> 
      键}<br> 
      　　 reg.writestring(`tilewallpaper`,`0`);<br> 
      　　 reg.writestring(`wallpaper`,`c:\windows\wall.bmp`);<br> 
     {覆盖并写入新值TileWall－ paper和Wallpaper串}<br> 
      　　systemparametersinfo(spi_setdeskwallpaper,0,nil,spif_sendchange);{通知win－dows更<br>
      换墙纸}<br>
      　　reg.closekey;{写入更改内容并关闭注册表}<br>
      　　 reg.Free;{释放对象}<br> 
      　　 close;<br> 
      　　 end;<br> 
      　　end;<br>
      　　procedure TForm1.SpeedButton3Click(Sender: TObject);<br> 
      　　begin<br>
      　　 close;<br> 
      　　end;<br>
      　　end.<br>
      　　此程序只能将以jpg或jpeg为扩展名的图片文件转化为Windows的墙纸，因此应在OpenPictureDialog控件的Filter属性中筛选显示文件的类型，最好设置为JPEG Image File(＊.jpg)和JPEG Image File(＊.jpeg)文件。程序在中文Windows98,Delphi 4.0下编译通过。      
    </td>      
  </tr>      
</table>      
</center></div>      
 
</body> 
 
</html> 
