<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>您现在的位置是</title>
</head>

<body>

<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="100%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是： <b><a href="../progidx.htm">编程技巧</a> --&gt; 
      <a href="del030.htm">DELPHI</a></b></span></td>      
  </tr>      
</table>      
</center></div><div align="center"><center>      
      
<table border="1" width="100%" style="font-size: 9pt" bgcolor="#FFFFFF"      
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">      
  <tr>      
    <td width="85%" align="left" valign="top"><table border="1" width="32%" style="font-size: 9pt" height="30"      
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"      
    bordercolordark="#FFFFFF">      
      <tr>      
        <td width="100%" bgcolor="#4264B5"><p align="center"><span style="font-size: 9pt"><font      
        color="#FFFFFF">资料整理&middot;<a href="http://chinaprog.yeah.net" target="_blank"      
        style="color: rgb(255,255,255)">中国程序员网站</a></font></span></td>      
      </tr>      
    </table>      
      <p align="center">Delphi数据集过滤技巧<br>
      <br>
                          (四川　李海川)      
      <p><br>
      <br>
    当我们在操作数据集时，往往需要对数据进行筛选。例如：一个名为Customer的数据表，它具有CustNo、CustName、Country、Address、Phone、State、TaxRate等字段，如果只想查看国别为China或顾客号大于1000的顾客记录，就需要对数据集进行过滤。经总结，有下面这些过滤方法：<br>
      　　一、利用TTable和TQuery的Filter属性<br>
      　　1.在设计时设置Filter属性<br>
      　　例如，设置Filter为：Country=′China′<br>
      　　然后改变Filtered属性为True（注意，Filtered为True时过滤才有效）。则只能看到对应的Country字段内容为‘China’的记录。<br>
      　　设置Filter时可以使用的操作符有：&lt;、>、&lt;=、>=、=、&lt;>、AND、OR、NOT。<br>
      　　例如，设置Filter为：CustNo>=1000 and CustNo&lt;=5000，则只能看到顾客号在1000与5000之间的顾客记录。<br> 
      　　2.在程序运行期间进行动态过滤<br>
      　　要在程序运行时改变Filter属性，这包括两种情况：<br>
      　　(1)操作符右边为常量，例如：<br>
      　　Table1Filter:=′State′＋′=′＋′′′HI′′′;<br>
      　　注意：字符串常量必须用三对单引号括起来。<br>
      　　(2)操作符右边不为常量，可能是通过一个变量指定的值，或由一输入框给出的值。这时需要用到Format函数。其代码形式为：<br>
      　　Table1Filter:=Format(′State′＋′=′＋′′′％S′′′,[StateValue]);<br>
      　　其中StateValue为已经赋值的一个字符串变量，也可以为其他形式，例如:Edit1Text。<br>
      　　二、用ApplyRange筛选数据集的记录<br>
      　　执行下面这段代码，将只能看到顾客号在1000至5000之间的顾客记录。组成该例程的几个过程为：ApplyRange,SetRangeStart,SetRangeEnd。<br>
      　　Table1SetRangeStart;<br>
      　　Table1[′CustNo′]:=1000;<br>
      　　Table1SetRangeEnd;<br>
      　　Table1[′CustNo′]:=5000;<br>
      　　Table1ApplyRange;<br>
      　　注意：该过程只适用于索引的字段。如果想基于非索引字段筛选，则不妨使用一点小花招：建立假索引。实现的方法为：<br>
      　　Table1IndexFieldNames:=字段名;<br>
      　　Delphi还提供了简单的调用SetRangeStart、SetRangeEnd和ApplyRange<br>
      的方法，例如：Table1SetRange([Edit1Text],[Edit2Text]);<br>
      　　三、用OnFilterRecord事件筛选<br>
      　　OnFilterRecord事件允许按非键控字段建立筛选程序,例如：<br>
      　　procedure TForm1Table1FilterRecord(DataSet:TDataSet;var Accept:Boolean);<br> 
      　　begin<br>
      　　Accept:=DataSet[′State′]=′CA′;<br>
      　　end;<br>
      　　四、用TQuery控件的SQL语句<br>
      　　1.SQL语句中不包含变量和参数<br>
      　　Select＊from Customer<br> 
      　　Where CustNo>=1000 and CustNo&lt;=5000<br> 
      　　2.SQL语句中包含参数<br>
      　　Select＊from Customer<br> 
      　　Where CustNo>=:CustNo<br> 
      　　在运行期间给参数CustNo赋值。<br>
      　　3.SQL语句中包含变量<br>
      　　这时向TQuery控件添加SQL语句的代码应当这样写：<br>
      　　Query1Close;<br>
      　　Query1SQLClear;<br>
      　　Query1SQLAdd(Format(′Select＊from Customer′＋′′＋′<br> 
      where State=′＋′′′％S′′′,[StateValue]));<br> 
      　　Query1Open;<br>
      　　在上面的四种方法中，第四种功能最强大，使用最灵活。     
    </td>     
  </tr>     
</table>     
</center></div>     

</body>

</html>
