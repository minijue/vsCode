<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title>CGI简明教程第九章</title>
</head>

<body background="../../res/back.JPG">

<table border="0" width="100%" style="font-size: 9pt">
  <tr>
    <td width="100%"><strong><span style="font-size: 9pt">CGI简明教程第九章</span></strong><p><span
    style="font-size: 9pt"><br>
    Guest-book在网页设计中占有相当重要的地位，以至于可以和记数器相提并论。留言本可以用许多编程语言来设计，当然使用最多的还是perl和vb两种。本次cgi教程我们将谈谈在编写Guest-book中最应该注意的问题，并将给出一个不算很完整的程序代码。同时提供一个C语言的win-cgi程序供大家下载。<br>
    <br>
    就现在的情况来看，一个标准的guest-book程序一般包括三个文件。提交表单文件<br>
    （form.html)、cgi处理文件(guest-book.cgi)和最后的输出文件（book.html)。有些vb程序以access数据库为后台存储格式，以方便用户查找留言。下图给出了guest-book的工作流程。<br>
    <br>
    form.html<br>
    首先我们来看看form.html的文件内容：<br>
    &lt;html&gt;<br>
    &lt;title&gt;guest-book.html&lt;/title&gt;<br>
    &lt;h1&gt;留言本&lt;/h1&gt;<br>
    &lt;form method=&quot;post&quot; action=&quot;/cgi-shl/guest-book.cgi&quot;&gt;<br>
    &lt;p&gt;名字：&lt;input name=&quot;name&quot; size=&quot;20&quot;&gt;<br>
    &lt;p&gt;email:&lt;input name=&quot;email&quot; size=&quot;30&quot;&gt;<br>
    &lt;p&gt;意见：&lt;textarea name=&quot;suggest&quot; cols=30 
    rows=4&gt;&lt;/textarea&gt;<br>
    &lt;/textarea&gt;&lt;p&gt;<br>
    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;<br>
    &lt;input type=&quot;reset&quot; value=&quot;取消&quot;&gt;<br>
    &lt;/form&gt;&lt;/html&gt;<br>
    <br>
    &lt;form method=&quot;post&quot; action=&quot;/cgi-shl/guest-book.cgi&quot;&gt;<br>
    将此表单的提交后的动作交给guest-book.cgi程序。<br>
    <br>
    guest-book.cgi<br>
    #! perl<br>
    <br>
    print&quot;Content-type:text/html\n\n&quot;;<br>
    read(STDIN,$buffer,$ENV{'CONTENT_LENGTH'})；<br>
    @pairs=split(/&amp;/,$buffer);<br>
    foreach $pair(@pairs){<br>
    ($name,$value)=split(/=/,$pair);<br>
    $value=~tr/+//;<br>
    $value=~s/%([a-f A-F 0-9][a-f A-F 0-9])/pack(&quot;C&quot;,hex($1))/eg;<br>
    $FORM{$name}=$value;<br>
    }<br>
    print&quot;&lt;title&gt;留言本&lt;/title&gt;&quot;;<br>
    print&quot;&lt;h1&gt;留言本&lt;/h1&gt;&quot;;<br>
    <br>
    foreach $check(values%FORM){<br>
    if($check eq&quot;&quot;){<br>
    print&quot;&lt;hr size=3&gt;&quot;;<br>
    print&quot;&lt;h2&gt;请不要留空&quot;;<br>
    exit(0);<br>
    }<br>
    }<br>
    <br>
    $FORM{'suggest'}=~s/cM\n/&lt;br&gt;\n/g;<br>
    <br>
    $filename=&quot;c:/website/htdocs/book.html&quot;;<br>
    <br>
    open(FILE,&quot;&gt;&gt; $filename&quot;);<br>
    print FILE &quot;名字：$FORM{'name'}&lt;br&gt;\n&quot;;<br>
    print FILE &quot;Email:&lt;a 
    href=&quot;mailto:$FORM{'email'}&gt;$FORM{'email'}&lt;/a&gt;&lt;br&gt;\n&quot;}&quot;;<br>
    print FILE &quot;留言：$FORM{'suggest'}&quot;;<br>
    close{FILE};<br>
    <br>
    print &quot;&lt;h2&gt;谢谢留言&lt;/h2&gt;&quot;;<br>
    <br>
    print&quot;&lt;a href=\&quot;book.html\&quot;&gt;请观看留言本&lt;/a&gt;&quot;;<br>
    <br>
    <br>
    exit(0);<br>
    <br>
    这个程序相当简陋，但它具有了所有的CGI-Guest程序的特点，我们一一分析如下：<br>
    首先，<br>
    read(STDIN,$buffer,$ENV{'CONTENT_LENGTH'})；<br>
    @pairs=split(/&amp;/,$buffer);<br>
    foreach $pair(@pairs){<br>
    ($name,$value)=split(/=/,$pair);<br>
    $value=~tr/+//;<br>
    $value=~s/%([a-f A-F 0-9][a-f A-F 0-9])/pack(&quot;C&quot;,hex($1))/eg;<br>
    $FORM{$name}=$value;<br>
    }<br>
    这是一段表单分析的语句，在前面的程序里，估计大家也都见过了。<br>
    <br>
    其次：<br>
    foreach $check(values%FORM){<br>
    if($check eq&quot;&quot;){<br>
    print&quot;&lt;hr size=3&gt;&quot;;<br>
    print&quot;&lt;h2&gt;请不要留空&quot;;<br>
    exit(0);<br>
    }<br>
    }<br>
    做输入字段的检查，看看是否有留空的现象。从前这种任务都是要CGI程序来验证的，比如email是否输入的是mail地址等检查。不过现在我们可以通过javascript来做这样的检查，这样服务器的负担将大大减轻。<br>
    <br>
    最后：<br>
    $filename=&quot;c:/website/htdocs/book.html&quot;;<br>
    <br>
    open(FILE,&quot;&gt;&gt; $filename&quot;);<br>
    print FILE &quot;名字：$FORM{'name'}&lt;br&gt;\n&quot;;<br>
    print FILE &quot;Email:&lt;a 
    href=&quot;mailto:$FORM{'email'}&gt;$FORM{'email'}&lt;/a&gt;&lt;br&gt;\n&quot;}&quot;;<br>
    print FILE &quot;留言：$FORM{'suggest'}&quot;;<br>
    close{FILE};<br>
    <br>
    print &quot;&lt;h2&gt;谢谢留言&lt;/h2&gt;&quot;;<br>
    <br>
    print&quot;&lt;a href=\&quot;book.html\&quot;&gt;请观看留言本&lt;/a&gt;&quot;;<br>
    <br>
    <br>
    exit(0);<br>
    输出内容到文件和屏幕上。完成留言的程序。<br>
    <br>
    book.html:<br>
    这个程序中book.html没有什么特别的要求，可以不用写，就让程序自动生成。<br>
    现在有的cgi程序，对book.html也有设定，比如在&lt;head&gt;&lt;/head&gt;之间就写上注释<br>
    &lt;!--这是流言开始--!&gt;<br>
    &lt;!--这是流言结束--!&gt;<br>
    这样，在程序对留言数据操作的时候，就可以忽略掉文件内的其他内容。<br>
    <br>
    最后，我为各位找到一个用C写的guestbook程序，它是在win平台上运行的，具有非常好的兼容性。同时它采用了临时文件的方式来传递信息。所以你需要设定.ini文件。好了，这课到此为止。</span></td>
  </tr>
</table>

<p><a href="default.html" tppabs="http://202.96.217.5/~xiaoyi/default.html">返回CGI教程目录 
</a></p>
</body>
</html>
