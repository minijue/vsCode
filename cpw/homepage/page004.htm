<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb_2312-80">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title>利用CGI方式实现Web查询</title>
</head>

<body>

<table border="0" cellspacing="2" cellpadding="0" width="100%" style="font-size: 9pt">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">现在的位置是： <b><a href="home_idx1.htm">主页制作</a> 
    &gt;</b> </span><font color="#000000">利用CGI方式实现Web查询</font></td>
  </tr>
  <tr>
    <td></td>
  </tr>
</table>

<table border="0" width="100%" style="font-size: 9pt" bgcolor="#E8E8E8">
  <tr>
    <td width="100%"><table border="1" width="32%" style="font-size: 9pt" height="30"
    cellspacing="0" cellpadding="2">
      <tr>
        <td width="100%" bgcolor="#4264B5"><p align="center"><font color="#FFFFFF">资料整理<span
        class="f">&middot;</span><a href="http://fasoft.yeah.net" target="_blank"
        style="color: rgb(255,255,255)">中国程序员网站</a></font></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%">　<table border="0" width="100%" bgcolor="#E8E8E8">
      <tr>
        <td width="100%"></td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="100%"><p align="center"><font color="#000000"><strong>利用CGI方式实现Web查询</strong></font></td>
  </tr>
  <tr>
    <td width="100%"><p align="center">许玲</td>
  </tr>
  <tr>
    <td width="100%"></td>
  </tr>
  <tr>
    <td width="100%">一.CGI简述<br>
    公共网关界面(CGI)是一种编程标准，它规定了Web服务器调用其它可执行程序(CGI程序)的接口协议标准。CGI程序通过Web服务器与运行Web服务器调用其它可执行程序交互，它接受Web浏览器发送给Web服务器的信息，并进行处理，然后将结果再送回给Web服务器及Web浏览器。CGI程序可以用任何程序设计语言编写，如Shell、perl、C、Java等，用C语言编写的CGI程序具有速度快、安全性高等特点。CGI程序通常用于加入查询机制、搜索机制、交互式应用及其它一些应用。CGI接口标准包括输入、环境变量、标准输出三部分，CGI程序可以通过标准输入(stdin)从Web服务器得到输入信息，例如从FORM中得到数据，这就是常用的POST方法。由于不同的操作系统采用了不同的信息交换机制，其参数传递的处理过程也有差别，在Unix与DOS中，环境信息反映着本级程序运行时的某些系统状况，可用于父程序与子程序间的信息传递，CGI正是通过设量环境变量在服务器与客户机间传递数据的，各操作系统都提供了许多环境变量，它们定义了程序的执行环境，应用程序可以存取它们。Web服务器和CGI接口也设置了一些环境变量用以传递一些重要的参数。CGI程序通过标准输出(stdout)将输出信息传送给Web服务器，传送给服务器的<br>
    信息可以是HTML文本也可以是纯文本。本文将利用C语言编写一个CGI应用程序――学生成绩查询系统，并分析了CGI程序设计的方法、过程、技巧。<br>
    <br>
    二、成绩查询系统介绍<br>
    一个在WWW环境下的学生成绩公布栏必将成为日后各类成绩发布的主要手段，每位学生交将有自己的密码，所以不必担心成绩上网之后的保密性。任何学生以任何形式上网进入本站点的成绩查询系统之后，只要输入自己的系列、班别、学号及密码，便可以利用这个学生绩查询系统查询自己的成绩，该设计思路与系统不仅适合各类高校内部的成绩发布，也适合于全国高考、统考等大规模考试的成绩发布。本文介绍的只是一个功能单一的查询系统，若需完善还需加入成绩维护部分，由成绩管理者进行内容维护，包括成绩输入、修改、删除等功能。<br>
    <br>
    三、HTML FORM格式部分<br>
    3.1 FORM输放的分解<br>
    在UNIX系统上，CGI信息是利用STDIN/STDOUT方式传输的，所以若要编写一个C语言的CGI程序，就必须要了解如何解剖与截取STDIN的CGI信息。当用户提交一个HTML 
    FORM时，WEB浏览器首先对FORM中的数据以名字/值对的形式进行编码，并发送给WEB服务器，然后再由WEB服务器传递给CGI程序，其格式如下：NAME1=VALUEL&amp;NAME2=VALUE2&amp;NAME3&middot;&middot;&middot;&middot;ッ字是FORM中定义的INPUT，SELECT等标置名字，值是用户输入或选择的标值，在程序中将对其进行分析与解码，将其分解成一组组的名字/值对，这个过程是通过在输入流中查找字符“=”与“&amp;”来完成的，每当找到字符“=”，标志着一个FORM变量名字的结束，当找到字符“&amp;”，标志着一个FORM变量值的结束。当名字/值对分解完之后，还须将输入中的一些特殊字符转换成相应的ASCII字符，如需将“+”转换成空格符，将一些特殊字符转换成ASCII字符，对以上分所分析的分解与转换过程，在下面的程序中有详细注明。<br>
    3.2HTML FORM文件<br>
    成绩查询系统的HTML文件P.htrnl<br>
    &lt;TITLE&gt;学生成绩查询系统&lt;/TITLE&gt;<br>
    &lt;H1&gt;学生成绩查询系统&lt;/H1&gt;<br>
    &lt;FORM METHOD=&quot;POST&quot;ACTION=&quot;URL地址&quot;<br>
    &lt;H3&gt;系列:&lt;SELECTNAME=&quot;Department&quot;&gt;<br>
    &lt;OPTION&gt;计算机系<br>
    &lt;OPTION&gt;英语系<br>
    &lt;OPTION&gt;无线电系<br>
    &lt;/SELECT&gt;&lt;P&gt;<br>
    学号：&lt;INPNT TYPE=&quot;TEXT&quot;NAME=&quot;ID&quot;&gt;&lt;P&gt;<br>
    密码：&lt;INPNT TYPE=&quot;PASSWORD&quot;NAME&quot;PASSWORD&quot;&gt;&lt;P&gt;<br>
    &lt;INPNT TYPE=&quot;SUBMIT&quot;VALUE&quot;查询”&gt;<br>
    &lt;INPNT TYPE+&quot;RESET&quot;VALUE=&quot;放弃”〉<br>
    &lt;/FORM&gt;<br>
    <br>
    四、学生成绩查询CGI程序<br>
    该CGI程序分解、接收HTML FORM中提供的查询条件，然后查询出该学生的成绩并返回。学生成绩有两个数据文件，一个是***SUB 
    DAT，其中含有学生的各个科目，***表示系别，如计算机系的科目文件是COMPSUB 
    DAT，英语系的科目文件是ENGSUB.DAT，无线电系科目文件是ELECSUB.DAT；另一个数据文件是***SCOER.DAT，该文件中包含有每个学生的学号、密码与成绩，***表示系别，如计算机系的学生成绩文件是COMPSCORE.DAT，同理，其他系的学生成绩文件按此原则以此类推。当学生输入的学号及密码符合数据文件的内容时，就会显示该学生的成绩。<br>
    main(int argc,char*argv[])<br>
    {<br>
    register int i,m=0;<br>
    int len;<br>
    FILE*fp,*fpl,*fopen();<br>
    char filename1[100],filename2[100],title[100];/*设定资料变量*/<br>
    char subject[10][10];<br>
    char id[100][10],password[100][10];<br>
    int score[100][20],sum[100],allsum;<br>
    float avg[100],alltotalavg;<br>
    int rank,number,index,find,j,kind;<br>
    printf(&quot;content-type:text/html%c%c&quot;,10,10);<br>
    len=atoi(getenv(&quot;CONTENT_LENGITH&quot;));<br>
    for(i=0;len &amp;&amp; (!feof(stdin));i++){<br>
    m=i<br>
    inputs[i].val=readdstdin(stdin,&amp;,&amp;len);/*读STDiN信息*/<br>
    AddToSpace(inputs[i].val);<br>
    Convert(inputs[i].val);<br>
    inputs[i].name=ReadData(inputs[i].val,=);<br>
    }<br>
    strcpy(filename1,&quot;/score/setup/&quot;);<br>
    stucpy(filename2,&quot;/xcore/data/&quot;);<br>
    if(strcmp(inputs[o].val,&quot;计算机系/)==0<br>
    strcat(filename1,&quot;compusb.dat&quot;);<br>
    strcat(filename2,&quot;compscore.dat&quot;);<br>
    }<br>
    if(strcmp(inputs[o].val,&quot;英语系&quot;)==0<br>
    strcat(filenamel,&quot;engsub.dat&quot;);<br>
    strcat(filename2,&quot;engscore.dat&quot;);<br>
    }<br>
    if(strcmp(inputs[o].val,&quot;无线电系&quot;)==0<br>
    }<br>
    strcat(filename1,&quot;elecsub.dat&quot;);<br>
    strcat(filename2,&quot;elecscore.dat&quot;);<br>
    }<br>
    fp=fopen(filename1,&quot;r&quot;);/*打开文件*/<br>
    kind=0;<br>
    while(fscanf(fp,&quot;%s&quot;,subject[kind]!=EOF<br>
    kind=kind+1;<br>
    fclose(fp);<br>
    <br>
    fp1=fopen(filename2,&quot;r&quot;);/*打开文件*/<br>
    allsum=0;<br>
    for(i=0;i&lt;100;i++)<br>
    {<br>
    numbde=i;<br>
    if(fscanf(fp1,&quot;%s%s&quot;,id[i],<br>
    password[i]!=EOF){<br>
    sum[i]=0;<br>
    for{j=0;j&lt;kind;j++){<br>
    fscanf(fp1,&quot;%d&quot;,&amp;score[i][j]);<br>
    sum[i]+=score[i][j];<br>
    }<br>
    avg[i]=sum[i]/kind;<br>
    allsum+=sum[i];<br>
    }<br>
    else<br>
    break;<br>
    }<br>
    fclose(fp1);<br>
    find=0;<br>
    if(strcmp(inputs[2].val,id[i])==0&amp;&amp;<br>
    strcmp(inputs[3].val,password[i]==0){<br>
    index=i;<br>
    find=i;<br>
    }<br>
    }<br>
    if(find==0)<br>
    {<br>
    printf{&quot;&lt;H&gt;输入有误，请再输一次!&lt;/h1&gt;\n&quot;);<br>
    }<br>
    else<br>
    {<br>
    rank=1<br>
    for(i=o;i&lt;number;i++)<br>
    if(sum[index]&lt;sum[i])<br>
    rank=rank+1;<br>
    slltotalavg=allsum/number;<br>
    printf(&quot;&lt;center&gt;&lt;H1&gt;学生成绩查询系统&lt;/H1&gt;&lt;/center&gt;&quot;);<br>
    pritf(&quot;\n&lt;center&gt;查询学生学号：%s&lt;/center&gt;&lt;br&gt;&quot;,<br>
    inputs[2].val);<br>
    printf(&quot;\n&lt;center&gt;成绩如下:&lt;/certer&gt;&lt;hr&gt;&quot;);<br>
    <br>
    for(i=0;i&lt;kind;i++)<br>
    printf{&quot;%s\t&quot;,subject[kind]);<br>
    printf(&quot;总分&lt;br&gt;\n&quot;);<br>
    for(i=0;i&lt;kind;i++)<br>
    printf(&quot;%d\t&quot;,score[index][i]);<br>
    printf[&quot;%d&lt;br&gt;\n&quot;,sum[index]);<br>
    }<br>
    }<br>
    <br>
    五、结束语<br>
    本文以学竽成绩查询系统作为实例，详细分析了用C语言进行CGI程序设计的方法与过程，随着INTERET/INTRANET应用的深入，将WEB与多台数据库联接的需求也日益迫切，CGI可以使得WEB能够能最低程序的复杂性与其后台信息集成，成为一种支持多种类型的通用环境，但是由于在CGI方式中每执行一次交互都需启动一个外部程序，因此其在实时应用方面受到了限制，因而，WEB 
    SENER API及JOCBC等应用方式也正在成熟。<br>
    <br>
    参考文献<br>
    1、华南理工大学信息网络工程研究中心编《Inrternet国际互连网》中山大学出版社<br>
    2、蔡奇玉等《WWW上HTML与CGI写作大全》北京理工大学出版社<br>
    3、肖治延用C语言进行CGI程序设计微电脑世界1996.5<br>
    4、[美]Tim Ritchey 《JavaScrip for Netscape》清华大学出版社<p><br>
    </td>
  </tr>
</table>
</body>
</html>
