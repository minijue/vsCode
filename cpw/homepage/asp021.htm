<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>您现在的位置是</title>
</head>

<body>

<div align="center"><center>

<table border="1" cellspacing="0" cellpadding="2" width="100%" style="font-size: 9pt"
bordercolor="#000000" bordercolordark="#FFFFFF">
  <tr bgcolor="#CCFFCC">
    <td><span style="font-size: 9pt">您现在的位置是：&nbsp;</span><b> <a href="home_idx1.htm">主页制作</a></b></td>  
  </tr>  
</table>  
</center></div><div align="center"><center>  
  
<table border="1" width="100%" style="font-size: 9pt" bgcolor="#FFFFFF"  
bordercolor="#000000" cellpadding="2" cellspacing="0" bordercolordark="#FFFFFF">  
  <tr>  
    <td width="85%" align="left" valign="top"><table border="1" width="32%" style="font-size: 9pt" height="30"  
    cellspacing="0" cellpadding="2" bgcolor="#FFFFFF" bordercolor="#000000"  
    bordercolordark="#FFFFFF">  
      <tr>  
        <td width="100%" bgcolor="#4264B5"><p align="center"><span style="font-size: 9pt"><font  
        color="#FFFFFF">资料整理&middot;<a href="http://chinaprog.yeah.net" target="_blank"  
        style="color: rgb(255,255,255)">中国程序员网站</a></font></span></td>  
      </tr>  
    </table>  
      <p align="center"><font class="a"><b>三、用户身份验证</b>
      <p align="right">作 者 : <a href="mailto:microsoftwindows@126.com">仙人掌工作室</a>
      <p>　　 
      为简单计，本文只讨论在服务器端的用户身份验证。登录页面是通过调用ASPSecurity.inc中的signUserOn函数验证用户身份的。signUserOn检查数据库中是否存在和用户输入的名字、密码匹配的记录：<br>
      function signUserOn(aSignon, aPassword)<br>
      dim dict<br>
      ' 用户输入的名字<br>
      aSignon = lcase(trim(aSignon))<br>
      ' 用户输入的密码<br>
      aPassword = lcase(trim(aPassword))<br>
      ' 提取用户记录转换成Dictionary对象<br>
      set dict = getUser(aSignon)<br>
      ' dict对象是否包含了合法的用户信息<br>
      if isUser(dict) then<br>
      if not dict(&quot;Password&quot;) = aPassword then<br>
      signUserOn = false<br>
      Session(&quot;msg&quot;) = &quot;密码错误.&quot;<br>
      exit function<br>
      end if<br>
      <br>
      ' 更新最后访问时间<br>
      call updateLastOn(aSignon)<br>
      <br>
      ' 用SessionID (或不支持Cookies时,ID)标识用户记录<br>
      if not Session(&quot;SupportsCookies&quot;) then<br>
      Session(&quot;ID&quot;) = getID()<br>
      dict.Add &quot;SessionID&quot;, Session(&quot;ID&quot;)<br>
      else<br>
      dict.Add &quot;SessionID&quot;, Session.SessionID<br>
      end if<br>
      <br>
      ' 记录最后活动时间<br>
      dict.add &quot;LastActivity&quot;, now()<br>
      ' 在Session中记录当前用户信息<br>
      set Session(&quot;User&quot;) = dict<br>
      ' 将当前用户加入正在访问用户列表<br>
      call addUserToApplication(dict)<br>
      signUserOn = true<br>
      else<br>
      Session(&quot;msg&quot;) = &quot;用户名称错误&quot;<br>
      signUserOn = false<br>
      end if<br>
      end function<br>
      <br>
      <p>　　 
      如果用户输入的名字和密码与数据库中的记录匹配，signUserOn函数返回True。此时，用户被授权，Session(&quot;User&quot;)变量包含了一个Dictionary对象，其中含有该用户的数据库记录的字段名称和值。另外，这里还把Dictionary对象加入到Application(&quot;User&quot;)数组，这是为了便于获得当前正在访问安全站点的用户清单。 
      signUserOn用到了ASPSecurity.inc中的许多子过程。由于大多数子过程都很相似，下面只讨论其中的getUser。该函数先连接数据库，然后提取对应的用户记录，最后将记录转换为Dictionary对象并返回它，如下所示：<br>
      function getUser(aSignon)<br>
      dim conn<br>
      dim R<br>
      set conn = openConnection()<br>
      set R = conn.Execute(&quot;SELECT * FROM Users WHERE Users.Signon='&quot; 
      &amp; aSignon &amp; &quot;'&quot;)<br>
      if err.number &lt; &gt; 0 then<br>
      ' 输出错误信息<br>
      ......<br>
      response.end<br>
      end if<br>
      if not R.EOF then<br>
      set getUser = recordToDictionary(R)<br>
      else<br>
      set getUser = nothing<br>
      end if<br>
      R.Close<br>
      set R = nothing<br>
      conn.close<br>
      set conn = nothing<br>
      end function<br>
      <p>　　 
      如果用户在注册页面中单击的是注册按钮，则在经过必要的检查之后就可以在数据库中生成新的用户记录了。注册成功的用户会自动进入安全页面，这一部分操作和普通的登录过程是一样的。
      <p>　　 身份验证和注册操作都将错误信息存储在Session(&quot;msg&quot;)变量中。这些错误信息可以显示在返回给用户的HTML页面中：<br>
      &lt; %<br>
      if Session(&quot;msg&quot;) &lt; &gt; &quot;&quot; then<br>
      ' 显示错误信息<br>
      ......<br>
      Session(&quot;msg&quot;) = &quot;&quot;<br>
      end if<br>
      %&gt;</font>
      <p align="right">
      <p><font class="a">　 <a href="asp019.htm">第1页</a>　 <a href="asp020.htm">第2页</a>　 
      第3页　 <a href="asp022.htm">第4页</a>　 <a href="asp023.htm">第5页</a>　 
      </font>  
      <p>　  
    </td>  
  </tr>  
</table>  
</center></div>  

</body>

</html>
